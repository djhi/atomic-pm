const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./browser-CHl2p3zP.js","./index-2xnnuABT.js"])))=>i.map(i=>d[i]);
import{g as Gn,r as Vn,c as Tr,a as bt,b as cn,d as un,e as hn,i as Qn,_ as ze,f as Yn,h as Xn,j as Zn,k as ei,l as ti}from"./index-2xnnuABT.js";const ri=(s,t)=>({...s,getList:async function(e,r){let n=r;n=await L({name:"beforeGetList",params:n,dataProvider:s,handlers:t,resource:e});let i=await s.getList(e,n);return i=await L({name:"afterGetList",params:i,dataProvider:s,handlers:t,resource:e}),i.data=await Promise.all(i.data.map(a=>L({name:"afterRead",params:a,dataProvider:s,handlers:t,resource:e}))),i},getOne:async function(e,r){let n=r;n=await L({name:"beforeGetOne",params:n,dataProvider:s,handlers:t,resource:e});let i=await s.getOne(e,n);return i=await L({name:"afterGetOne",params:i,dataProvider:s,handlers:t,resource:e}),i.data=await L({name:"afterRead",params:i.data,dataProvider:s,handlers:t,resource:e}),i},getMany:async function(e,r){let n=r;n=await L({name:"beforeGetMany",params:n,dataProvider:s,handlers:t,resource:e});let i=await s.getMany(e,n);return i=await L({name:"afterGetMany",params:i,dataProvider:s,handlers:t,resource:e}),i.data=await Promise.all(i.data.map(a=>L({name:"afterRead",params:a,dataProvider:s,handlers:t,resource:e}))),i},getManyReference:async function(e,r){let n=r;n=await L({name:"beforeGetManyReference",params:n,dataProvider:s,handlers:t,resource:e});let i=await s.getManyReference(e,n);return i=await L({name:"afterGetManyReference",params:i,dataProvider:s,handlers:t,resource:e}),i.data=await Promise.all(i.data.map(a=>L({name:"afterRead",params:a,dataProvider:s,handlers:t,resource:e}))),i},update:async function(e,r){let n=r;n=await L({name:"beforeUpdate",params:n,dataProvider:s,handlers:t,resource:e}),n.data=await L({name:"beforeSave",params:n.data,dataProvider:s,handlers:t,resource:e});let i=await s.update(e,n);return i=await L({name:"afterUpdate",params:i,dataProvider:s,handlers:t,resource:e}),i.data=await L({name:"afterSave",params:i.data,dataProvider:s,handlers:t,resource:e}),i},create:async function(e,r){let n=r;n=await L({name:"beforeCreate",params:n,dataProvider:s,handlers:t,resource:e}),n.data=await L({name:"beforeSave",params:n.data,dataProvider:s,handlers:t,resource:e});let i=await s.create(e,n);return i=await L({name:"afterCreate",params:i,dataProvider:s,handlers:t,resource:e}),i.data=await L({name:"afterSave",params:i.data,dataProvider:s,handlers:t,resource:e}),i},delete:async function(e,r){let n=r;n=await L({name:"beforeDelete",params:n,dataProvider:s,handlers:t,resource:e});let i=await s.delete(e,n);return i=await L({name:"afterDelete",params:i,dataProvider:s,handlers:t,resource:e}),i},updateMany:async function(e,r){let n=r;n=await L({name:"beforeUpdateMany",params:n,dataProvider:s,handlers:t,resource:e}),n.data=await L({name:"beforeSave",params:n.data,dataProvider:s,handlers:t,resource:e});let i=await s.updateMany(e,n);if(i=await L({name:"afterUpdateMany",params:i,dataProvider:s,handlers:t,resource:e}),t.filter(o=>(o.resource===e||o.resource==="*")&&o.afterSave).length>0){const{data:o}=await s.getMany(e,{ids:i.data});await Promise.all(o.map(c=>L({name:"afterSave",params:c,dataProvider:s,handlers:t,resource:e})))}return i},deleteMany:async function(e,r){let n=r;n=await L({name:"beforeDeleteMany",params:n,dataProvider:s,handlers:t,resource:e});let i=await s.deleteMany(e,n);return i=await L({name:"afterDeleteMany",params:i,dataProvider:s,handlers:t,resource:e}),i}}),L=async function({name:s,params:t,dataProvider:e,handlers:r,resource:n}){let i=t;const a=r.filter(o=>(o.resource===n||o.resource==="*")&&o[s]);for(let o of a){const c=o[s];if(Array.isArray(c))for(let l of c??[])i=await l(i,e,n);else i=await c(i,e,n)}return i};var gt=function(){return gt=Object.assign||function(s){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s},gt.apply(this,arguments)},re=function(s,t,e,r){function n(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function o(u){try{l(r.next(u))}catch(d){a(d)}}function c(u){try{l(r.throw(u))}catch(d){a(d)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((r=r.apply(s,t||[])).next())})},ne=function(s,t){var e={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,n,i,a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=o(0),a.throw=o(1),a.return=o(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,l[0]&&(e=0)),e;)try{if(r=1,n&&(i=l[0]&2?n.return:l[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,l[1])).done)return i;switch(n=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return e.label++,{value:l[1],done:!1};case 5:e.label++,n=l[1],l=[0];continue;case 7:l=e.ops.pop(),e.trys.pop();continue;default:if(i=e.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){e=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){e.label=l[1];break}if(l[0]===6&&e.label<i[1]){e.label=i[1],i=l;break}if(i&&e.label<i[2]){e.label=i[2],e.ops.push(l);break}i[2]&&e.ops.pop(),e.trys.pop();continue}l=t.call(s,e)}catch(u){l=[6,u],n=0}finally{r=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},ni=function(s,t){var e={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&t.indexOf(r)<0&&(e[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(s);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(s,r[n])&&(e[r[n]]=s[r[n]]);return e},ii=function(s,t){var e=t.getIdentity,r=t.getPermissions,n=t.redirectTo,i={login:function(a){return re(this,void 0,void 0,function(){var o,c,l;return ne(this,function(u){switch(u.label){case 0:return o=a,o.email&&o.password?[4,s.auth.signInWithPassword(o)]:[3,2];case 1:if(c=u.sent().error,c)throw c;return[2];case 2:return l=a,l.provider?(s.auth.signInWithOAuth(gt(gt({},l),{options:{redirectTo:n}})),[2,Promise.reject()]):[2,Promise.reject(new Error("Invalid login parameters"))]}})})},setPassword:function(a){return re(this,arguments,void 0,function(o){var c,l,u=o.access_token,d=o.refresh_token,p=o.password;return ne(this,function(h){switch(h.label){case 0:return[4,s.auth.setSession({access_token:u,refresh_token:d})];case 1:if(c=h.sent().error,c)throw c;return[4,s.auth.updateUser({password:p})];case 2:if(l=h.sent().error,l)throw l;return[2,void 0]}})})},resetPassword:function(a){return re(this,void 0,void 0,function(){var o,c,l;return ne(this,function(u){switch(u.label){case 0:return o=a.email,c=ni(a,["email"]),[4,s.auth.resetPasswordForEmail(o,c)];case 1:if(l=u.sent().error,l)throw l;return[2,void 0]}})})},logout:function(){return re(this,void 0,void 0,function(){var a;return ne(this,function(o){switch(o.label){case 0:return[4,s.auth.signOut()];case 1:if(a=o.sent().error,a)throw a;return[2]}})})},checkError:function(a){return re(this,void 0,void 0,function(){return ne(this,function(o){return a.status===401||a.status===403||a.status===400&&a.name==="AuthSessionMissingError"?[2,Promise.reject()]:[2,Promise.resolve()]})})},handleCallback:function(){return re(this,void 0,void 0,function(){var a,o,c,l;return ne(this,function(u){return a=Pr(),o=a.access_token,c=a.refresh_token,l=a.type,(l==="recovery"||l==="invite")&&o&&c?[2,{redirectTo:function(){return{pathname:n?"".concat(n,"/set-password"):"/set-password",search:"access_token=".concat(o,"&refresh_token=").concat(c,"&type=").concat(l)}}}]:[2]})})},checkAuth:function(){return re(this,void 0,void 0,function(){var a,o,c,l,u;return ne(this,function(d){switch(d.label){case 0:if(window.location.pathname==="/set-password"||window.location.hash.includes("#/set-password"))return[2];if(window.location.pathname==="/forgot-password"||window.location.hash.includes("#/forgot-password"))return[2];if(a=Pr(),o=a.access_token,c=a.refresh_token,l=a.type,(l==="recovery"||l==="invite")&&o&&c)throw{redirectTo:function(){return{pathname:n?"".concat(n,"/set-password"):"/set-password",search:"access_token=".concat(o,"&refresh_token=").concat(c,"&type=").concat(l)}},message:!1};return[4,s.auth.getSession()];case 1:return u=d.sent().data,u.session==null?[2,Promise.reject()]:[2,Promise.resolve()]}})})},getPermissions:function(){return re(this,void 0,void 0,function(){var a,o,c,l;return ne(this,function(u){switch(u.label){case 0:return typeof r!="function"?[2]:window.location.pathname==="/set-password"||window.location.hash.includes("#/set-password")||window.location.pathname==="/forgot-password"||window.location.hash.includes("#/forgot-password")?[2]:[4,s.auth.getUser()];case 1:return a=u.sent(),o=a.data,c=a.error,c||o.user==null?[2]:[4,r(o.user)];case 2:return l=u.sent(),[2,l]}})})}};return typeof e=="function"&&(i.getIdentity=function(){return re(void 0,void 0,void 0,function(){var a,o;return ne(this,function(c){switch(c.label){case 0:return[4,s.auth.getUser()];case 1:if(a=c.sent().data,a.user==null)throw new Error;return[4,e(a.user)];case 2:return o=c.sent(),[2,o]}})})}),i},Pr=function(){var s=Gn(),t=new URLSearchParams(s),e=t.get("access_token"),r=t.get("refresh_token"),n=t.get("type");return{access_token:e,refresh_token:r,type:n}},Zt=function(){return Zt=Object.assign||function(s){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s},Zt.apply(this,arguments)},si=function(s,t){var e={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&t.indexOf(r)<0&&(e[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(s);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(s,r[n])&&(e[r[n]]=s[r[n]]);return e},Ar=function(s){return typeof s=="object"&&!Array.isArray(s)&&s!==null},Lt=function(s,t){for(var e=s[t[0]],r=1;r<t.length;++r)e=e[t[r]];return e},er=function(s,t){var e=s.filter,r=s.meta,n=r===void 0?{}:r,i={};return i.filter={},Object.keys(e).forEach(function(a){var o=[a],c;if(a.split("@")[0]!==""&&Ar(e[a])){var l=e[a];do{var u=Lt(e,o),d=Object.keys(u)[0];o.push(d),l=u[d]}while(Ar(l));a=o.join("."),c=[l]}else c=[e[a]];var p=a.split("@"),h=p.length==2?p[1]:t;if(["like","ilike"].includes(h))c=Lt(e,o).trim().split(/\s+/);else if(["or","and"].includes(h)){var y=er({filter:Lt(e,o)},t).filter,b=[];Object.entries(y).forEach(function(f){var m=f[0],w=f[1];Array.isArray(w)?b.push.apply(b,w.map(function(S){return[m,S].join(".")})):b.push([m,w].join("."))}),c=["(".concat(b.join(","),")")]}c.forEach(function(f){var m=function(){return h.length===0?"".concat(f):h.includes("like")?"".concat(h,".*").concat(f,"*"):["and","or"].includes(h)?"".concat(f):"".concat(h,".").concat(f)}();i.filter[p[0]]===void 0?["and","or"].includes(h)?i.filter[h]=m:i.filter[p[0]]=m:Array.isArray(i[p[0]])?i.filter[p[0]].push(m):i.filter[p[0]]=[i.filter[p[0]],m]})}),n!=null&&n.columns&&(i.select=Array.isArray(n.columns)?n.columns.join(","):n.columns),i},ie=function(s,t){return t&&t.get(s)||["id"]},Cr=function(s,t){return mt(t)?JSON.parse(s.toString()):[s.toString()]},yt=function(s,t){return mt(t)?JSON.stringify(t.map(function(e){return s[e]})):s[t[0]]},$r=function(s,t){var e=Zt({},s);return t.forEach(function(r){delete e[r]}),e},xe=function(s,t){return t.length===1&&t[0]==="id"?s:Object.assign(s,{id:yt(s,t)})},Dt=function(s,t){if(t.length===1&&t[0]==="id")return s;s.id;var e=si(s,["id"]);return e},mt=function(s){return s.length>1},_e=function(s,t,e,r){var n,i;r===void 0&&(r=null);var a={};if(Array.isArray(t)&&t.length>1){if(e.startsWith("rpc/")){console.error("PostgREST's rpc endpoints are not intended to be handled as views. Therefore, no query generation for multiple key values implemented!");return}mt(s)?a={or:"(".concat(t.map(function(l){var u=Cr(l,s);return"and(".concat(s.map(function(d,p){return"".concat(d,".eq.").concat(u[p])}).join(","),")")}),")")}:a=(n={},n[s[0]]="in.(".concat(t.join(","),")"),n)}else if(t){var o=t.toString(),c=Cr(o,s);mt(s)?e.startsWith("rpc/")?(a={},s.map(function(l,u){return a[l]="".concat(c[u])})):a={and:"(".concat(s.map(function(l,u){return"".concat(l,".eq.").concat(c[u])}),")")}:a=(i={},i[s[0]]="eq.".concat(o),i)}return r&&r.columns&&(a.select=Array.isArray(r.columns)?r.columns.join(","):r.columns),a},Ut=function(s,t,e,r){r===void 0&&(r="asc,desc");var n=r.split(",")[t==="ASC"?0:1];return s=="id"?e.map(function(i){return"".concat(i,".").concat(n)}).join(","):"".concat(s,".").concat(n)},Mt,jr;function St(){if(jr)return Mt;jr=1;var s=typeof Map=="function"&&Map.prototype,t=Object.getOwnPropertyDescriptor&&s?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,e=s&&t&&typeof t.get=="function"?t.get:null,r=s&&Map.prototype.forEach,n=typeof Set=="function"&&Set.prototype,i=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,a=n&&i&&typeof i.get=="function"?i.get:null,o=n&&Set.prototype.forEach,c=typeof WeakMap=="function"&&WeakMap.prototype,l=c?WeakMap.prototype.has:null,u=typeof WeakSet=="function"&&WeakSet.prototype,d=u?WeakSet.prototype.has:null,p=typeof WeakRef=="function"&&WeakRef.prototype,h=p?WeakRef.prototype.deref:null,y=Boolean.prototype.valueOf,b=Object.prototype.toString,f=Function.prototype.toString,m=String.prototype.match,w=String.prototype.slice,S=String.prototype.replace,_=String.prototype.toUpperCase,k=String.prototype.toLowerCase,O=RegExp.prototype.test,C=Array.prototype.concat,E=Array.prototype.join,I=Array.prototype.slice,P=Math.floor,q=typeof BigInt=="function"?BigInt.prototype.valueOf:null,T=Object.getOwnPropertySymbols,H=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,W=typeof Symbol=="function"&&typeof Symbol.iterator=="object",G=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===W||!0)?Symbol.toStringTag:null,ye=Object.prototype.propertyIsEnumerable,Te=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(v){return v.__proto__}:null);function R(v,g){if(v===1/0||v===-1/0||v!==v||v&&v>-1e3&&v<1e3||O.call(/e/,g))return g;var x=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof v=="number"){var U=v<0?-P(-v):P(v);if(U!==v){var N=String(U),$=w.call(g,N.length+1);return S.call(N,x,"$&_")+"."+S.call(S.call($,/([0-9]{3})/g,"$&_"),/_$/,"")}}return S.call(g,x,"$&_")}var le=Vn,ge=le.custom,We=Qe(ge)?ge:null,Ge={__proto__:null,double:'"',single:"'"},Ot={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};Mt=function v(g,x,U,N){var $=x||{};if(te($,"quoteStyle")&&!te(Ge,$.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(te($,"maxStringLength")&&(typeof $.maxStringLength=="number"?$.maxStringLength<0&&$.maxStringLength!==1/0:$.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var ue=te($,"customInspect")?$.customInspect:!0;if(typeof ue!="boolean"&&ue!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(te($,"indent")&&$.indent!==null&&$.indent!=="	"&&!(parseInt($.indent,10)===$.indent&&$.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(te($,"numericSeparator")&&typeof $.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var we=$.numericSeparator;if(typeof g>"u")return"undefined";if(g===null)return"null";if(typeof g=="boolean")return g?"true":"false";if(typeof g=="string")return yr(g,$);if(typeof g=="number"){if(g===0)return 1/0/g>0?"0":"-0";var J=String(g);return we?R(g,J):J}if(typeof g=="bigint"){var he=String(g)+"n";return we?R(g,he):he}var At=typeof $.depth>"u"?5:$.depth;if(typeof U>"u"&&(U=0),U>=At&&At>0&&typeof g=="object")return Ae(g)?"[Array]":"[Object]";var je=Jn($,U);if(typeof N>"u")N=[];else if(vr(N,g)>=0)return"[Circular]";function V(Re,ut,Wn){if(ut&&(N=I.call(N),N.push(ut)),Wn){var Er={depth:$.depth};return te($,"quoteStyle")&&(Er.quoteStyle=$.quoteStyle),v(Re,Er,U+1,N)}return v(Re,$,U+1,N)}if(typeof g=="function"&&!$e(g)){var mr=Dn(g),wr=lt(g,V);return"[Function"+(mr?": "+mr:" (anonymous)")+"]"+(wr.length>0?" { "+E.call(wr,", ")+" }":"")}if(Qe(g)){var _r=W?S.call(String(g),/^(Symbol\(.*\))_[^)]*$/,"$1"):H.call(g);return typeof g=="object"&&!W?Xe(_r):_r}if(Bn(g)){for(var Ze="<"+k.call(String(g.nodeName)),Ct=g.attributes||[],ct=0;ct<Ct.length;ct++)Ze+=" "+Ct[ct].name+"="+Pe(me(Ct[ct].value),"double",$);return Ze+=">",g.childNodes&&g.childNodes.length&&(Ze+="..."),Ze+="</"+k.call(String(g.nodeName))+">",Ze}if(Ae(g)){if(g.length===0)return"[]";var $t=lt(g,V);return je&&!zn($t)?"["+Pt($t,je)+"]":"[ "+E.call($t,", ")+" ]"}if(ee(g)){var jt=lt(g,V);return!("cause"in Error.prototype)&&"cause"in g&&!ye.call(g,"cause")?"{ ["+String(g)+"] "+E.call(C.call("[cause]: "+V(g.cause),jt),", ")+" }":jt.length===0?"["+String(g)+"]":"{ ["+String(g)+"] "+E.call(jt,", ")+" }"}if(typeof g=="object"&&ue){if(We&&typeof g[We]=="function"&&le)return le(g,{depth:At-U});if(ue!=="symbol"&&typeof g.inspect=="function")return g.inspect()}if(Un(g)){var br=[];return r&&r.call(g,function(Re,ut){br.push(V(ut,g,!0)+" => "+V(Re,g))}),gr("Map",e.call(g),br,je)}if(qn(g)){var Sr=[];return o&&o.call(g,function(Re){Sr.push(V(Re,g))}),gr("Set",a.call(g),Sr,je)}if(Mn(g))return Tt("WeakMap");if(Fn(g))return Tt("WeakSet");if(Nn(g))return Tt("WeakRef");if(Ve(g))return Xe(V(Number(g)));if(Ye(g))return Xe(V(q.call(g)));if(Et(g))return Xe(y.call(g));if(ot(g))return Xe(V(String(g)));if(typeof window<"u"&&g===window)return"{ [object Window] }";if(typeof globalThis<"u"&&g===globalThis||typeof Tr<"u"&&g===Tr)return"{ [object globalThis] }";if(!Ce(g)&&!$e(g)){var Rt=lt(g,V),kr=Te?Te(g)===Object.prototype:g instanceof Object||g.constructor===Object,xt=g instanceof Object?"":"null prototype",Or=!kr&&G&&Object(g)===g&&G in g?w.call(ce(g),8,-1):xt?"Object":"",Kn=kr||typeof g.constructor!="function"?"":g.constructor.name?g.constructor.name+" ":"",It=Kn+(Or||xt?"["+E.call(C.call([],Or||[],xt||[]),": ")+"] ":"");return Rt.length===0?It+"{}":je?It+"{"+Pt(Rt,je)+"}":It+"{ "+E.call(Rt,", ")+" }"}return String(g)};function Pe(v,g,x){var U=x.quoteStyle||g,N=Ge[U];return N+v+N}function me(v){return S.call(String(v),/"/g,"&quot;")}function Y(v){return!G||!(typeof v=="object"&&(G in v||typeof v[G]<"u"))}function Ae(v){return ce(v)==="[object Array]"&&Y(v)}function Ce(v){return ce(v)==="[object Date]"&&Y(v)}function $e(v){return ce(v)==="[object RegExp]"&&Y(v)}function ee(v){return ce(v)==="[object Error]"&&Y(v)}function ot(v){return ce(v)==="[object String]"&&Y(v)}function Ve(v){return ce(v)==="[object Number]"&&Y(v)}function Et(v){return ce(v)==="[object Boolean]"&&Y(v)}function Qe(v){if(W)return v&&typeof v=="object"&&v instanceof Symbol;if(typeof v=="symbol")return!0;if(!v||typeof v!="object"||!H)return!1;try{return H.call(v),!0}catch{}return!1}function Ye(v){if(!v||typeof v!="object"||!q)return!1;try{return q.call(v),!0}catch{}return!1}var Ln=Object.prototype.hasOwnProperty||function(v){return v in this};function te(v,g){return Ln.call(v,g)}function ce(v){return b.call(v)}function Dn(v){if(v.name)return v.name;var g=m.call(f.call(v),/^function\s*([\w$]+)/);return g?g[1]:null}function vr(v,g){if(v.indexOf)return v.indexOf(g);for(var x=0,U=v.length;x<U;x++)if(v[x]===g)return x;return-1}function Un(v){if(!e||!v||typeof v!="object")return!1;try{e.call(v);try{a.call(v)}catch{return!0}return v instanceof Map}catch{}return!1}function Mn(v){if(!l||!v||typeof v!="object")return!1;try{l.call(v,l);try{d.call(v,d)}catch{return!0}return v instanceof WeakMap}catch{}return!1}function Nn(v){if(!h||!v||typeof v!="object")return!1;try{return h.call(v),!0}catch{}return!1}function qn(v){if(!a||!v||typeof v!="object")return!1;try{a.call(v);try{e.call(v)}catch{return!0}return v instanceof Set}catch{}return!1}function Fn(v){if(!d||!v||typeof v!="object")return!1;try{d.call(v,d);try{l.call(v,l)}catch{return!0}return v instanceof WeakSet}catch{}return!1}function Bn(v){return!v||typeof v!="object"?!1:typeof HTMLElement<"u"&&v instanceof HTMLElement?!0:typeof v.nodeName=="string"&&typeof v.getAttribute=="function"}function yr(v,g){if(v.length>g.maxStringLength){var x=v.length-g.maxStringLength,U="... "+x+" more character"+(x>1?"s":"");return yr(w.call(v,0,g.maxStringLength),g)+U}var N=Ot[g.quoteStyle||"single"];N.lastIndex=0;var $=S.call(S.call(v,N,"\\$1"),/[\x00-\x1f]/g,Hn);return Pe($,"single",g)}function Hn(v){var g=v.charCodeAt(0),x={8:"b",9:"t",10:"n",12:"f",13:"r"}[g];return x?"\\"+x:"\\x"+(g<16?"0":"")+_.call(g.toString(16))}function Xe(v){return"Object("+v+")"}function Tt(v){return v+" { ? }"}function gr(v,g,x,U){var N=U?Pt(x,U):E.call(x,", ");return v+" ("+g+") {"+N+"}"}function zn(v){for(var g=0;g<v.length;g++)if(vr(v[g],`
`)>=0)return!1;return!0}function Jn(v,g){var x;if(v.indent==="	")x="	";else if(typeof v.indent=="number"&&v.indent>0)x=E.call(Array(v.indent+1)," ");else return null;return{base:x,prev:E.call(Array(g+1),x)}}function Pt(v,g){if(v.length===0)return"";var x=`
`+g.prev+g.base;return x+E.call(v,","+x)+`
`+g.prev}function lt(v,g){var x=Ae(v),U=[];if(x){U.length=v.length;for(var N=0;N<v.length;N++)U[N]=te(v,N)?g(v[N],v):""}var $=typeof T=="function"?T(v):[],ue;if(W){ue={};for(var we=0;we<$.length;we++)ue["$"+$[we]]=$[we]}for(var J in v)te(v,J)&&(x&&String(Number(J))===J&&J<v.length||W&&ue["$"+J]instanceof Symbol||(O.call(/[^\w$]/,J)?U.push(g(J,v)+": "+g(v[J],v)):U.push(J+": "+g(v[J],v))));if(typeof T=="function")for(var he=0;he<$.length;he++)ye.call(v,$[he])&&U.push("["+g($[he])+"]: "+g(v[$[he]],v));return U}return Mt}var Nt,Rr;function ai(){if(Rr)return Nt;Rr=1;var s=St(),t=bt(),e=function(o,c,l){for(var u=o,d;(d=u.next)!=null;u=d)if(d.key===c)return u.next=d.next,l||(d.next=o.next,o.next=d),d},r=function(o,c){if(o){var l=e(o,c);return l&&l.value}},n=function(o,c,l){var u=e(o,c);u?u.value=l:o.next={key:c,next:o.next,value:l}},i=function(o,c){return o?!!e(o,c):!1},a=function(o,c){if(o)return e(o,c,!0)};return Nt=function(){var c,l={assert:function(u){if(!l.has(u))throw new t("Side channel does not contain "+s(u))},delete:function(u){var d=c&&c.next,p=a(c,u);return p&&d&&d===p&&(c=void 0),!!p},get:function(u){return r(c,u)},has:function(u){return i(c,u)},set:function(u,d){c||(c={next:void 0}),n(c,u,d)}};return l},Nt}var qt,xr;function dn(){if(xr)return qt;xr=1;var s=cn(),t=un(),e=St(),r=bt(),n=s("%Map%",!0),i=t("Map.prototype.get",!0),a=t("Map.prototype.set",!0),o=t("Map.prototype.has",!0),c=t("Map.prototype.delete",!0),l=t("Map.prototype.size",!0);return qt=!!n&&function(){var d,p={assert:function(h){if(!p.has(h))throw new r("Side channel does not contain "+e(h))},delete:function(h){if(d){var y=c(d,h);return l(d)===0&&(d=void 0),y}return!1},get:function(h){if(d)return i(d,h)},has:function(h){return d?o(d,h):!1},set:function(h,y){d||(d=new n),a(d,h,y)}};return p},qt}var Ft,Ir;function oi(){if(Ir)return Ft;Ir=1;var s=cn(),t=un(),e=St(),r=dn(),n=bt(),i=s("%WeakMap%",!0),a=t("WeakMap.prototype.get",!0),o=t("WeakMap.prototype.set",!0),c=t("WeakMap.prototype.has",!0),l=t("WeakMap.prototype.delete",!0);return Ft=i?function(){var d,p,h={assert:function(y){if(!h.has(y))throw new n("Side channel does not contain "+e(y))},delete:function(y){if(i&&y&&(typeof y=="object"||typeof y=="function")){if(d)return l(d,y)}else if(r&&p)return p.delete(y);return!1},get:function(y){return i&&y&&(typeof y=="object"||typeof y=="function")&&d?a(d,y):p&&p.get(y)},has:function(y){return i&&y&&(typeof y=="object"||typeof y=="function")&&d?c(d,y):!!p&&p.has(y)},set:function(y,b){i&&y&&(typeof y=="object"||typeof y=="function")?(d||(d=new i),o(d,y,b)):r&&(p||(p=r()),p.set(y,b))}};return h}:r,Ft}var Bt,Lr;function li(){if(Lr)return Bt;Lr=1;var s=bt(),t=St(),e=ai(),r=dn(),n=oi(),i=n||r||e;return Bt=function(){var o,c={assert:function(l){if(!c.has(l))throw new s("Side channel does not contain "+t(l))},delete:function(l){return!!o&&o.delete(l)},get:function(l){return o&&o.get(l)},has:function(l){return!!o&&o.has(l)},set:function(l,u){o||(o=i()),o.set(l,u)}};return c},Bt}var Ht,Dr;function cr(){if(Dr)return Ht;Dr=1;var s=String.prototype.replace,t=/%20/g,e={RFC1738:"RFC1738",RFC3986:"RFC3986"};return Ht={default:e.RFC3986,formatters:{RFC1738:function(r){return s.call(r,t,"+")},RFC3986:function(r){return String(r)}},RFC1738:e.RFC1738,RFC3986:e.RFC3986},Ht}var zt,Ur;function fn(){if(Ur)return zt;Ur=1;var s=cr(),t=Object.prototype.hasOwnProperty,e=Array.isArray,r=function(){for(var f=[],m=0;m<256;++m)f.push("%"+((m<16?"0":"")+m.toString(16)).toUpperCase());return f}(),n=function(m){for(;m.length>1;){var w=m.pop(),S=w.obj[w.prop];if(e(S)){for(var _=[],k=0;k<S.length;++k)typeof S[k]<"u"&&_.push(S[k]);w.obj[w.prop]=_}}},i=function(m,w){for(var S=w&&w.plainObjects?{__proto__:null}:{},_=0;_<m.length;++_)typeof m[_]<"u"&&(S[_]=m[_]);return S},a=function f(m,w,S){if(!w)return m;if(typeof w!="object"&&typeof w!="function"){if(e(m))m.push(w);else if(m&&typeof m=="object")(S&&(S.plainObjects||S.allowPrototypes)||!t.call(Object.prototype,w))&&(m[w]=!0);else return[m,w];return m}if(!m||typeof m!="object")return[m].concat(w);var _=m;return e(m)&&!e(w)&&(_=i(m,S)),e(m)&&e(w)?(w.forEach(function(k,O){if(t.call(m,O)){var C=m[O];C&&typeof C=="object"&&k&&typeof k=="object"?m[O]=f(C,k,S):m.push(k)}else m[O]=k}),m):Object.keys(w).reduce(function(k,O){var C=w[O];return t.call(k,O)?k[O]=f(k[O],C,S):k[O]=C,k},_)},o=function(m,w){return Object.keys(w).reduce(function(S,_){return S[_]=w[_],S},m)},c=function(f,m,w){var S=f.replace(/\+/g," ");if(w==="iso-8859-1")return S.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(S)}catch{return S}},l=1024,u=function(m,w,S,_,k){if(m.length===0)return m;var O=m;if(typeof m=="symbol"?O=Symbol.prototype.toString.call(m):typeof m!="string"&&(O=String(m)),S==="iso-8859-1")return escape(O).replace(/%u[0-9a-f]{4}/gi,function(H){return"%26%23"+parseInt(H.slice(2),16)+"%3B"});for(var C="",E=0;E<O.length;E+=l){for(var I=O.length>=l?O.slice(E,E+l):O,P=[],q=0;q<I.length;++q){var T=I.charCodeAt(q);if(T===45||T===46||T===95||T===126||T>=48&&T<=57||T>=65&&T<=90||T>=97&&T<=122||k===s.RFC1738&&(T===40||T===41)){P[P.length]=I.charAt(q);continue}if(T<128){P[P.length]=r[T];continue}if(T<2048){P[P.length]=r[192|T>>6]+r[128|T&63];continue}if(T<55296||T>=57344){P[P.length]=r[224|T>>12]+r[128|T>>6&63]+r[128|T&63];continue}q+=1,T=65536+((T&1023)<<10|I.charCodeAt(q)&1023),P[P.length]=r[240|T>>18]+r[128|T>>12&63]+r[128|T>>6&63]+r[128|T&63]}C+=P.join("")}return C},d=function(m){for(var w=[{obj:{o:m},prop:"o"}],S=[],_=0;_<w.length;++_)for(var k=w[_],O=k.obj[k.prop],C=Object.keys(O),E=0;E<C.length;++E){var I=C[E],P=O[I];typeof P=="object"&&P!==null&&S.indexOf(P)===-1&&(w.push({obj:O,prop:I}),S.push(P))}return n(w),m},p=function(m){return Object.prototype.toString.call(m)==="[object RegExp]"},h=function(m){return!m||typeof m!="object"?!1:!!(m.constructor&&m.constructor.isBuffer&&m.constructor.isBuffer(m))},y=function(m,w){return[].concat(m,w)},b=function(m,w){if(e(m)){for(var S=[],_=0;_<m.length;_+=1)S.push(w(m[_]));return S}return w(m)};return zt={arrayToObject:i,assign:o,combine:y,compact:d,decode:c,encode:u,isBuffer:h,isRegExp:p,maybeMap:b,merge:a},zt}var Jt,Mr;function ci(){if(Mr)return Jt;Mr=1;var s=li(),t=fn(),e=cr(),r=Object.prototype.hasOwnProperty,n={brackets:function(f){return f+"[]"},comma:"comma",indices:function(f,m){return f+"["+m+"]"},repeat:function(f){return f}},i=Array.isArray,a=Array.prototype.push,o=function(b,f){a.apply(b,i(f)?f:[f])},c=Date.prototype.toISOString,l=e.default,u={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:t.encode,encodeValuesOnly:!1,filter:void 0,format:l,formatter:e.formatters[l],indices:!1,serializeDate:function(f){return c.call(f)},skipNulls:!1,strictNullHandling:!1},d=function(f){return typeof f=="string"||typeof f=="number"||typeof f=="boolean"||typeof f=="symbol"||typeof f=="bigint"},p={},h=function b(f,m,w,S,_,k,O,C,E,I,P,q,T,H,W,G,ye,Te){for(var R=f,le=Te,ge=0,We=!1;(le=le.get(p))!==void 0&&!We;){var Ge=le.get(f);if(ge+=1,typeof Ge<"u"){if(Ge===ge)throw new RangeError("Cyclic object value");We=!0}typeof le.get(p)>"u"&&(ge=0)}if(typeof I=="function"?R=I(m,R):R instanceof Date?R=T(R):w==="comma"&&i(R)&&(R=t.maybeMap(R,function(Ye){return Ye instanceof Date?T(Ye):Ye})),R===null){if(k)return E&&!G?E(m,u.encoder,ye,"key",H):m;R=""}if(d(R)||t.isBuffer(R)){if(E){var Ot=G?m:E(m,u.encoder,ye,"key",H);return[W(Ot)+"="+W(E(R,u.encoder,ye,"value",H))]}return[W(m)+"="+W(String(R))]}var Pe=[];if(typeof R>"u")return Pe;var me;if(w==="comma"&&i(R))G&&E&&(R=t.maybeMap(R,E)),me=[{value:R.length>0?R.join(",")||null:void 0}];else if(i(I))me=I;else{var Y=Object.keys(R);me=P?Y.sort(P):Y}var Ae=C?String(m).replace(/\./g,"%2E"):String(m),Ce=S&&i(R)&&R.length===1?Ae+"[]":Ae;if(_&&i(R)&&R.length===0)return Ce+"[]";for(var $e=0;$e<me.length;++$e){var ee=me[$e],ot=typeof ee=="object"&&ee&&typeof ee.value<"u"?ee.value:R[ee];if(!(O&&ot===null)){var Ve=q&&C?String(ee).replace(/\./g,"%2E"):String(ee),Et=i(R)?typeof w=="function"?w(Ce,Ve):Ce:Ce+(q?"."+Ve:"["+Ve+"]");Te.set(f,ge);var Qe=s();Qe.set(p,Te),o(Pe,b(ot,Et,w,S,_,k,O,C,w==="comma"&&G&&i(R)?null:E,I,P,q,T,H,W,G,ye,Qe))}}return Pe},y=function(f){if(!f)return u;if(typeof f.allowEmptyArrays<"u"&&typeof f.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof f.encodeDotInKeys<"u"&&typeof f.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(f.encoder!==null&&typeof f.encoder<"u"&&typeof f.encoder!="function")throw new TypeError("Encoder has to be a function.");var m=f.charset||u.charset;if(typeof f.charset<"u"&&f.charset!=="utf-8"&&f.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var w=e.default;if(typeof f.format<"u"){if(!r.call(e.formatters,f.format))throw new TypeError("Unknown format option provided.");w=f.format}var S=e.formatters[w],_=u.filter;(typeof f.filter=="function"||i(f.filter))&&(_=f.filter);var k;if(f.arrayFormat in n?k=f.arrayFormat:"indices"in f?k=f.indices?"indices":"repeat":k=u.arrayFormat,"commaRoundTrip"in f&&typeof f.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var O=typeof f.allowDots>"u"?f.encodeDotInKeys===!0?!0:u.allowDots:!!f.allowDots;return{addQueryPrefix:typeof f.addQueryPrefix=="boolean"?f.addQueryPrefix:u.addQueryPrefix,allowDots:O,allowEmptyArrays:typeof f.allowEmptyArrays=="boolean"?!!f.allowEmptyArrays:u.allowEmptyArrays,arrayFormat:k,charset:m,charsetSentinel:typeof f.charsetSentinel=="boolean"?f.charsetSentinel:u.charsetSentinel,commaRoundTrip:!!f.commaRoundTrip,delimiter:typeof f.delimiter>"u"?u.delimiter:f.delimiter,encode:typeof f.encode=="boolean"?f.encode:u.encode,encodeDotInKeys:typeof f.encodeDotInKeys=="boolean"?f.encodeDotInKeys:u.encodeDotInKeys,encoder:typeof f.encoder=="function"?f.encoder:u.encoder,encodeValuesOnly:typeof f.encodeValuesOnly=="boolean"?f.encodeValuesOnly:u.encodeValuesOnly,filter:_,format:w,formatter:S,serializeDate:typeof f.serializeDate=="function"?f.serializeDate:u.serializeDate,skipNulls:typeof f.skipNulls=="boolean"?f.skipNulls:u.skipNulls,sort:typeof f.sort=="function"?f.sort:null,strictNullHandling:typeof f.strictNullHandling=="boolean"?f.strictNullHandling:u.strictNullHandling}};return Jt=function(b,f){var m=b,w=y(f),S,_;typeof w.filter=="function"?(_=w.filter,m=_("",m)):i(w.filter)&&(_=w.filter,S=_);var k=[];if(typeof m!="object"||m===null)return"";var O=n[w.arrayFormat],C=O==="comma"&&w.commaRoundTrip;S||(S=Object.keys(m)),w.sort&&S.sort(w.sort);for(var E=s(),I=0;I<S.length;++I){var P=S[I],q=m[P];w.skipNulls&&q===null||o(k,h(q,P,O,C,w.allowEmptyArrays,w.strictNullHandling,w.skipNulls,w.encodeDotInKeys,w.encode?w.encoder:null,w.filter,w.sort,w.allowDots,w.serializeDate,w.format,w.formatter,w.encodeValuesOnly,w.charset,E))}var T=k.join(w.delimiter),H=w.addQueryPrefix===!0?"?":"";return w.charsetSentinel&&(w.charset==="iso-8859-1"?H+="utf8=%26%2310003%3B&":H+="utf8=%E2%9C%93&"),T.length>0?H+T:""},Jt}var Kt,Nr;function ui(){if(Nr)return Kt;Nr=1;var s=fn(),t=Object.prototype.hasOwnProperty,e=Array.isArray,r={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:s.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},n=function(p){return p.replace(/&#(\d+);/g,function(h,y){return String.fromCharCode(parseInt(y,10))})},i=function(p,h,y){if(p&&typeof p=="string"&&h.comma&&p.indexOf(",")>-1)return p.split(",");if(h.throwOnLimitExceeded&&y>=h.arrayLimit)throw new RangeError("Array limit exceeded. Only "+h.arrayLimit+" element"+(h.arrayLimit===1?"":"s")+" allowed in an array.");return p},a="utf8=%26%2310003%3B",o="utf8=%E2%9C%93",c=function(h,y){var b={__proto__:null},f=y.ignoreQueryPrefix?h.replace(/^\?/,""):h;f=f.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var m=y.parameterLimit===1/0?void 0:y.parameterLimit,w=f.split(y.delimiter,y.throwOnLimitExceeded?m+1:m);if(y.throwOnLimitExceeded&&w.length>m)throw new RangeError("Parameter limit exceeded. Only "+m+" parameter"+(m===1?"":"s")+" allowed.");var S=-1,_,k=y.charset;if(y.charsetSentinel)for(_=0;_<w.length;++_)w[_].indexOf("utf8=")===0&&(w[_]===o?k="utf-8":w[_]===a&&(k="iso-8859-1"),S=_,_=w.length);for(_=0;_<w.length;++_)if(_!==S){var O=w[_],C=O.indexOf("]="),E=C===-1?O.indexOf("="):C+1,I,P;E===-1?(I=y.decoder(O,r.decoder,k,"key"),P=y.strictNullHandling?null:""):(I=y.decoder(O.slice(0,E),r.decoder,k,"key"),P=s.maybeMap(i(O.slice(E+1),y,e(b[I])?b[I].length:0),function(T){return y.decoder(T,r.decoder,k,"value")})),P&&y.interpretNumericEntities&&k==="iso-8859-1"&&(P=n(String(P))),O.indexOf("[]=")>-1&&(P=e(P)?[P]:P);var q=t.call(b,I);q&&y.duplicates==="combine"?b[I]=s.combine(b[I],P):(!q||y.duplicates==="last")&&(b[I]=P)}return b},l=function(p,h,y,b){var f=0;if(p.length>0&&p[p.length-1]==="[]"){var m=p.slice(0,-1).join("");f=Array.isArray(h)&&h[m]?h[m].length:0}for(var w=b?h:i(h,y,f),S=p.length-1;S>=0;--S){var _,k=p[S];if(k==="[]"&&y.parseArrays)_=y.allowEmptyArrays&&(w===""||y.strictNullHandling&&w===null)?[]:s.combine([],w);else{_=y.plainObjects?{__proto__:null}:{};var O=k.charAt(0)==="["&&k.charAt(k.length-1)==="]"?k.slice(1,-1):k,C=y.decodeDotInKeys?O.replace(/%2E/g,"."):O,E=parseInt(C,10);!y.parseArrays&&C===""?_={0:w}:!isNaN(E)&&k!==C&&String(E)===C&&E>=0&&y.parseArrays&&E<=y.arrayLimit?(_=[],_[E]=w):C!=="__proto__"&&(_[C]=w)}w=_}return w},u=function(h,y,b,f){if(h){var m=b.allowDots?h.replace(/\.([^.[]+)/g,"[$1]"):h,w=/(\[[^[\]]*])/,S=/(\[[^[\]]*])/g,_=b.depth>0&&w.exec(m),k=_?m.slice(0,_.index):m,O=[];if(k){if(!b.plainObjects&&t.call(Object.prototype,k)&&!b.allowPrototypes)return;O.push(k)}for(var C=0;b.depth>0&&(_=S.exec(m))!==null&&C<b.depth;){if(C+=1,!b.plainObjects&&t.call(Object.prototype,_[1].slice(1,-1))&&!b.allowPrototypes)return;O.push(_[1])}if(_){if(b.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+b.depth+" and strictDepth is true");O.push("["+m.slice(_.index)+"]")}return l(O,y,b,f)}},d=function(h){if(!h)return r;if(typeof h.allowEmptyArrays<"u"&&typeof h.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof h.decodeDotInKeys<"u"&&typeof h.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(h.decoder!==null&&typeof h.decoder<"u"&&typeof h.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof h.charset<"u"&&h.charset!=="utf-8"&&h.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof h.throwOnLimitExceeded<"u"&&typeof h.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var y=typeof h.charset>"u"?r.charset:h.charset,b=typeof h.duplicates>"u"?r.duplicates:h.duplicates;if(b!=="combine"&&b!=="first"&&b!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var f=typeof h.allowDots>"u"?h.decodeDotInKeys===!0?!0:r.allowDots:!!h.allowDots;return{allowDots:f,allowEmptyArrays:typeof h.allowEmptyArrays=="boolean"?!!h.allowEmptyArrays:r.allowEmptyArrays,allowPrototypes:typeof h.allowPrototypes=="boolean"?h.allowPrototypes:r.allowPrototypes,allowSparse:typeof h.allowSparse=="boolean"?h.allowSparse:r.allowSparse,arrayLimit:typeof h.arrayLimit=="number"?h.arrayLimit:r.arrayLimit,charset:y,charsetSentinel:typeof h.charsetSentinel=="boolean"?h.charsetSentinel:r.charsetSentinel,comma:typeof h.comma=="boolean"?h.comma:r.comma,decodeDotInKeys:typeof h.decodeDotInKeys=="boolean"?h.decodeDotInKeys:r.decodeDotInKeys,decoder:typeof h.decoder=="function"?h.decoder:r.decoder,delimiter:typeof h.delimiter=="string"||s.isRegExp(h.delimiter)?h.delimiter:r.delimiter,depth:typeof h.depth=="number"||h.depth===!1?+h.depth:r.depth,duplicates:b,ignoreQueryPrefix:h.ignoreQueryPrefix===!0,interpretNumericEntities:typeof h.interpretNumericEntities=="boolean"?h.interpretNumericEntities:r.interpretNumericEntities,parameterLimit:typeof h.parameterLimit=="number"?h.parameterLimit:r.parameterLimit,parseArrays:h.parseArrays!==!1,plainObjects:typeof h.plainObjects=="boolean"?h.plainObjects:r.plainObjects,strictDepth:typeof h.strictDepth=="boolean"?!!h.strictDepth:r.strictDepth,strictNullHandling:typeof h.strictNullHandling=="boolean"?h.strictNullHandling:r.strictNullHandling,throwOnLimitExceeded:typeof h.throwOnLimitExceeded=="boolean"?h.throwOnLimitExceeded:!1}};return Kt=function(p,h){var y=d(h);if(p===""||p===null||typeof p>"u")return y.plainObjects?{__proto__:null}:{};for(var b=typeof p=="string"?c(p,y):p,f=y.plainObjects?{__proto__:null}:{},m=Object.keys(b),w=0;w<m.length;++w){var S=m[w],_=u(S,b[S],y,typeof p=="string");f=s.merge(f,_,y)}return y.allowSparse===!0?f:s.compact(f)},Kt}var Wt,qr;function hi(){if(qr)return Wt;qr=1;var s=ci(),t=ui(),e=cr();return Wt={formats:e,parse:t,stringify:s},Wt}var di=hi();const se=hn(di);var D=function(){return D=Object.assign||function(s){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s},D.apply(this,arguments)},fi=new Map,pi=function(){return""},ae=function(s,t,e){var r,n=s;if(t!==void 0&&(n=function(){return t}),n().length>0){var i="";if(["GET","HEAD"].includes(e))i="Accept-Profile";else if(["POST","PATCH","PUT","DELETE"].includes(e))i="Content-Profile";else return{};return r={},r[i]=n(),r}else return{}};const vi=function(s){return{getList:function(t,e){var r,n,i,a,o,c;e===void 0&&(e={});var l=ie(t,s.primaryKeys),u=e.pagination,d=u.page,p=u.perPage,h=e.sort||{},y=h.field,b=h.order,f=er(e,s.defaultListOp),m=f.filter,w=f.select,S=(r=e.meta)===null||r===void 0?void 0:r.schema,_=D({offset:String((d-1)*p),limit:String(p)},m);y&&(_.order=Ut(y,b,l,s.sortOrder),!((n=e.meta)===null||n===void 0)&&n.nullsfirst&&!_.order.includes("nullsfirst")&&(_.order=_.order.includes("nullslast")?_.order.replace("nullslast","nullsfirst"):"".concat(_.order,".nullsfirst")),((i=e.meta)===null||i===void 0?void 0:i.nullsfirst)===!1&&_.order.includes("nullsfirst")&&(_.order=_.order.replace(".nullsfirst","")),!((a=e.meta)===null||a===void 0)&&a.nullslast&&!_.order.includes("nullslast")&&(_.order=_.order.includes("nullsfirst")?_.order.replace("nullsfirst","nullslast"):"".concat(_.order,".nullslast")),((o=e.meta)===null||o===void 0?void 0:o.nullslast)===!1&&_.order.includes("nullslast")&&(_.order=_.order.replace(".nullslast",""))),w&&(_.select=w);var k={headers:new Headers(D(D({Accept:"application/json",Prefer:"count=exact"},((c=e.meta)===null||c===void 0?void 0:c.headers)||{}),ae(s.schema,S,"GET")))},O="".concat(s.apiUrl,"/").concat(t,"?").concat(se.stringify(_));return s.httpClient(O,k).then(function(C){var E=C.headers,I=C.json;if(!E.has("content-range"))throw new Error(`The Content-Range header is missing in the HTTP Response. The postgREST data provider expects
          responses for lists of resources to contain this header with the total number of results to build
          the pagination. If you are using CORS, did you declare Content-Range in the Access-Control-Expose-Headers header?`);return{data:I.map(function(P){return xe(P,l)}),total:parseInt(E.get("content-range").split("/").pop(),10)}})},getOne:function(t,e){var r,n;e===void 0&&(e={});var i=e.id,a=e.meta,o=ie(t,s.primaryKeys),c=_e(o,i,t,a),l="".concat(s.apiUrl,"/").concat(t,"?").concat(se.stringify(c)),u=(r=e.meta)===null||r===void 0?void 0:r.schema;return s.httpClient(l,{headers:new Headers(D(D({accept:"application/vnd.pgrst.object+json"},((n=e.meta)===null||n===void 0?void 0:n.headers)||{}),ae(s.schema,u,"GET")))}).then(function(d){var p=d.json;return{data:xe(p,o)}})},getMany:function(t,e){var r;e===void 0&&(e={});var n=e.ids;if(n.length===0)return Promise.resolve({data:[]});var i=ie(t,s.primaryKeys),a=_e(i,n,t,e.meta),o="".concat(s.apiUrl,"/").concat(t,"?").concat(se.stringify(a)),c=(r=e.meta)===null||r===void 0?void 0:r.schema;return s.httpClient(o,{headers:new Headers(D({},ae(s.schema,c,"GET")))}).then(function(l){var u=l.json;return{data:u.map(function(d){return xe(d,i)})}})},getManyReference:function(t,e){var r,n,i;e===void 0&&(e={});var a=e.pagination,o=a.page,c=a.perPage,l=e.sort,u=l.field,d=l.order,p=er(e,s.defaultListOp),h=p.filter,y=p.select,b=ie(t,s.primaryKeys),f=(n=e.meta)===null||n===void 0?void 0:n.schema,m=e.target?D((r={},r[e.target]="eq.".concat(e.id),r.order=Ut(u,d,b,s.sortOrder),r.offset=String((o-1)*c),r.limit=String(c),r),h):D({order:Ut(u,d,b),offset:String((o-1)*c),limit:String(c)},h);y&&(m.select=y);var w={headers:new Headers(D(D({Accept:"application/json",Prefer:"count=exact"},((i=e.meta)===null||i===void 0?void 0:i.headers)||{}),ae(s.schema,f,"GET")))},S="".concat(s.apiUrl,"/").concat(t,"?").concat(se.stringify(m));return s.httpClient(S,w).then(function(_){var k=_.headers,O=_.json;if(!k.has("content-range"))throw new Error(`The Content-Range header is missing in the HTTP Response. The postgREST data provider expects
          responses for lists of resources to contain this header with the total number of results to build
          the pagination. If you are using CORS, did you declare Content-Range in the Access-Control-Expose-Headers header?`);return{data:O.map(function(C){return xe(C,b)}),total:parseInt(k.get("content-range").split("/").pop(),10)}})},update:function(t,e){var r,n;e===void 0&&(e={});var i=e.id,a=e.data,o=e.meta,c=e.previousData,l=ie(t,s.primaryKeys),u=_e(l,i,t,o),d="".concat(s.apiUrl,"/").concat(t,"?").concat(se.stringify(u)),p=yi(a,c);if(Object.keys(p).length===0)return Promise.resolve({data:D({},c)});var h=(r=e.meta)===null||r===void 0?void 0:r.schema,y=JSON.stringify(D({},Dt($r(p,l),l)));return s.httpClient(d,{method:"PATCH",headers:new Headers(D(D({Accept:"application/vnd.pgrst.object+json",Prefer:"return=representation","Content-Type":"application/json"},((n=e.meta)===null||n===void 0?void 0:n.headers)||{}),ae(s.schema,h,"PATCH"))),body:y}).then(function(b){var f=b.json;return{data:xe(f,l)}})},updateMany:function(t,e){var r,n;e===void 0&&(e={});var i=e.ids,a=e.meta,o=e.data,c=ie(t,s.primaryKeys),l=_e(c,i,t,a),u="".concat(s.apiUrl,"/").concat(t,"?").concat(se.stringify(l)),d=JSON.stringify(D({},Dt($r(o,c),c))),p=(r=e.meta)===null||r===void 0?void 0:r.schema;return s.httpClient(u,{method:"PATCH",headers:new Headers(D(D({Prefer:"return=representation","Content-Type":"application/json"},((n=e.meta)===null||n===void 0?void 0:n.headers)||{}),ae(s.schema,p,"PATCH"))),body:d}).then(function(h){var y=h.json;return{data:y.map(function(b){return yt(b,c)})}})},create:function(t,e){var r,n;e===void 0&&(e={});var i=e.meta,a=ie(t,s.primaryKeys),o=_e(a,void 0,t,i),c=se.stringify(o),l="".concat(s.apiUrl,"/").concat(t).concat(c.length>0?"?":"").concat(c),u=(r=e.meta)===null||r===void 0?void 0:r.schema;return s.httpClient(l,{method:"POST",headers:new Headers(D(D({Accept:"application/vnd.pgrst.object+json",Prefer:"return=representation","Content-Type":"application/json"},((n=e.meta)===null||n===void 0?void 0:n.headers)||{}),ae(s.schema,u,"POST"))),body:JSON.stringify(Dt(e.data,a))}).then(function(d){var p=d.json;return{data:D(D({},p),{id:yt(p,a)})}})},delete:function(t,e){var r,n;e===void 0&&(e={});var i=e.id,a=e.meta,o=ie(t,s.primaryKeys),c=_e(o,i,t,a),l="".concat(s.apiUrl,"/").concat(t,"?").concat(se.stringify(c)),u=(r=e.meta)===null||r===void 0?void 0:r.schema;return s.httpClient(l,{method:"DELETE",headers:new Headers(D(D({Accept:"application/vnd.pgrst.object+json",Prefer:"return=representation","Content-Type":"application/json"},((n=e.meta)===null||n===void 0?void 0:n.headers)||{}),ae(s.schema,u,"DELETE")))}).then(function(d){var p=d.json;return{data:xe(p,o)}})},deleteMany:function(t,e){var r,n;e===void 0&&(e={});var i=e.ids,a=e.meta,o=ie(t,s.primaryKeys),c=_e(o,i,t,a),l="".concat(s.apiUrl,"/").concat(t,"?").concat(se.stringify(c)),u=(r=e.meta)===null||r===void 0?void 0:r.schema;return s.httpClient(l,{method:"DELETE",headers:new Headers(D(D({Prefer:"return=representation","Content-Type":"application/json"},((n=e.meta)===null||n===void 0?void 0:n.headers)||{}),ae(s.schema,u,"DELETE")))}).then(function(d){var p=d.json;return{data:p.map(function(h){return yt(h,o)})}})}}};var yi=function(s,t){var e=Object.keys(s).reduce(function(r,n){return Qn(s[n],t[n])||(r[n]=s[n]),r},{});return e};const gi=s=>{let t;return s?t=s:typeof fetch>"u"?t=(...e)=>ze(async()=>{const{default:r}=await Promise.resolve().then(()=>Ke);return{default:r}},void 0,import.meta.url).then(({default:r})=>r(...e)):t=fetch,(...e)=>t(...e)};class ur extends Error{constructor(t,e="FunctionsError",r){super(t),this.name=e,this.context=r}}class mi extends ur{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class wi extends ur{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class _i extends ur{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var tr;(function(s){s.Any="any",s.ApNortheast1="ap-northeast-1",s.ApNortheast2="ap-northeast-2",s.ApSouth1="ap-south-1",s.ApSoutheast1="ap-southeast-1",s.ApSoutheast2="ap-southeast-2",s.CaCentral1="ca-central-1",s.EuCentral1="eu-central-1",s.EuWest1="eu-west-1",s.EuWest2="eu-west-2",s.EuWest3="eu-west-3",s.SaEast1="sa-east-1",s.UsEast1="us-east-1",s.UsWest1="us-west-1",s.UsWest2="us-west-2"})(tr||(tr={}));var bi=function(s,t,e,r){function n(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function o(u){try{l(r.next(u))}catch(d){a(d)}}function c(u){try{l(r.throw(u))}catch(d){a(d)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((r=r.apply(s,t||[])).next())})};class Si{constructor(t,{headers:e={},customFetch:r,region:n=tr.Any}={}){this.url=t,this.headers=e,this.region=n,this.fetch=gi(r)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t,e={}){var r;return bi(this,void 0,void 0,function*(){try{const{headers:n,method:i,body:a}=e;let o={},{region:c}=e;c||(c=this.region),c&&c!=="any"&&(o["x-region"]=c);let l;a&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",l=a):typeof a=="string"?(o["Content-Type"]="text/plain",l=a):typeof FormData<"u"&&a instanceof FormData?l=a:(o["Content-Type"]="application/json",l=JSON.stringify(a)));const u=yield this.fetch(`${this.url}/${t}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),n),body:l}).catch(y=>{throw new mi(y)}),d=u.headers.get("x-relay-error");if(d&&d==="true")throw new wi(u);if(!u.ok)throw new _i(u);let p=((r=u.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),h;return p==="application/json"?h=yield u.json():p==="application/octet-stream"?h=yield u.blob():p==="text/event-stream"?h=u:p==="multipart/form-data"?h=yield u.formData():h=yield u.text(),{data:h,error:null}}catch(n){return{data:null,error:n}}})}}var F={},Ie={},Le={},De={},Ue={},Me={},ki=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Je=ki();const Oi=Je.fetch,pn=Je.fetch.bind(Je),vn=Je.Headers,Ei=Je.Request,Ti=Je.Response,Ke=Object.freeze(Object.defineProperty({__proto__:null,Headers:vn,Request:Ei,Response:Ti,default:pn,fetch:Oi},Symbol.toStringTag,{value:"Module"})),Pi=Yn(Ke);var ht={},Fr;function yn(){if(Fr)return ht;Fr=1,Object.defineProperty(ht,"__esModule",{value:!0});class s extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}return ht.default=s,ht}var Br;function gn(){if(Br)return Me;Br=1;var s=Me&&Me.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Me,"__esModule",{value:!0});const t=s(Pi),e=s(yn());class r{constructor(i){this.shouldThrowOnError=!1,this.method=i.method,this.url=i.url,this.headers=i.headers,this.schema=i.schema,this.body=i.body,this.shouldThrowOnError=i.shouldThrowOnError,this.signal=i.signal,this.isMaybeSingle=i.isMaybeSingle,i.fetch?this.fetch=i.fetch:typeof fetch>"u"?this.fetch=t.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,a){return this.headers=Object.assign({},this.headers),this.headers[i]=a,this}then(i,a){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const o=this.fetch;let c=o(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async l=>{var u,d,p;let h=null,y=null,b=null,f=l.status,m=l.statusText;if(l.ok){if(this.method!=="HEAD"){const k=await l.text();k===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?y=k:y=JSON.parse(k))}const S=(u=this.headers.Prefer)===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),_=(d=l.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");S&&_&&_.length>1&&(b=parseInt(_[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(y)&&(y.length>1?(h={code:"PGRST116",details:`Results contain ${y.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},y=null,b=null,f=406,m="Not Acceptable"):y.length===1?y=y[0]:y=null)}else{const S=await l.text();try{h=JSON.parse(S),Array.isArray(h)&&l.status===404&&(y=[],h=null,f=200,m="OK")}catch{l.status===404&&S===""?(f=204,m="No Content"):h={message:S}}if(h&&this.isMaybeSingle&&(!((p=h==null?void 0:h.details)===null||p===void 0)&&p.includes("0 rows"))&&(h=null,f=200,m="OK"),h&&this.shouldThrowOnError)throw new e.default(h)}return{error:h,data:y,count:b,status:f,statusText:m}});return this.shouldThrowOnError||(c=c.catch(l=>{var u,d,p;return{error:{message:`${(u=l==null?void 0:l.name)!==null&&u!==void 0?u:"FetchError"}: ${l==null?void 0:l.message}`,details:`${(d=l==null?void 0:l.stack)!==null&&d!==void 0?d:""}`,hint:"",code:`${(p=l==null?void 0:l.code)!==null&&p!==void 0?p:""}`},data:null,count:null,status:0,statusText:""}})),c.then(i,a)}returns(){return this}overrideTypes(){return this}}return Me.default=r,Me}var Hr;function mn(){if(Hr)return Ue;Hr=1;var s=Ue&&Ue.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ue,"__esModule",{value:!0});const t=s(gn());class e extends t.default{select(n){let i=!1;const a=(n??"*").split("").map(o=>/\s/.test(o)&&!i?"":(o==='"'&&(i=!i),o)).join("");return this.url.searchParams.set("select",a),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(n,{ascending:i=!0,nullsFirst:a,foreignTable:o,referencedTable:c=o}={}){const l=c?`${c}.order`:"order",u=this.url.searchParams.get(l);return this.url.searchParams.set(l,`${u?`${u},`:""}${n}.${i?"asc":"desc"}${a===void 0?"":a?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:i,referencedTable:a=i}={}){const o=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(o,`${n}`),this}range(n,i,{foreignTable:a,referencedTable:o=a}={}){const c=typeof o>"u"?"offset":`${o}.offset`,l=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(c,`${n}`),this.url.searchParams.set(l,`${i-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:n=!1,verbose:i=!1,settings:a=!1,buffers:o=!1,wal:c=!1,format:l="text"}={}){var u;const d=[n?"analyze":null,i?"verbose":null,a?"settings":null,o?"buffers":null,c?"wal":null].filter(Boolean).join("|"),p=(u=this.headers.Accept)!==null&&u!==void 0?u:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${l}; for="${p}"; options=${d};`,l==="json"?this:this}rollback(){var n;return((n=this.headers.Prefer)!==null&&n!==void 0?n:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return Ue.default=e,Ue}var zr;function hr(){if(zr)return De;zr=1;var s=De&&De.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(De,"__esModule",{value:!0});const t=s(mn());class e extends t.default{eq(n,i){return this.url.searchParams.append(n,`eq.${i}`),this}neq(n,i){return this.url.searchParams.append(n,`neq.${i}`),this}gt(n,i){return this.url.searchParams.append(n,`gt.${i}`),this}gte(n,i){return this.url.searchParams.append(n,`gte.${i}`),this}lt(n,i){return this.url.searchParams.append(n,`lt.${i}`),this}lte(n,i){return this.url.searchParams.append(n,`lte.${i}`),this}like(n,i){return this.url.searchParams.append(n,`like.${i}`),this}likeAllOf(n,i){return this.url.searchParams.append(n,`like(all).{${i.join(",")}}`),this}likeAnyOf(n,i){return this.url.searchParams.append(n,`like(any).{${i.join(",")}}`),this}ilike(n,i){return this.url.searchParams.append(n,`ilike.${i}`),this}ilikeAllOf(n,i){return this.url.searchParams.append(n,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(n,i){return this.url.searchParams.append(n,`ilike(any).{${i.join(",")}}`),this}is(n,i){return this.url.searchParams.append(n,`is.${i}`),this}in(n,i){const a=Array.from(new Set(i)).map(o=>typeof o=="string"&&new RegExp("[,()]").test(o)?`"${o}"`:`${o}`).join(",");return this.url.searchParams.append(n,`in.(${a})`),this}contains(n,i){return typeof i=="string"?this.url.searchParams.append(n,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(n,`cs.{${i.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(i)}`),this}containedBy(n,i){return typeof i=="string"?this.url.searchParams.append(n,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(n,`cd.{${i.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(i)}`),this}rangeGt(n,i){return this.url.searchParams.append(n,`sr.${i}`),this}rangeGte(n,i){return this.url.searchParams.append(n,`nxl.${i}`),this}rangeLt(n,i){return this.url.searchParams.append(n,`sl.${i}`),this}rangeLte(n,i){return this.url.searchParams.append(n,`nxr.${i}`),this}rangeAdjacent(n,i){return this.url.searchParams.append(n,`adj.${i}`),this}overlaps(n,i){return typeof i=="string"?this.url.searchParams.append(n,`ov.${i}`):this.url.searchParams.append(n,`ov.{${i.join(",")}}`),this}textSearch(n,i,{config:a,type:o}={}){let c="";o==="plain"?c="pl":o==="phrase"?c="ph":o==="websearch"&&(c="w");const l=a===void 0?"":`(${a})`;return this.url.searchParams.append(n,`${c}fts${l}.${i}`),this}match(n){return Object.entries(n).forEach(([i,a])=>{this.url.searchParams.append(i,`eq.${a}`)}),this}not(n,i,a){return this.url.searchParams.append(n,`not.${i}.${a}`),this}or(n,{foreignTable:i,referencedTable:a=i}={}){const o=a?`${a}.or`:"or";return this.url.searchParams.append(o,`(${n})`),this}filter(n,i,a){return this.url.searchParams.append(n,`${i}.${a}`),this}}return De.default=e,De}var Jr;function wn(){if(Jr)return Le;Jr=1;var s=Le&&Le.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Le,"__esModule",{value:!0});const t=s(hr());class e{constructor(n,{headers:i={},schema:a,fetch:o}){this.url=n,this.headers=i,this.schema=a,this.fetch=o}select(n,{head:i=!1,count:a}={}){const o=i?"HEAD":"GET";let c=!1;const l=(n??"*").split("").map(u=>/\s/.test(u)&&!c?"":(u==='"'&&(c=!c),u)).join("");return this.url.searchParams.set("select",l),a&&(this.headers.Prefer=`count=${a}`),new t.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(n,{count:i,defaultToNull:a=!0}={}){const o="POST",c=[];if(this.headers.Prefer&&c.push(this.headers.Prefer),i&&c.push(`count=${i}`),a||c.push("missing=default"),this.headers.Prefer=c.join(","),Array.isArray(n)){const l=n.reduce((u,d)=>u.concat(Object.keys(d)),[]);if(l.length>0){const u=[...new Set(l)].map(d=>`"${d}"`);this.url.searchParams.set("columns",u.join(","))}}return new t.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}upsert(n,{onConflict:i,ignoreDuplicates:a=!1,count:o,defaultToNull:c=!0}={}){const l="POST",u=[`resolution=${a?"ignore":"merge"}-duplicates`];if(i!==void 0&&this.url.searchParams.set("on_conflict",i),this.headers.Prefer&&u.push(this.headers.Prefer),o&&u.push(`count=${o}`),c||u.push("missing=default"),this.headers.Prefer=u.join(","),Array.isArray(n)){const d=n.reduce((p,h)=>p.concat(Object.keys(h)),[]);if(d.length>0){const p=[...new Set(d)].map(h=>`"${h}"`);this.url.searchParams.set("columns",p.join(","))}}return new t.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}update(n,{count:i}={}){const a="PATCH",o=[];return this.headers.Prefer&&o.push(this.headers.Prefer),i&&o.push(`count=${i}`),this.headers.Prefer=o.join(","),new t.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}delete({count:n}={}){const i="DELETE",a=[];return n&&a.push(`count=${n}`),this.headers.Prefer&&a.unshift(this.headers.Prefer),this.headers.Prefer=a.join(","),new t.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return Le.default=e,Le}var et={},tt={},Kr;function Ai(){return Kr||(Kr=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.version=void 0,tt.version="0.0.0-automated"),tt}var Wr;function Ci(){if(Wr)return et;Wr=1,Object.defineProperty(et,"__esModule",{value:!0}),et.DEFAULT_HEADERS=void 0;const s=Ai();return et.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${s.version}`},et}var Gr;function $i(){if(Gr)return Ie;Gr=1;var s=Ie&&Ie.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Ie,"__esModule",{value:!0});const t=s(wn()),e=s(hr()),r=Ci();class n{constructor(a,{headers:o={},schema:c,fetch:l}={}){this.url=a,this.headers=Object.assign(Object.assign({},r.DEFAULT_HEADERS),o),this.schemaName=c,this.fetch=l}from(a){const o=new URL(`${this.url}/${a}`);return new t.default(o,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(a){return new n(this.url,{headers:this.headers,schema:a,fetch:this.fetch})}rpc(a,o={},{head:c=!1,get:l=!1,count:u}={}){let d;const p=new URL(`${this.url}/rpc/${a}`);let h;c||l?(d=c?"HEAD":"GET",Object.entries(o).filter(([b,f])=>f!==void 0).map(([b,f])=>[b,Array.isArray(f)?`{${f.join(",")}}`:`${f}`]).forEach(([b,f])=>{p.searchParams.append(b,f)})):(d="POST",h=o);const y=Object.assign({},this.headers);return u&&(y.Prefer=`count=${u}`),new e.default({method:d,url:p,headers:y,schema:this.schemaName,body:h,fetch:this.fetch,allowEmpty:!1})}}return Ie.default=n,Ie}var Vr;function ji(){if(Vr)return F;Vr=1;var s=F&&F.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(F,"__esModule",{value:!0}),F.PostgrestError=F.PostgrestBuilder=F.PostgrestTransformBuilder=F.PostgrestFilterBuilder=F.PostgrestQueryBuilder=F.PostgrestClient=void 0;const t=s($i());F.PostgrestClient=t.default;const e=s(wn());F.PostgrestQueryBuilder=e.default;const r=s(hr());F.PostgrestFilterBuilder=r.default;const n=s(mn());F.PostgrestTransformBuilder=n.default;const i=s(gn());F.PostgrestBuilder=i.default;const a=s(yn());return F.PostgrestError=a.default,F.default={PostgrestClient:t.default,PostgrestQueryBuilder:e.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:n.default,PostgrestBuilder:i.default,PostgrestError:a.default},F}var Ri=ji();const xi=hn(Ri),{PostgrestClient:Ii,PostgrestQueryBuilder:ya,PostgrestFilterBuilder:ga,PostgrestTransformBuilder:ma,PostgrestBuilder:wa,PostgrestError:_a}=xi,Li="2.11.2",Di={"X-Client-Info":`realtime-js/${Li}`},Ui="1.0.0",_n=1e4,Mi=1e3;var He;(function(s){s[s.connecting=0]="connecting",s[s.open=1]="open",s[s.closing=2]="closing",s[s.closed=3]="closed"})(He||(He={}));var K;(function(s){s.closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving"})(K||(K={}));var Q;(function(s){s.close="phx_close",s.error="phx_error",s.join="phx_join",s.reply="phx_reply",s.leave="phx_leave",s.access_token="access_token"})(Q||(Q={}));var rr;(function(s){s.websocket="websocket"})(rr||(rr={}));var ke;(function(s){s.Connecting="connecting",s.Open="open",s.Closing="closing",s.Closed="closed"})(ke||(ke={}));class Ni{constructor(){this.HEADER_LENGTH=1}decode(t,e){return t.constructor===ArrayBuffer?e(this._binaryDecode(t)):e(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){const e=new DataView(t),r=new TextDecoder;return this._decodeBroadcast(t,e,r)}_decodeBroadcast(t,e,r){const n=e.getUint8(1),i=e.getUint8(2);let a=this.HEADER_LENGTH+2;const o=r.decode(t.slice(a,a+n));a=a+n;const c=r.decode(t.slice(a,a+i));a=a+i;const l=JSON.parse(r.decode(t.slice(a,t.byteLength)));return{ref:null,topic:o,event:c,payload:l}}}class bn{constructor(t,e){this.callback=t,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var M;(function(s){s.abstime="abstime",s.bool="bool",s.date="date",s.daterange="daterange",s.float4="float4",s.float8="float8",s.int2="int2",s.int4="int4",s.int4range="int4range",s.int8="int8",s.int8range="int8range",s.json="json",s.jsonb="jsonb",s.money="money",s.numeric="numeric",s.oid="oid",s.reltime="reltime",s.text="text",s.time="time",s.timestamp="timestamp",s.timestamptz="timestamptz",s.timetz="timetz",s.tsrange="tsrange",s.tstzrange="tstzrange"})(M||(M={}));const Qr=(s,t,e={})=>{var r;const n=(r=e.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(t).reduce((i,a)=>(i[a]=qi(a,s,t,n),i),{})},qi=(s,t,e,r)=>{const n=t.find(o=>o.name===s),i=n==null?void 0:n.type,a=e[s];return i&&!r.includes(i)?Sn(i,a):nr(a)},Sn=(s,t)=>{if(s.charAt(0)==="_"){const e=s.slice(1,s.length);return zi(t,e)}switch(s){case M.bool:return Fi(t);case M.float4:case M.float8:case M.int2:case M.int4:case M.int8:case M.numeric:case M.oid:return Bi(t);case M.json:case M.jsonb:return Hi(t);case M.timestamp:return Ji(t);case M.abstime:case M.date:case M.daterange:case M.int4range:case M.int8range:case M.money:case M.reltime:case M.text:case M.time:case M.timestamptz:case M.timetz:case M.tsrange:case M.tstzrange:return nr(t);default:return nr(t)}},nr=s=>s,Fi=s=>{switch(s){case"t":return!0;case"f":return!1;default:return s}},Bi=s=>{if(typeof s=="string"){const t=parseFloat(s);if(!Number.isNaN(t))return t}return s},Hi=s=>{if(typeof s=="string")try{return JSON.parse(s)}catch(t){return console.log(`JSON parse error: ${t}`),s}return s},zi=(s,t)=>{if(typeof s!="string")return s;const e=s.length-1,r=s[e];if(s[0]==="{"&&r==="}"){let i;const a=s.slice(1,e);try{i=JSON.parse("["+a+"]")}catch{i=a?a.split(","):[]}return i.map(o=>Sn(t,o))}return s},Ji=s=>typeof s=="string"?s.replace(" ","T"):s,kn=s=>{let t=s;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")};class Gt{constructor(t,e,r={},n=_n){this.channel=t,this.event=e,this.payload=r,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,e){var r;return this._hasReceived(t)&&e((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:t,callback:e}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,e){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:e})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:e}){this.recHooks.filter(r=>r.status===t).forEach(r=>r.callback(e))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var Yr;(function(s){s.SYNC="sync",s.JOIN="join",s.LEAVE="leave"})(Yr||(Yr={}));class nt{constructor(t,e){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(e==null?void 0:e.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},n=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=nt.syncState(this.state,n,i,a),this.pendingDiffs.forEach(c=>{this.state=nt.syncDiff(this.state,c,i,a)}),this.pendingDiffs=[],o()}),this.channel._on(r.diff,{},n=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=nt.syncDiff(this.state,n,i,a),o())}),this.onJoin((n,i,a)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:a})}),this.onLeave((n,i,a)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,e,r,n){const i=this.cloneDeep(t),a=this.transformState(e),o={},c={};return this.map(i,(l,u)=>{a[l]||(c[l]=u)}),this.map(a,(l,u)=>{const d=i[l];if(d){const p=u.map(f=>f.presence_ref),h=d.map(f=>f.presence_ref),y=u.filter(f=>h.indexOf(f.presence_ref)<0),b=d.filter(f=>p.indexOf(f.presence_ref)<0);y.length>0&&(o[l]=y),b.length>0&&(c[l]=b)}else o[l]=u}),this.syncDiff(i,{joins:o,leaves:c},r,n)}static syncDiff(t,e,r,n){const{joins:i,leaves:a}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return r||(r=()=>{}),n||(n=()=>{}),this.map(i,(o,c)=>{var l;const u=(l=t[o])!==null&&l!==void 0?l:[];if(t[o]=this.cloneDeep(c),u.length>0){const d=t[o].map(h=>h.presence_ref),p=u.filter(h=>d.indexOf(h.presence_ref)<0);t[o].unshift(...p)}r(o,u,c)}),this.map(a,(o,c)=>{let l=t[o];if(!l)return;const u=c.map(d=>d.presence_ref);l=l.filter(d=>u.indexOf(d.presence_ref)<0),t[o]=l,n(o,l,c),l.length===0&&delete t[o]}),t}static map(t,e){return Object.getOwnPropertyNames(t).map(r=>e(r,t[r]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((e,r)=>{const n=t[r];return"metas"in n?e[r]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):e[r]=n,e},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Xr;(function(s){s.ALL="*",s.INSERT="INSERT",s.UPDATE="UPDATE",s.DELETE="DELETE"})(Xr||(Xr={}));var Zr;(function(s){s.BROADCAST="broadcast",s.PRESENCE="presence",s.POSTGRES_CHANGES="postgres_changes",s.SYSTEM="system"})(Zr||(Zr={}));var oe;(function(s){s.SUBSCRIBED="SUBSCRIBED",s.TIMED_OUT="TIMED_OUT",s.CLOSED="CLOSED",s.CHANNEL_ERROR="CHANNEL_ERROR"})(oe||(oe={}));class dr{constructor(t,e={config:{}},r){this.topic=t,this.params=e,this.socket=r,this.bindings={},this.state=K.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},e.config),this.timeout=this.socket.timeout,this.joinPush=new Gt(this,Q.join,this.params,this.timeout),this.rejoinTimer=new bn(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=K.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=K.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=K.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=K.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Q.reply,{},(n,i)=>{this._trigger(this._replyEventName(i),n)}),this.presence=new nt(this),this.broadcastEndpointURL=kn(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(t,e=this.timeout){var r,n;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:a,private:o}}=this.params;this._onError(u=>t==null?void 0:t(oe.CHANNEL_ERROR,u)),this._onClose(()=>t==null?void 0:t(oe.CLOSED));const c={},l={broadcast:i,presence:a,postgres_changes:(n=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(u=>u.filter))!==null&&n!==void 0?n:[],private:o};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:l},c)),this.joinedOnce=!0,this._rejoin(e),this.joinPush.receive("ok",async({postgres_changes:u})=>{var d;if(this.socket.setAuth(),u===void 0){t==null||t(oe.SUBSCRIBED);return}else{const p=this.bindings.postgres_changes,h=(d=p==null?void 0:p.length)!==null&&d!==void 0?d:0,y=[];for(let b=0;b<h;b++){const f=p[b],{filter:{event:m,schema:w,table:S,filter:_}}=f,k=u&&u[b];if(k&&k.event===m&&k.schema===w&&k.table===S&&k.filter===_)y.push(Object.assign(Object.assign({},f),{id:k.id}));else{this.unsubscribe(),t==null||t(oe.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,t&&t(oe.SUBSCRIBED);return}}).receive("error",u=>{t==null||t(oe.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(oe.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,e={}){return await this.send({type:"presence",event:"track",payload:t},e.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,e,r){return this._on(t,e,r)}async send(t,e={}){var r,n;if(!this._canPush()&&t.type==="broadcast"){const{event:i,payload:a}=t,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:a,private:this.private}]})};try{const l=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(r=e.timeout)!==null&&r!==void 0?r:this.timeout);return await((n=l.body)===null||n===void 0?void 0:n.cancel()),l.ok?"ok":"error"}catch(l){return l.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var a,o,c;const l=this._push(t.type,t,e.timeout||this.timeout);t.type==="broadcast"&&!(!((c=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),l.receive("ok",()=>i("ok")),l.receive("error",()=>i("error")),l.receive("timeout",()=>i("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=K.leaving;const e=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Q.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const n=new Gt(this,Q.leave,{},t);n.receive("ok",()=>{e(),r("ok")}).receive("timeout",()=>{e(),r("timed out")}).receive("error",()=>{r("error")}),n.send(),this._canPush()||n.trigger("ok",{})})}async _fetchWithTimeout(t,e,r){const n=new AbortController,i=setTimeout(()=>n.abort(),r),a=await this.socket.fetch(t,Object.assign(Object.assign({},e),{signal:n.signal}));return clearTimeout(i),a}_push(t,e,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Gt(this,t,e,r);return this._canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}_onMessage(t,e,r){return e}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,e,r){var n,i;const a=t.toLocaleLowerCase(),{close:o,error:c,leave:l,join:u}=Q;if(r&&[o,c,l,u].indexOf(a)>=0&&r!==this._joinRef())return;let p=this._onMessage(a,e,r);if(e&&!p)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(h=>{var y,b,f;return((y=h.filter)===null||y===void 0?void 0:y.event)==="*"||((f=(b=h.filter)===null||b===void 0?void 0:b.event)===null||f===void 0?void 0:f.toLocaleLowerCase())===a}).map(h=>h.callback(p,r)):(i=this.bindings[a])===null||i===void 0||i.filter(h=>{var y,b,f,m,w,S;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in h){const _=h.id,k=(y=h.filter)===null||y===void 0?void 0:y.event;return _&&((b=e.ids)===null||b===void 0?void 0:b.includes(_))&&(k==="*"||(k==null?void 0:k.toLocaleLowerCase())===((f=e.data)===null||f===void 0?void 0:f.type.toLocaleLowerCase()))}else{const _=(w=(m=h==null?void 0:h.filter)===null||m===void 0?void 0:m.event)===null||w===void 0?void 0:w.toLocaleLowerCase();return _==="*"||_===((S=e==null?void 0:e.event)===null||S===void 0?void 0:S.toLocaleLowerCase())}else return h.type.toLocaleLowerCase()===a}).map(h=>{if(typeof p=="object"&&"ids"in p){const y=p.data,{schema:b,table:f,commit_timestamp:m,type:w,errors:S}=y;p=Object.assign(Object.assign({},{schema:b,table:f,commit_timestamp:m,eventType:w,new:{},old:{},errors:S}),this._getPayloadRecords(y))}h.callback(p,r)})}_isClosed(){return this.state===K.closed}_isJoined(){return this.state===K.joined}_isJoining(){return this.state===K.joining}_isLeaving(){return this.state===K.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,e,r){const n=t.toLocaleLowerCase(),i={type:n,filter:e,callback:r};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(t,e){const r=t.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&dr.isEqual(n.filter,e))}),this}static isEqual(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const r in t)if(t[r]!==e[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Q.close,{},t)}_onError(t){this._on(Q.error,{},e=>t(e))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=K.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const e={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(e.new=Qr(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(e.old=Qr(t.columns,t.old_record)),e}}const Ki=()=>{},Wi=typeof WebSocket<"u",Gi=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Vi{constructor(t,e){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=Di,this.params={},this.timeout=_n,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Ki,this.conn=null,this.sendBuffer=[],this.serializer=new Ni,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let a;return i?a=i:typeof fetch>"u"?a=(...o)=>ze(async()=>{const{default:c}=await Promise.resolve().then(()=>Ke);return{default:c}},void 0,import.meta.url).then(({default:c})=>c(...o)):a=fetch,(...o)=>a(...o)},this.endPoint=`${t}/${rr.websocket}`,this.httpEndpoint=kn(t),e!=null&&e.transport?this.transport=e.transport:this.transport=null,e!=null&&e.params&&(this.params=e.params),e!=null&&e.headers&&(this.headers=Object.assign(Object.assign({},this.headers),e.headers)),e!=null&&e.timeout&&(this.timeout=e.timeout),e!=null&&e.logger&&(this.logger=e.logger),e!=null&&e.heartbeatIntervalMs&&(this.heartbeatIntervalMs=e.heartbeatIntervalMs);const n=(r=e==null?void 0:e.params)===null||r===void 0?void 0:r.apikey;if(n&&(this.accessTokenValue=n,this.apiKey=n),this.reconnectAfterMs=e!=null&&e.reconnectAfterMs?e.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=e!=null&&e.encode?e.encode:(i,a)=>a(JSON.stringify(i)),this.decode=e!=null&&e.decode?e.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new bn(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(e==null?void 0:e.fetch),e!=null&&e.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(e==null?void 0:e.worker)||!1,this.workerUrl=e==null?void 0:e.workerUrl}this.accessToken=(e==null?void 0:e.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(Wi){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new Qi(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),ze(async()=>{const{default:t}=await import("./browser-CHl2p3zP.js").then(e=>e.b);return{default:t}},__vite__mapDeps([0,1]),import.meta.url).then(({default:t})=>{this.conn=new t(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Ui}))}disconnect(t,e){this.conn&&(this.conn.onclose=function(){},t?this.conn.close(t,e??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(t){const e=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),e}async removeAllChannels(){const t=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.disconnect(),t}log(t,e,r){this.logger(t,e,r)}connectionState(){switch(this.conn&&this.conn.readyState){case He.connecting:return ke.Connecting;case He.open:return ke.Open;case He.closing:return ke.Closing;default:return ke.Closed}}isConnected(){return this.connectionState()===ke.Open}channel(t,e={config:{}}){const r=new dr(`realtime:${t}`,e,this);return this.channels.push(r),r}push(t){const{topic:e,event:r,payload:n,ref:i}=t,a=()=>{this.encode(t,o=>{var c;(c=this.conn)===null||c===void 0||c.send(o)})};this.log("push",`${e} ${r} (${i})`,n),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(t=null){let e=t||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(e){let r=null;try{r=JSON.parse(atob(e.split(".")[1]))}catch{}if(r&&r.exp&&!(Math.floor(Date.now()/1e3)-r.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`);this.accessTokenValue=e,this.channels.forEach(n=>{e&&n.updateJoinPayload({access_token:e}),n.joinedOnce&&n._isJoined()&&n._push(Q.access_token,{access_token:e})})}}async sendHeartbeat(){var t;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(t=this.conn)===null||t===void 0||t.close(Mi,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let e=this.channels.find(r=>r.topic===t&&(r._isJoined()||r._isJoining()));e&&(this.log("transport",`leaving duplicate topic "${t}"`),e.unsubscribe())}_remove(t){this.channels=this.channels.filter(e=>e._joinRef()!==t._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_onConnMessage(t){this.decode(t.data,e=>{let{topic:r,event:n,payload:i,ref:a}=e;a&&a===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${n} ${a&&"("+a+")"||""}`,i),this.channels.filter(o=>o._isMember(r)).forEach(o=>o._trigger(n,i,a)),this.stateChangeCallbacks.message.forEach(o=>o(e))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{e.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(t=>t())}_onConnClose(t){this.log("transport","close",t),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(e=>e(t))}_onConnError(t){this.log("transport",t.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(e=>e(t))}_triggerChanError(){this.channels.forEach(t=>t._trigger(Q.error))}_appendParams(t,e){if(Object.keys(e).length===0)return t;const r=t.match(/\?/)?"&":"?",n=new URLSearchParams(e);return`${t}${r}${n}`}_workerObjectUrl(t){let e;if(t)e=t;else{const r=new Blob([Gi],{type:"application/javascript"});e=URL.createObjectURL(r)}return e}}class Qi{constructor(t,e,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=He.connecting,this.send=()=>{},this.url=null,this.url=t,this.close=r.close}}class fr extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function B(s){return typeof s=="object"&&s!==null&&"__isStorageError"in s}class Yi extends fr{constructor(t,e){super(t),this.name="StorageApiError",this.status=e}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class ir extends fr{constructor(t,e){super(t),this.name="StorageUnknownError",this.originalError=e}}var Xi=function(s,t,e,r){function n(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function o(u){try{l(r.next(u))}catch(d){a(d)}}function c(u){try{l(r.throw(u))}catch(d){a(d)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((r=r.apply(s,t||[])).next())})};const On=s=>{let t;return s?t=s:typeof fetch>"u"?t=(...e)=>ze(async()=>{const{default:r}=await Promise.resolve().then(()=>Ke);return{default:r}},void 0,import.meta.url).then(({default:r})=>r(...e)):t=fetch,(...e)=>t(...e)},Zi=()=>Xi(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield ze(()=>Promise.resolve().then(()=>Ke),void 0,import.meta.url)).Response:Response}),sr=s=>{if(Array.isArray(s))return s.map(e=>sr(e));if(typeof s=="function"||s!==Object(s))return s;const t={};return Object.entries(s).forEach(([e,r])=>{const n=e.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));t[n]=sr(r)}),t};var Oe=function(s,t,e,r){function n(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function o(u){try{l(r.next(u))}catch(d){a(d)}}function c(u){try{l(r.throw(u))}catch(d){a(d)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((r=r.apply(s,t||[])).next())})};const Vt=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),es=(s,t,e)=>Oe(void 0,void 0,void 0,function*(){const r=yield Zi();s instanceof r&&!(e!=null&&e.noResolveJson)?s.json().then(n=>{t(new Yi(Vt(n),s.status||500))}).catch(n=>{t(new ir(Vt(n),n))}):t(new ir(Vt(s),s))}),ts=(s,t,e,r)=>{const n={method:s,headers:(t==null?void 0:t.headers)||{}};return s==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),r&&(n.body=JSON.stringify(r)),Object.assign(Object.assign({},n),e))};function at(s,t,e,r,n,i){return Oe(this,void 0,void 0,function*(){return new Promise((a,o)=>{s(e,ts(t,r,n,i)).then(c=>{if(!c.ok)throw c;return r!=null&&r.noResolveJson?c:c.json()}).then(c=>a(c)).catch(c=>es(c,o,r))})})}function wt(s,t,e,r){return Oe(this,void 0,void 0,function*(){return at(s,"GET",t,e,r)})}function pe(s,t,e,r,n){return Oe(this,void 0,void 0,function*(){return at(s,"POST",t,r,n,e)})}function rs(s,t,e,r,n){return Oe(this,void 0,void 0,function*(){return at(s,"PUT",t,r,n,e)})}function ns(s,t,e,r){return Oe(this,void 0,void 0,function*(){return at(s,"HEAD",t,Object.assign(Object.assign({},e),{noResolveJson:!0}),r)})}function En(s,t,e,r,n){return Oe(this,void 0,void 0,function*(){return at(s,"DELETE",t,r,n,e)})}var z=function(s,t,e,r){function n(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function o(u){try{l(r.next(u))}catch(d){a(d)}}function c(u){try{l(r.throw(u))}catch(d){a(d)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((r=r.apply(s,t||[])).next())})};const is={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},en={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class ss{constructor(t,e={},r,n){this.url=t,this.headers=e,this.bucketId=r,this.fetch=On(n)}uploadOrUpdate(t,e,r,n){return z(this,void 0,void 0,function*(){try{let i;const a=Object.assign(Object.assign({},en),n);let o=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(a.upsert)});const c=a.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",a.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=r,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType,c&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),n!=null&&n.headers&&(o=Object.assign(Object.assign({},o),n.headers));const l=this._removeEmptyFolders(e),u=this._getFinalPath(l),d=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:t,body:i,headers:o},a!=null&&a.duplex?{duplex:a.duplex}:{})),p=yield d.json();return d.ok?{data:{path:l,id:p.Id,fullPath:p.Key},error:null}:{data:null,error:p}}catch(i){if(B(i))return{data:null,error:i};throw i}})}upload(t,e,r){return z(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,e,r)})}uploadToSignedUrl(t,e,r,n){return z(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(t),a=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",e);try{let c;const l=Object.assign({upsert:en.upsert},n),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(l.upsert)});typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",l.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",l.cacheControl)):(c=r,u["cache-control"]=`max-age=${l.cacheControl}`,u["content-type"]=l.contentType);const d=yield this.fetch(o.toString(),{method:"PUT",body:c,headers:u}),p=yield d.json();return d.ok?{data:{path:i,fullPath:p.Key},error:null}:{data:null,error:p}}catch(c){if(B(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(t,e){return z(this,void 0,void 0,function*(){try{let r=this._getFinalPath(t);const n=Object.assign({},this.headers);e!=null&&e.upsert&&(n["x-upsert"]="true");const i=yield pe(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:n}),a=new URL(this.url+i.url),o=a.searchParams.get("token");if(!o)throw new fr("No token returned by API");return{data:{signedUrl:a.toString(),path:t,token:o},error:null}}catch(r){if(B(r))return{data:null,error:r};throw r}})}update(t,e,r){return z(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,e,r)})}move(t,e,r){return z(this,void 0,void 0,function*(){try{return{data:yield pe(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:e,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(B(n))return{data:null,error:n};throw n}})}copy(t,e,r){return z(this,void 0,void 0,function*(){try{return{data:{path:(yield pe(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:e,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(B(n))return{data:null,error:n};throw n}})}createSignedUrl(t,e,r){return z(this,void 0,void 0,function*(){try{let n=this._getFinalPath(t),i=yield pe(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:e},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const a=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${a}`)},{data:i,error:null}}catch(n){if(B(n))return{data:null,error:n};throw n}})}createSignedUrls(t,e,r){return z(this,void 0,void 0,function*(){try{const n=yield pe(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:e,paths:t},{headers:this.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:n.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${i}`):null})),error:null}}catch(n){if(B(n))return{data:null,error:n};throw n}})}download(t,e){return z(this,void 0,void 0,function*(){const n=typeof(e==null?void 0:e.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((e==null?void 0:e.transform)||{}),a=i?`?${i}`:"";try{const o=this._getFinalPath(t);return{data:yield(yield wt(this.fetch,`${this.url}/${n}/${o}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(B(o))return{data:null,error:o};throw o}})}info(t){return z(this,void 0,void 0,function*(){const e=this._getFinalPath(t);try{const r=yield wt(this.fetch,`${this.url}/object/info/${e}`,{headers:this.headers});return{data:sr(r),error:null}}catch(r){if(B(r))return{data:null,error:r};throw r}})}exists(t){return z(this,void 0,void 0,function*(){const e=this._getFinalPath(t);try{return yield ns(this.fetch,`${this.url}/object/${e}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(B(r)&&r instanceof ir){const n=r.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:r}}throw r}})}getPublicUrl(t,e){const r=this._getFinalPath(t),n=[],i=e!=null&&e.download?`download=${e.download===!0?"":e.download}`:"";i!==""&&n.push(i);const o=typeof(e==null?void 0:e.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((e==null?void 0:e.transform)||{});c!==""&&n.push(c);let l=n.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${r}${l}`)}}}remove(t){return z(this,void 0,void 0,function*(){try{return{data:yield En(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(e){if(B(e))return{data:null,error:e};throw e}})}list(t,e,r){return z(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},is),e),{prefix:t||""});return{data:yield pe(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(B(n))return{data:null,error:n};throw n}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}}const as="2.7.1",os={"X-Client-Info":`storage-js/${as}`};var Ne=function(s,t,e,r){function n(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function o(u){try{l(r.next(u))}catch(d){a(d)}}function c(u){try{l(r.throw(u))}catch(d){a(d)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((r=r.apply(s,t||[])).next())})};class ls{constructor(t,e={},r){this.url=t,this.headers=Object.assign(Object.assign({},os),e),this.fetch=On(r)}listBuckets(){return Ne(this,void 0,void 0,function*(){try{return{data:yield wt(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(t){if(B(t))return{data:null,error:t};throw t}})}getBucket(t){return Ne(this,void 0,void 0,function*(){try{return{data:yield wt(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(e){if(B(e))return{data:null,error:e};throw e}})}createBucket(t,e={public:!1}){return Ne(this,void 0,void 0,function*(){try{return{data:yield pe(this.fetch,`${this.url}/bucket`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(B(r))return{data:null,error:r};throw r}})}updateBucket(t,e){return Ne(this,void 0,void 0,function*(){try{return{data:yield rs(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(B(r))return{data:null,error:r};throw r}})}emptyBucket(t){return Ne(this,void 0,void 0,function*(){try{return{data:yield pe(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(B(e))return{data:null,error:e};throw e}})}deleteBucket(t){return Ne(this,void 0,void 0,function*(){try{return{data:yield En(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(e){if(B(e))return{data:null,error:e};throw e}})}}class cs extends ls{constructor(t,e={},r){super(t,e,r)}from(t){return new ss(this.url,this.headers,t,this.fetch)}}const us="2.49.1";let rt="";typeof Deno<"u"?rt="deno":typeof document<"u"?rt="web":typeof navigator<"u"&&navigator.product==="ReactNative"?rt="react-native":rt="node";const hs={"X-Client-Info":`supabase-js-${rt}/${us}`},ds={headers:hs},fs={schema:"public"},ps={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},vs={};var ys=function(s,t,e,r){function n(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function o(u){try{l(r.next(u))}catch(d){a(d)}}function c(u){try{l(r.throw(u))}catch(d){a(d)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((r=r.apply(s,t||[])).next())})};const gs=s=>{let t;return s?t=s:typeof fetch>"u"?t=pn:t=fetch,(...e)=>t(...e)},ms=()=>typeof Headers>"u"?vn:Headers,ws=(s,t,e)=>{const r=gs(e),n=ms();return(i,a)=>ys(void 0,void 0,void 0,function*(){var o;const c=(o=yield t())!==null&&o!==void 0?o:s;let l=new n(a==null?void 0:a.headers);return l.has("apikey")||l.set("apikey",s),l.has("Authorization")||l.set("Authorization",`Bearer ${c}`),r(i,Object.assign(Object.assign({},a),{headers:l}))})};var _s=function(s,t,e,r){function n(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function o(u){try{l(r.next(u))}catch(d){a(d)}}function c(u){try{l(r.throw(u))}catch(d){a(d)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((r=r.apply(s,t||[])).next())})};function bs(s){return s.replace(/\/$/,"")}function Ss(s,t){const{db:e,auth:r,realtime:n,global:i}=s,{db:a,auth:o,realtime:c,global:l}=t,u={db:Object.assign(Object.assign({},a),e),auth:Object.assign(Object.assign({},o),r),realtime:Object.assign(Object.assign({},c),n),global:Object.assign(Object.assign({},l),i),accessToken:()=>_s(this,void 0,void 0,function*(){return""})};return s.accessToken?u.accessToken=s.accessToken:delete u.accessToken,u}const Tn="2.68.0",Be=30*1e3,ar=3,Qt=ar*Be,ks="http://localhost:9999",Os="supabase.auth.token",Es={"X-Client-Info":`gotrue-js/${Tn}`},or="X-Supabase-Api-Version",Pn={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function Ts(s){return Math.round(Date.now()/1e3)+s}function Ps(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const t=Math.random()*16|0;return(s=="x"?t:t&3|8).toString(16)})}const X=()=>typeof window<"u"&&typeof document<"u",be={tested:!1,writable:!1},it=()=>{if(!X())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(be.tested)return be.writable;const s=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(s,s),globalThis.localStorage.removeItem(s),be.tested=!0,be.writable=!0}catch{be.tested=!0,be.writable=!1}return be.writable};function As(s){const t={},e=new URL(s);if(e.hash&&e.hash[0]==="#")try{new URLSearchParams(e.hash.substring(1)).forEach((n,i)=>{t[i]=n})}catch{}return e.searchParams.forEach((r,n)=>{t[n]=r}),t}const An=s=>{let t;return s?t=s:typeof fetch>"u"?t=(...e)=>ze(async()=>{const{default:r}=await Promise.resolve().then(()=>Ke);return{default:r}},void 0,import.meta.url).then(({default:r})=>r(...e)):t=fetch,(...e)=>t(...e)},Cs=s=>typeof s=="object"&&s!==null&&"status"in s&&"ok"in s&&"json"in s&&typeof s.json=="function",Cn=async(s,t,e)=>{await s.setItem(t,JSON.stringify(e))},dt=async(s,t)=>{const e=await s.getItem(t);if(!e)return null;try{return JSON.parse(e)}catch{return e}},ft=async(s,t)=>{await s.removeItem(t)};function $s(s){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let e="",r,n,i,a,o,c,l,u=0;for(s=s.replace("-","+").replace("_","/");u<s.length;)a=t.indexOf(s.charAt(u++)),o=t.indexOf(s.charAt(u++)),c=t.indexOf(s.charAt(u++)),l=t.indexOf(s.charAt(u++)),r=a<<2|o>>4,n=(o&15)<<4|c>>2,i=(c&3)<<6|l,e=e+String.fromCharCode(r),c!=64&&n!=0&&(e=e+String.fromCharCode(n)),l!=64&&i!=0&&(e=e+String.fromCharCode(i));return e}class kt{constructor(){this.promise=new kt.promiseConstructor((t,e)=>{this.resolve=t,this.reject=e})}}kt.promiseConstructor=Promise;function tn(s){const t=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,e=s.split(".");if(e.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!t.test(e[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=e[1];return JSON.parse($s(r))}async function js(s){return await new Promise(t=>{setTimeout(()=>t(null),s)})}function Rs(s,t){return new Promise((r,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const a=await s(i);if(!t(i,null,a)){r(a);return}}catch(a){if(!t(i,a)){n(a);return}}})()})}function xs(s){return("0"+s.toString(16)).substr(-2)}function Is(){const t=new Uint32Array(56);if(typeof crypto>"u"){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=e.length;let n="";for(let i=0;i<56;i++)n+=e.charAt(Math.floor(Math.random()*r));return n}return crypto.getRandomValues(t),Array.from(t,xs).join("")}async function Ls(s){const e=new TextEncoder().encode(s),r=await crypto.subtle.digest("SHA-256",e),n=new Uint8Array(r);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}function Ds(s){return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Us(s){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),s;const e=await Ls(s);return Ds(e)}async function qe(s,t,e=!1){const r=Is();let n=r;e&&(n+="/PASSWORD_RECOVERY"),await Cn(s,`${t}-code-verifier`,n);const i=await Us(r);return[i,r===i?"plain":"s256"]}const Ms=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Ns(s){const t=s.headers.get(or);if(!t||!t.match(Ms))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}class pr extends Error{constructor(t,e,r){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=e,this.code=r}}function A(s){return typeof s=="object"&&s!==null&&"__isAuthError"in s}class qs extends pr{constructor(t,e,r){super(t,e,r),this.name="AuthApiError",this.status=e,this.code=r}}function Fs(s){return A(s)&&s.name==="AuthApiError"}class $n extends pr{constructor(t,e){super(t),this.name="AuthUnknownError",this.originalError=e}}class Ee extends pr{constructor(t,e,r,n){super(t,r,n),this.name=e,this.status=r}}class de extends Ee{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Bs(s){return A(s)&&s.name==="AuthSessionMissingError"}class Yt extends Ee{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class pt extends Ee{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class vt extends Ee{constructor(t,e=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Hs(s){return A(s)&&s.name==="AuthImplicitGrantRedirectError"}class rn extends Ee{constructor(t,e=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class lr extends Ee{constructor(t,e){super(t,"AuthRetryableFetchError",e,void 0)}}function Xt(s){return A(s)&&s.name==="AuthRetryableFetchError"}class nn extends Ee{constructor(t,e,r){super(t,"AuthWeakPasswordError",e,"weak_password"),this.reasons=r}}var zs=function(s,t){var e={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&t.indexOf(r)<0&&(e[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(s);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(s,r[n])&&(e[r[n]]=s[r[n]]);return e};const Se=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),Js=[502,503,504];async function sn(s){var t;if(!Cs(s))throw new lr(Se(s),0);if(Js.includes(s.status))throw new lr(Se(s),s.status);let e;try{e=await s.json()}catch(i){throw new $n(Se(i),i)}let r;const n=Ns(s);if(n&&n.getTime()>=Pn["2024-01-01"].timestamp&&typeof e=="object"&&e&&typeof e.code=="string"?r=e.code:typeof e=="object"&&e&&typeof e.error_code=="string"&&(r=e.error_code),r){if(r==="weak_password")throw new nn(Se(e),s.status,((t=e.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(r==="session_not_found")throw new de}else if(typeof e=="object"&&e&&typeof e.weak_password=="object"&&e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",!0))throw new nn(Se(e),s.status,e.weak_password.reasons);throw new qs(Se(e),s.status||500,r)}const Ks=(s,t,e,r)=>{const n={method:s,headers:(t==null?void 0:t.headers)||{}};return s==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),e))};async function j(s,t,e,r){var n;const i=Object.assign({},r==null?void 0:r.headers);i[or]||(i[or]=Pn["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const a=(n=r==null?void 0:r.query)!==null&&n!==void 0?n:{};r!=null&&r.redirectTo&&(a.redirect_to=r.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",c=await Ws(s,t,e+o,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(c):{data:Object.assign({},c),error:null}}async function Ws(s,t,e,r,n,i){const a=Ks(t,r,n,i);let o;try{o=await s(e,Object.assign({},a))}catch(c){throw console.error(c),new lr(Se(c),0)}if(o.ok||await sn(o),r!=null&&r.noResolveJson)return o;try{return await o.json()}catch(c){await sn(c)}}function fe(s){var t;let e=null;Ys(s)&&(e=Object.assign({},s),s.expires_at||(e.expires_at=Ts(s.expires_in)));const r=(t=s.user)!==null&&t!==void 0?t:s;return{data:{session:e,user:r},error:null}}function an(s){const t=fe(s);return!t.error&&s.weak_password&&typeof s.weak_password=="object"&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.message&&typeof s.weak_password.message=="string"&&s.weak_password.reasons.reduce((e,r)=>e&&typeof r=="string",!0)&&(t.data.weak_password=s.weak_password),t}function ve(s){var t;return{data:{user:(t=s.user)!==null&&t!==void 0?t:s},error:null}}function Gs(s){return{data:s,error:null}}function Vs(s){const{action_link:t,email_otp:e,hashed_token:r,redirect_to:n,verification_type:i}=s,a=zs(s,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:t,email_otp:e,hashed_token:r,redirect_to:n,verification_type:i},c=Object.assign({},a);return{data:{properties:o,user:c},error:null}}function Qs(s){return s}function Ys(s){return s.access_token&&s.refresh_token&&s.expires_in}var Xs=function(s,t){var e={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&t.indexOf(r)<0&&(e[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(s);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(s,r[n])&&(e[r[n]]=s[r[n]]);return e};class Zs{constructor({url:t="",headers:e={},fetch:r}){this.url=t,this.headers=e,this.fetch=An(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(t,e="global"){try{return await j(this.fetch,"POST",`${this.url}/logout?scope=${e}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(r){if(A(r))return{data:null,error:r};throw r}}async inviteUserByEmail(t,e={}){try{return await j(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:e.data},headers:this.headers,redirectTo:e.redirectTo,xform:ve})}catch(r){if(A(r))return{data:{user:null},error:r};throw r}}async generateLink(t){try{const{options:e}=t,r=Xs(t,["options"]),n=Object.assign(Object.assign({},r),e);return"newEmail"in r&&(n.new_email=r==null?void 0:r.newEmail,delete n.newEmail),await j(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:Vs,redirectTo:e==null?void 0:e.redirectTo})}catch(e){if(A(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(t){try{return await j(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:ve})}catch(e){if(A(e))return{data:{user:null},error:e};throw e}}async listUsers(t){var e,r,n,i,a,o,c;try{const l={nextPage:null,lastPage:0,total:0},u=await j(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(e=t==null?void 0:t.page)===null||e===void 0?void 0:e.toString())!==null&&r!==void 0?r:"",per_page:(i=(n=t==null?void 0:t.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:Qs});if(u.error)throw u.error;const d=await u.json(),p=(a=u.headers.get("x-total-count"))!==null&&a!==void 0?a:0,h=(c=(o=u.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&c!==void 0?c:[];return h.length>0&&(h.forEach(y=>{const b=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),f=JSON.parse(y.split(";")[1].split("=")[1]);l[`${f}Page`]=b}),l.total=parseInt(p)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(A(l))return{data:{users:[]},error:l};throw l}}async getUserById(t){try{return await j(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:ve})}catch(e){if(A(e))return{data:{user:null},error:e};throw e}}async updateUserById(t,e){try{return await j(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:e,headers:this.headers,xform:ve})}catch(r){if(A(r))return{data:{user:null},error:r};throw r}}async deleteUser(t,e=!1){try{return await j(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:e},xform:ve})}catch(r){if(A(r))return{data:{user:null},error:r};throw r}}async _listFactors(t){try{const{data:e,error:r}=await j(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:e,error:r}}catch(e){if(A(e))return{data:null,error:e};throw e}}async _deleteFactor(t){try{return{data:await j(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(e){if(A(e))return{data:null,error:e};throw e}}}const ea={getItem:s=>it()?globalThis.localStorage.getItem(s):null,setItem:(s,t)=>{it()&&globalThis.localStorage.setItem(s,t)},removeItem:s=>{it()&&globalThis.localStorage.removeItem(s)}};function on(s={}){return{getItem:t=>s[t]||null,setItem:(t,e)=>{s[t]=e},removeItem:t=>{delete s[t]}}}function ta(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Fe={debug:!!(globalThis&&it()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class jn extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class ra extends jn{}async function na(s,t,e){Fe.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",s,t);const r=new globalThis.AbortController;return t>0&&setTimeout(()=>{r.abort(),Fe.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",s)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(s,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async n=>{if(n){Fe.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",s,n.name);try{return await e()}finally{Fe.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",s,n.name)}}else{if(t===0)throw Fe.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",s),new ra(`Acquiring an exclusive Navigator LockManager lock "${s}" immediately failed`);if(Fe.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await e()}}))}ta();const ia={url:ks,storageKey:Os,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Es,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function ln(s,t,e){return await e()}class st{constructor(t){var e,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=st.nextInstanceID,st.nextInstanceID+=1,this.instanceID>0&&X()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},ia),t);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new Zs({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=An(n.fetch),this.lock=n.lock||ln,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:X()&&(!((e=globalThis==null?void 0:globalThis.navigator)===null||e===void 0)&&e.locks)?this.lock=na:this.lock=ln,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?n.storage?this.storage=n.storage:it()?this.storage=ea:(this.memoryStorage={},this.storage=on(this.memoryStorage)):(this.memoryStorage={},this.storage=on(this.memoryStorage)),X()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...t){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Tn}) ${new Date().toISOString()}`,...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{const e=As(window.location.href);let r="none";if(this._isImplicitGrantCallback(e)?r="implicit":await this._isPKCECallback(e)&&(r="pkce"),X()&&this.detectSessionInUrl&&r!=="none"){const{data:n,error:i}=await this._getSessionFromURL(e,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),Hs(i)){const c=(t=i.details)===null||t===void 0?void 0:t.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:a,redirectType:o}=n;return this._debug("#_initialize()","detected session in URL",a,"redirect type",o),await this._saveSession(a),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return A(e)?{error:e}:{error:new $n("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var e,r,n;try{const i=await j(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(e=t==null?void 0:t.options)===null||e===void 0?void 0:e.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(n=t==null?void 0:t.options)===null||n===void 0?void 0:n.captchaToken}},xform:fe}),{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const c=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(i){if(A(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(t){var e,r,n;try{let i;if("email"in t){const{email:u,password:d,options:p}=t;let h=null,y=null;this.flowType==="pkce"&&([h,y]=await qe(this.storage,this.storageKey)),i=await j(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:p==null?void 0:p.emailRedirectTo,body:{email:u,password:d,data:(e=p==null?void 0:p.data)!==null&&e!==void 0?e:{},gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken},code_challenge:h,code_challenge_method:y},xform:fe})}else if("phone"in t){const{phone:u,password:d,options:p}=t;i=await j(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:d,data:(r=p==null?void 0:p.data)!==null&&r!==void 0?r:{},channel:(n=p==null?void 0:p.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken}},xform:fe})}else throw new pt("You must provide either an email or phone number and a password");const{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const c=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(i){if(A(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(t){try{let e;if("email"in t){const{email:i,password:a,options:o}=t;e=await j(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:an})}else if("phone"in t){const{phone:i,password:a,options:o}=t;e=await j(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:an})}else throw new pt("You must provide either an email or phone number and a password");const{data:r,error:n}=e;return n?{data:{user:null,session:null},error:n}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Yt}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:n})}catch(e){if(A(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOAuth(t){var e,r,n,i;return await this._handleProviderSignIn(t.provider,{redirectTo:(e=t.options)===null||e===void 0?void 0:e.redirectTo,scopes:(r=t.options)===null||r===void 0?void 0:r.scopes,queryParams:(n=t.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=t.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async _exchangeCodeForSession(t){const e=await dt(this.storage,`${this.storageKey}-code-verifier`),[r,n]=(e??"").split("/");try{const{data:i,error:a}=await j(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:r},xform:fe});if(await ft(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new Yt}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:a})}catch(i){if(A(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(t){try{const{options:e,provider:r,token:n,access_token:i,nonce:a}=t,o=await j(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:n,access_token:i,nonce:a,gotrue_meta_security:{captcha_token:e==null?void 0:e.captchaToken}},xform:fe}),{data:c,error:l}=o;return l?{data:{user:null,session:null},error:l}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Yt}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:l})}catch(e){if(A(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOtp(t){var e,r,n,i,a;try{if("email"in t){const{email:o,options:c}=t;let l=null,u=null;this.flowType==="pkce"&&([l,u]=await qe(this.storage,this.storageKey));const{error:d}=await j(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(e=c==null?void 0:c.data)!==null&&e!==void 0?e:{},create_user:(r=c==null?void 0:c.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:l,code_challenge_method:u},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in t){const{phone:o,options:c}=t,{data:l,error:u}=await j(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(n=c==null?void 0:c.data)!==null&&n!==void 0?n:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(a=c==null?void 0:c.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:l==null?void 0:l.message_id},error:u}}throw new pt("You must provide either an email or phone number.")}catch(o){if(A(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(t){var e,r;try{let n,i;"options"in t&&(n=(e=t.options)===null||e===void 0?void 0:e.redirectTo,i=(r=t.options)===null||r===void 0?void 0:r.captchaToken);const{data:a,error:o}=await j(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:fe});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const c=a.session,l=a.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(n){if(A(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(t){var e,r,n;try{let i=null,a=null;return this.flowType==="pkce"&&([i,a]=await qe(this.storage,this.storageKey)),await j(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(r=(e=t.options)===null||e===void 0?void 0:e.redirectTo)!==null&&r!==void 0?r:void 0}),!((n=t==null?void 0:t.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:a}),headers:this.headers,xform:Gs})}catch(i){if(A(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:e},error:r}=t;if(r)throw r;if(!e)throw new de;const{error:n}=await j(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:e.access_token});return{data:{user:null,session:null},error:n}})}catch(t){if(A(t))return{data:{user:null,session:null},error:t};throw t}}async resend(t){try{const e=`${this.url}/resend`;if("email"in t){const{email:r,type:n,options:i}=t,{error:a}=await j(this.fetch,"POST",e,{headers:this.headers,body:{email:r,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in t){const{phone:r,type:n,options:i}=t,{data:a,error:o}=await j(this.fetch,"POST",e,{headers:this.headers,body:{phone:r,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:o}}throw new pt("You must provide either an email or phone number and a type")}catch(e){if(A(e))return{data:{user:null,session:null},error:e};throw e}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(t,e){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await r,await e()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=e();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const e=await this.__loadSession();return await t(e)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const e=await dt(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",e),e!==null&&(this._isValidSession(e)?t=e:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const r=t.expires_at?t.expires_at*1e3-Date.now()<Qt:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",t.expires_at),!r){if(this.storage.isServer){let a=this.suppressGetSessionWarning;t=new Proxy(t,{get:(c,l,u)=>(!a&&l==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,l,u))})}return{data:{session:t},error:null}}const{session:n,error:i}=await this._callRefreshToken(t.refresh_token);return i?{data:{session:null},error:i}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await j(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:ve}):await this._useSession(async e=>{var r,n,i;const{data:a,error:o}=e;if(o)throw o;return!(!((r=a.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new de}:await j(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=a.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:ve})})}catch(e){if(A(e))return Bs(e)&&(await this._removeSession(),await ft(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:e};throw e}}async updateUser(t,e={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,e))}async _updateUser(t,e={}){try{return await this._useSession(async r=>{const{data:n,error:i}=r;if(i)throw i;if(!n.session)throw new de;const a=n.session;let o=null,c=null;this.flowType==="pkce"&&t.email!=null&&([o,c]=await qe(this.storage,this.storageKey));const{data:l,error:u}=await j(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:e==null?void 0:e.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:o,code_challenge_method:c}),jwt:a.access_token,xform:ve});if(u)throw u;return a.user=l.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(r){if(A(r))return{data:{user:null},error:r};throw r}}_decodeJWT(t){return tn(t)}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new de;const e=Date.now()/1e3;let r=e,n=!0,i=null;const a=tn(t.access_token);if(a.exp&&(r=a.exp,n=r<=e),n){const{session:o,error:c}=await this._callRefreshToken(t.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!o)return{data:{user:null,session:null},error:null};i=o}else{const{data:o,error:c}=await this._getUser(t.access_token);if(c)throw c;i={access_token:t.access_token,refresh_token:t.refresh_token,user:o.user,token_type:"bearer",expires_in:r-e,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(e){if(A(e))return{data:{session:null,user:null},error:e};throw e}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async e=>{var r;if(!t){const{data:a,error:o}=e;if(o)throw o;t=(r=a.session)!==null&&r!==void 0?r:void 0}if(!(t!=null&&t.refresh_token))throw new de;const{session:n,error:i}=await this._callRefreshToken(t.refresh_token);return i?{data:{user:null,session:null},error:i}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(e){if(A(e))return{data:{user:null,session:null},error:e};throw e}}async _getSessionFromURL(t,e){try{if(!X())throw new vt("No browser detected.");if(t.error||t.error_description||t.error_code)throw new vt(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(e){case"implicit":if(this.flowType==="pkce")throw new rn("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new vt("Not a valid implicit grant flow url.");break;default:}if(e==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new rn("No code detected.");const{data:w,error:S}=await this._exchangeCodeForSession(t.code);if(S)throw S;const _=new URL(window.location.href);return _.searchParams.delete("code"),window.history.replaceState(window.history.state,"",_.toString()),{data:{session:w.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:n,access_token:i,refresh_token:a,expires_in:o,expires_at:c,token_type:l}=t;if(!i||!o||!a||!l)throw new vt("No session defined in URL");const u=Math.round(Date.now()/1e3),d=parseInt(o);let p=u+d;c&&(p=parseInt(c));const h=p-u;h*1e3<=Be&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${h}s, should have been closer to ${d}s`);const y=p-d;u-y>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",y,p,u):u-y<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",y,p,u);const{data:b,error:f}=await this._getUser(i);if(f)throw f;const m={provider_token:r,provider_refresh_token:n,access_token:i,expires_in:d,expires_at:p,refresh_token:a,token_type:l,user:b.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:m,redirectType:t.type},error:null}}catch(r){if(A(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const e=await dt(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&e)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async e=>{var r;const{data:n,error:i}=e;if(i)return{error:i};const a=(r=n.session)===null||r===void 0?void 0:r.access_token;if(a){const{error:o}=await this.admin.signOut(a,t);if(o&&!(Fs(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return t!=="others"&&(await this._removeSession(),await ft(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(t){const e=Ps(),r={id:e,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",e),this.stateChangeEmitters.delete(e)}};return this._debug("#onAuthStateChange()","registered callback with id",e),this.stateChangeEmitters.set(e,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(e)})))(),{data:{subscription:r}}}async _emitInitialSession(t){return await this._useSession(async e=>{var r,n;try{const{data:{session:i},error:a}=e;if(a)throw a;await((r=this.stateChangeEmitters.get(t))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",t,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(t))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",i),console.error(i)}})}async resetPasswordForEmail(t,e={}){let r=null,n=null;this.flowType==="pkce"&&([r,n]=await qe(this.storage,this.storageKey,!0));try{return await j(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:r,code_challenge_method:n,gotrue_meta_security:{captcha_token:e.captchaToken}},headers:this.headers,redirectTo:e.redirectTo})}catch(i){if(A(i))return{data:null,error:i};throw i}}async getUserIdentities(){var t;try{const{data:e,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(t=e.user.identities)!==null&&t!==void 0?t:[]},error:null}}catch(e){if(A(e))return{data:null,error:e};throw e}}async linkIdentity(t){var e;try{const{data:r,error:n}=await this._useSession(async i=>{var a,o,c,l,u;const{data:d,error:p}=i;if(p)throw p;const h=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(a=t.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=t.options)===null||o===void 0?void 0:o.scopes,queryParams:(c=t.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await j(this.fetch,"GET",h,{headers:this.headers,jwt:(u=(l=d.session)===null||l===void 0?void 0:l.access_token)!==null&&u!==void 0?u:void 0})});if(n)throw n;return X()&&!(!((e=t.options)===null||e===void 0)&&e.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:t.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(A(r))return{data:{provider:t.provider,url:null},error:r};throw r}}async unlinkIdentity(t){try{return await this._useSession(async e=>{var r,n;const{data:i,error:a}=e;if(a)throw a;return await j(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(n=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&n!==void 0?n:void 0})})}catch(e){if(A(e))return{data:null,error:e};throw e}}async _refreshAccessToken(t){const e=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(e,"begin");try{const r=Date.now();return await Rs(async n=>(n>0&&await js(200*Math.pow(2,n-1)),this._debug(e,"refreshing attempt",n),await j(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:fe})),(n,i)=>{const a=200*Math.pow(2,n);return i&&Xt(i)&&Date.now()+a-r<Be})}catch(r){if(this._debug(e,"error",r),A(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(e,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,e){const r=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:e.redirectTo,scopes:e.scopes,queryParams:e.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",e,"url",r),X()&&!e.skipBrowserRedirect&&window.location.assign(r),{data:{provider:t,url:r},error:null}}async _recoverAndRefresh(){var t;const e="#_recoverAndRefresh()";this._debug(e,"begin");try{const r=await dt(this.storage,this.storageKey);if(this._debug(e,"session from storage",r),!this._isValidSession(r)){this._debug(e,"session is not valid"),r!==null&&await this._removeSession();return}const n=((t=r.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<Qt;if(this._debug(e,`session has${n?"":" not"} expired with margin of ${Qt}s`),n){if(this.autoRefreshToken&&r.refresh_token){const{error:i}=await this._callRefreshToken(r.refresh_token);i&&(console.error(i),Xt(i)||(this._debug(e,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(e,"error",r),console.error(r);return}finally{this._debug(e,"end")}}async _callRefreshToken(t){var e,r;if(!t)throw new de;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new kt;const{data:i,error:a}=await this._refreshAccessToken(t);if(a)throw a;if(!i.session)throw new de;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const o={session:i.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(i){if(this._debug(n,"error",i),A(i)){const a={session:null,error:i};return Xt(i)||await this._removeSession(),(e=this.refreshingDeferred)===null||e===void 0||e.resolve(a),a}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(t,e,r=!0){const n=`#_notifyAllSubscribers(${t})`;this._debug(n,"begin",e,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:t,session:e});const i=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(t,e)}catch(c){i.push(c)}});if(await Promise.all(a),i.length>0){for(let o=0;o<i.length;o+=1)console.error(i[o]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await Cn(this.storage,this.storageKey,t)}async _removeSession(){this._debug("#_removeSession()"),await ft(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&X()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(e){console.error("removing visibilitychange callback failed",e)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),Be);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async e=>{const{data:{session:r}}=e;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((r.expires_at*1e3-t)/Be);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${Be}ms, refresh threshold is ${ar} ticks`),n<=ar&&await this._callRefreshToken(r.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof jn)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!X()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const e=`#_onVisibilityChanged(${t})`;this._debug(e,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(e,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,e,r){const n=[`provider=${encodeURIComponent(e)}`];if(r!=null&&r.redirectTo&&n.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&n.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,a]=await qe(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(a)}`});n.push(o.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);n.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&n.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${t}?${n.join("&")}`}async _unenroll(t){try{return await this._useSession(async e=>{var r;const{data:n,error:i}=e;return i?{data:null,error:i}:await j(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token})})}catch(e){if(A(e))return{data:null,error:e};throw e}}async _enroll(t){try{return await this._useSession(async e=>{var r,n;const{data:i,error:a}=e;if(a)return{data:null,error:a};const o=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:{issuer:t.issuer}),{data:c,error:l}=await j(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return l?{data:null,error:l}:(t.factorType==="totp"&&(!((n=c==null?void 0:c.totp)===null||n===void 0)&&n.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(e){if(A(e))return{data:null,error:e};throw e}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async e=>{var r;const{data:n,error:i}=e;if(i)return{data:null,error:i};const{data:a,error:o}=await j(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:{code:t.code,challenge_id:t.challengeId},headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:o})})}catch(e){if(A(e))return{data:null,error:e};throw e}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async e=>{var r;const{data:n,error:i}=e;return i?{data:null,error:i}:await j(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:{channel:t.channel},headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token})})}catch(e){if(A(e))return{data:null,error:e};throw e}})}async _challengeAndVerify(t){const{data:e,error:r}=await this._challenge({factorId:t.factorId});return r?{data:null,error:r}:await this._verify({factorId:t.factorId,challengeId:e.id,code:t.code})}async _listFactors(){const{data:{user:t},error:e}=await this.getUser();if(e)return{data:null,error:e};const r=(t==null?void 0:t.factors)||[],n=r.filter(a=>a.factor_type==="totp"&&a.status==="verified"),i=r.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:r,totp:n,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async t=>{var e,r;const{data:{session:n},error:i}=t;if(i)return{data:null,error:i};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const a=this._decodeJWT(n.access_token);let o=null;a.aal&&(o=a.aal);let c=o;((r=(e=n.user.factors)===null||e===void 0?void 0:e.filter(d=>d.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(c="aal2");const u=a.amr||[];return{data:{currentLevel:o,nextLevel:c,currentAuthenticationMethods:u},error:null}}))}}st.nextInstanceID=0;const sa=st;class aa extends sa{constructor(t){super(t)}}var oa=function(s,t,e,r){function n(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function o(u){try{l(r.next(u))}catch(d){a(d)}}function c(u){try{l(r.throw(u))}catch(d){a(d)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((r=r.apply(s,t||[])).next())})};class la{constructor(t,e,r){var n,i,a;if(this.supabaseUrl=t,this.supabaseKey=e,!t)throw new Error("supabaseUrl is required.");if(!e)throw new Error("supabaseKey is required.");const o=bs(t);this.realtimeUrl=`${o}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${o}/auth/v1`,this.storageUrl=`${o}/storage/v1`,this.functionsUrl=`${o}/functions/v1`;const c=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,l={db:fs,realtime:vs,auth:Object.assign(Object.assign({},ps),{storageKey:c}),global:ds},u=Ss(r??{},l);this.storageKey=(n=u.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=u.global.headers)!==null&&i!==void 0?i:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(d,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=u.auth)!==null&&a!==void 0?a:{},this.headers,u.global.fetch),this.fetch=ws(e,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new Ii(`${o}/rest/v1`,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),u.accessToken||this._listenForAuthEvents()}get functions(){return new Si(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new cs(this.storageUrl,this.headers,this.fetch)}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},r={}){return this.rest.rpc(t,e,r)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var t,e;return oa(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(e=(t=r.session)===null||t===void 0?void 0:t.access_token)!==null&&e!==void 0?e:null})}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:r,storage:n,storageKey:i,flowType:a,lock:o,debug:c},l,u){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new aa({url:this.authUrl,headers:Object.assign(Object.assign({},d),l),storageKey:i,autoRefreshToken:t,persistSession:e,detectSessionInUrl:r,storage:n,flowType:a,lock:o,debug:c,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(t){return new Vi(this.realtimeUrl,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,r)=>{this._handleTokenChanged(e,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(t,e,r){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:t==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Rn=(s,t,e)=>new la(s,t,e);var _t=function(){return _t=Object.assign||function(s){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s},_t.apply(this,arguments)},xn=function(s,t,e,r){function n(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function o(u){try{l(r.next(u))}catch(d){a(d)}}function c(u){try{l(r.throw(u))}catch(d){a(d)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((r=r.apply(s,t||[])).next())})},In=function(s,t){var e={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,n,i,a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=o(0),a.throw=o(1),a.return=o(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,l[0]&&(e=0)),e;)try{if(r=1,n&&(i=l[0]&2?n.return:l[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,l[1])).done)return i;switch(n=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return e.label++,{value:l[1],done:!1};case 5:e.label++,n=l[1],l=[0];continue;case 7:l=e.ops.pop(),e.trys.pop();continue;default:if(i=e.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){e=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){e.label=l[1];break}if(l[0]===6&&e.label<i[1]){e.label=i[1],i=l;break}if(i&&e.label<i[2]){e.label=i[2],e.ops.push(l);break}i[2]&&e.ops.pop(),e.trys.pop();continue}l=t.call(s,e)}catch(u){l=[6,u],n=0}finally{r=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},ca=function(s,t){var e={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&t.indexOf(r)<0&&(e[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(s);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(s,r[n])&&(e[r[n]]=s[r[n]]);return e},ua=function(s,t,e){if(e||arguments.length===2)for(var r=0,n=t.length,i;r<n;r++)(i||!(r in t))&&(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return s.concat(i||Array.prototype.slice.call(t))},ha=function(s){var t=s.instanceUrl,e=s.apiKey,r=s.supabaseClient,n=r===void 0?Rn(t,e):r,i=s.httpClient,a=i===void 0?da({apiKey:e,supabaseClient:n}):i,o=s.defaultListOp,c=o===void 0?"eq":o,l=s.primaryKeys,u=l===void 0?fi:l,d=s.schema,p=d===void 0?pi:d,h=ca(s,["instanceUrl","apiKey","supabaseClient","httpClient","defaultListOp","primaryKeys","schema"]),y=_t({apiUrl:"".concat(t,"/rest/v1"),httpClient:a,defaultListOp:c,primaryKeys:u,schema:p},h);return _t({supabaseClient:function(b,f){return a("".concat(y.apiUrl,"/").concat(b),f)},getSchema:function(){return xn(void 0,void 0,void 0,function(){var b;return In(this,function(f){switch(f.label){case 0:return[4,a("".concat(y.apiUrl,"/"),{})];case 1:if(b=f.sent().json,!b||!b.swagger)throw new Error("The Open API schema is not readable");return[2,b]}})})}},vi(y))},da=function(s){var t=s.apiKey,e=s.supabaseClient;return function(r){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];return xn(void 0,ua([r],n,!0),void 0,function(a,o){var c;return o===void 0&&(o={}),In(this,function(l){switch(l.label){case 0:return[4,e.auth.getSession()];case 1:return c=l.sent().data,o.headers||(o.headers=new Headers({})),e.headers&&Object.entries(e.headers).forEach(function(u){var d=u[0],p=u[1];return o.headers.set(d,p)}),c.session&&(o.user={authenticated:!0,token:"Bearer ".concat(c.session.access_token)}),o.headers.set("apiKey",t),[2,Xn(a,o)]}})})}};const Z=Rn("https://fvckhctscjrdrvhnolzb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ2Y2toY3RzY2pyZHJ2aG5vbHpiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDE4NTk4NTYsImV4cCI6MjA1NzQzNTg1Nn0.F6LanqVaT-et4uhPMGRVlDUJ3FzqQ8XLum027Y6BoyI"),ba=ii(Z,{getIdentity:async s=>{const{data:t,error:e}=await Z.from("profiles").select("id, first_name, last_name, email, avatar").match({id:s.id}).single();if(!t||e)throw new Error;return{id:t.id,fullName:t.email,avatar:t.avatar}}}),fa=Zn(ei(ti({dataProvider:ha({instanceUrl:"https://fvckhctscjrdrvhnolzb.supabase.co",apiKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ2Y2toY3RzY2pyZHJ2aG5vbHpiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDE4NTk4NTYsImV4cCI6MjA1NzQzNTg1Nn0.F6LanqVaT-et4uhPMGRVlDUJ3FzqQ8XLum027Y6BoyI",supabaseClient:Z}),supabaseClient:Z}))),Sa=ri({...fa,invite:async({data:s})=>{const{data:t,error:e}=await Z.functions.invoke("invite",{method:"POST",body:s});if(e)throw new Error(e.message);return{data:t}},answerInvitation:async({data:s})=>{const{error:t}=await Z.functions.invoke("answer_invitation",{method:"PATCH",body:s});if(t)throw new Error(t.message);return{data:{}}},moveCard:async({data:s})=>{const{data:t,error:e}=await Z.functions.invoke("move-card",{method:"POST",body:s});if(e)throw new Error(e.message);return{data:t}},moveColumn:async({data:s})=>{const{data:t,error:e}=await Z.functions.invoke("move-column",{method:"POST",body:s});if(e)throw new Error(e.message);return{data:t}},getDocumentUrl:async({data:s})=>{const{data:e,error:r}=await Z.storage.from(s.bucket).createSignedUrl(s.filePath,s.expiresIn??86400);if(r)throw new Error(r.message);return{data:e.signedUrl}}},[{resource:"boards",afterGetOne:async s=>({...s,data:{...s.data,columns:s.data.columns?s.data.columns.map(t=>{var e;return{...t,cards:(e=t.cards)==null?void 0:e.sort((r,n)=>r.position-n.position)}}).sort((t,e)=>t.position-e.position):void 0}})},{resource:"documents",beforeCreate:async({data:s,meta:t})=>{if(s.content instanceof File){const{data:e,error:r}=await Z.storage.from("documents").upload(`${s.board_id}/${s.content.name}`,s.content,{upsert:!0});if(r)throw new Error(r.message);s.type=s.content.type,s.content=e.path}return{data:s,meta:t}}},{resource:"profiles",beforeUpdate:async({data:s,id:t,meta:e,previousData:r})=>{var n,i;return((n=s.avatar)==null?void 0:n.rawFile)instanceof File&&(s.avatar=await pa((i=s.avatar)==null?void 0:i.rawFile)),{data:s,id:t,meta:e,previousData:r}},afterRead:async s=>Array.isArray(s)?s.map(t=>({...t,avatar:t.avatar?{src:t.avatar}:t.avatar})):{...s,avatar:s.avatar?{src:s.avatar}:s.avatar}}]),pa=async s=>new Promise((t,e)=>{const r=new FileReader;r.readAsDataURL(s),r.onload=()=>t(r.result),r.onerror=e});export{ba as authProvider,Sa as dataProvider};
