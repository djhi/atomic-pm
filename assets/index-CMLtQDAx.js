const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browser-CdVzcZLh.js","assets/index-C32DZh7w.js"])))=>i.map(i=>d[i]);
import{g as fi,r as pi,c as fs,a as Vt,b as pn,d as gn,e as Gr,i as gi,_ as Ie,f as vi,h as yi,j as _i,k as wi}from"./index-C32DZh7w.js";const mi=(i,e)=>({...i,getList:async function(t,r){let s=r;s=await U({name:"beforeGetList",params:s,dataProvider:i,handlers:e,resource:t});let n=await i.getList(t,s);return n=await U({name:"afterGetList",params:n,dataProvider:i,handlers:e,resource:t}),n.data=await Promise.all(n.data.map(a=>U({name:"afterRead",params:a,dataProvider:i,handlers:e,resource:t}))),n},getOne:async function(t,r){let s=r;s=await U({name:"beforeGetOne",params:s,dataProvider:i,handlers:e,resource:t});let n=await i.getOne(t,s);return n=await U({name:"afterGetOne",params:n,dataProvider:i,handlers:e,resource:t}),n.data=await U({name:"afterRead",params:n.data,dataProvider:i,handlers:e,resource:t}),n},getMany:async function(t,r){let s=r;s=await U({name:"beforeGetMany",params:s,dataProvider:i,handlers:e,resource:t});let n=await i.getMany(t,s);return n=await U({name:"afterGetMany",params:n,dataProvider:i,handlers:e,resource:t}),n.data=await Promise.all(n.data.map(a=>U({name:"afterRead",params:a,dataProvider:i,handlers:e,resource:t}))),n},getManyReference:async function(t,r){let s=r;s=await U({name:"beforeGetManyReference",params:s,dataProvider:i,handlers:e,resource:t});let n=await i.getManyReference(t,s);return n=await U({name:"afterGetManyReference",params:n,dataProvider:i,handlers:e,resource:t}),n.data=await Promise.all(n.data.map(a=>U({name:"afterRead",params:a,dataProvider:i,handlers:e,resource:t}))),n},update:async function(t,r){let s=r;s=await U({name:"beforeUpdate",params:s,dataProvider:i,handlers:e,resource:t}),s.data=await U({name:"beforeSave",params:s.data,dataProvider:i,handlers:e,resource:t});let n=await i.update(t,s);return n=await U({name:"afterUpdate",params:n,dataProvider:i,handlers:e,resource:t}),n.data=await U({name:"afterSave",params:n.data,dataProvider:i,handlers:e,resource:t}),n},create:async function(t,r){let s=r;s=await U({name:"beforeCreate",params:s,dataProvider:i,handlers:e,resource:t}),s.data=await U({name:"beforeSave",params:s.data,dataProvider:i,handlers:e,resource:t});let n=await i.create(t,s);return n=await U({name:"afterCreate",params:n,dataProvider:i,handlers:e,resource:t}),n.data=await U({name:"afterSave",params:n.data,dataProvider:i,handlers:e,resource:t}),n},delete:async function(t,r){let s=r;s=await U({name:"beforeDelete",params:s,dataProvider:i,handlers:e,resource:t});let n=await i.delete(t,s);return n=await U({name:"afterDelete",params:n,dataProvider:i,handlers:e,resource:t}),n},updateMany:async function(t,r){let s=r;s=await U({name:"beforeUpdateMany",params:s,dataProvider:i,handlers:e,resource:t}),s.data=await U({name:"beforeSave",params:s.data,dataProvider:i,handlers:e,resource:t});let n=await i.updateMany(t,s);if(n=await U({name:"afterUpdateMany",params:n,dataProvider:i,handlers:e,resource:t}),e.filter(o=>(o.resource===t||o.resource==="*")&&o.afterSave).length>0){const{data:o}=await i.getMany(t,{ids:n.data});await Promise.all(o.map(l=>U({name:"afterSave",params:l,dataProvider:i,handlers:e,resource:t})))}return n},deleteMany:async function(t,r){let s=r;s=await U({name:"beforeDeleteMany",params:s,dataProvider:i,handlers:e,resource:t});let n=await i.deleteMany(t,s);return n=await U({name:"afterDeleteMany",params:n,dataProvider:i,handlers:e,resource:t}),n}}),U=async function({name:i,params:e,dataProvider:t,handlers:r,resource:s}){let n=e;const a=r.filter(o=>(o.resource===s||o.resource==="*")&&o[i]);for(let o of a){const l=o[i];if(Array.isArray(l))for(let c of l??[])n=await c(n,t,s);else n=await l(n,t,s)}return n};var Gt=function(){return Gt=Object.assign||function(i){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=e[s])}return i},Gt.apply(this,arguments)},ae=function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(r.next(u))}catch(h){a(h)}}function l(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):s(u.value).then(o,l)}c((r=r.apply(i,e||[])).next())})},oe=function(i,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},r,s,n,a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=o(0),a.throw=o(1),a.return=o(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(t=0)),t;)try{if(r=1,s&&(n=c[0]&2?s.return:c[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,c[1])).done)return n;switch(s=0,n&&(c=[c[0]&2,n.value]),c[0]){case 0:case 1:n=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,s=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!n||c[1]>n[0]&&c[1]<n[3])){t.label=c[1];break}if(c[0]===6&&t.label<n[1]){t.label=n[1],n=c;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(c);break}n[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(i,t)}catch(u){c=[6,u],s=0}finally{r=n=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},bi=function(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(i);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(i,r[s])&&(t[r[s]]=i[r[s]]);return t},Si=function(i,e){var t=e.getIdentity,r=e.getPermissions,s=e.redirectTo,n={login:function(a){return ae(this,void 0,void 0,function(){var o,l,c;return oe(this,function(u){switch(u.label){case 0:return o=a,o.email&&o.password?[4,i.auth.signInWithPassword(o)]:[3,2];case 1:if(l=u.sent().error,l)throw l;return[2];case 2:return c=a,c.provider?(i.auth.signInWithOAuth(Gt(Gt({},c),{options:{redirectTo:s}})),[2,Promise.reject()]):[2,Promise.reject(new Error("Invalid login parameters"))]}})})},setPassword:function(a){return ae(this,arguments,void 0,function(o){var l,c,u=o.access_token,h=o.refresh_token,f=o.password;return oe(this,function(d){switch(d.label){case 0:return[4,i.auth.setSession({access_token:u,refresh_token:h})];case 1:if(l=d.sent().error,l)throw l;return[4,i.auth.updateUser({password:f})];case 2:if(c=d.sent().error,c)throw c;return[2,void 0]}})})},resetPassword:function(a){return ae(this,void 0,void 0,function(){var o,l,c;return oe(this,function(u){switch(u.label){case 0:return o=a.email,l=bi(a,["email"]),[4,i.auth.resetPasswordForEmail(o,l)];case 1:if(c=u.sent().error,c)throw c;return[2,void 0]}})})},logout:function(){return ae(this,void 0,void 0,function(){var a;return oe(this,function(o){switch(o.label){case 0:return[4,i.auth.signOut()];case 1:if(a=o.sent().error,a)throw a;return[2]}})})},checkError:function(a){return ae(this,void 0,void 0,function(){return oe(this,function(o){return a.status===401||a.status===403||a.status===400&&a.name==="AuthSessionMissingError"?[2,Promise.reject()]:[2,Promise.resolve()]})})},handleCallback:function(){return ae(this,void 0,void 0,function(){var a,o,l,c;return oe(this,function(u){return a=ps(),o=a.access_token,l=a.refresh_token,c=a.type,(c==="recovery"||c==="invite")&&o&&l?[2,{redirectTo:function(){return{pathname:s?"".concat(s,"/set-password"):"/set-password",search:"access_token=".concat(o,"&refresh_token=").concat(l,"&type=").concat(c)}}}]:[2]})})},checkAuth:function(){return ae(this,void 0,void 0,function(){var a,o,l,c,u;return oe(this,function(h){switch(h.label){case 0:if(window.location.pathname==="/set-password"||window.location.hash.includes("#/set-password"))return[2];if(window.location.pathname==="/forgot-password"||window.location.hash.includes("#/forgot-password"))return[2];if(a=ps(),o=a.access_token,l=a.refresh_token,c=a.type,(c==="recovery"||c==="invite")&&o&&l)throw{redirectTo:function(){return{pathname:s?"".concat(s,"/set-password"):"/set-password",search:"access_token=".concat(o,"&refresh_token=").concat(l,"&type=").concat(c)}},message:!1};return[4,i.auth.getSession()];case 1:return u=h.sent().data,u.session==null?[2,Promise.reject()]:[2,Promise.resolve()]}})})},getPermissions:function(){return ae(this,void 0,void 0,function(){var a,o,l,c;return oe(this,function(u){switch(u.label){case 0:return typeof r!="function"?[2]:window.location.pathname==="/set-password"||window.location.hash.includes("#/set-password")||window.location.pathname==="/forgot-password"||window.location.hash.includes("#/forgot-password")?[2]:[4,i.auth.getUser()];case 1:return a=u.sent(),o=a.data,l=a.error,l||o.user==null?[2]:[4,r(o.user)];case 2:return c=u.sent(),[2,c]}})})}};return typeof t=="function"&&(n.getIdentity=function(){return ae(void 0,void 0,void 0,function(){var a,o;return oe(this,function(l){switch(l.label){case 0:return[4,i.auth.getUser()];case 1:if(a=l.sent().data,a.user==null)throw new Error;return[4,t(a.user)];case 2:return o=l.sent(),[2,o]}})})}),n},ps=function(){var i=fi(),e=new URLSearchParams(i),t=e.get("access_token"),r=e.get("refresh_token"),s=e.get("type");return{access_token:t,refresh_token:r,type:s}},Rr=function(){return Rr=Object.assign||function(i){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=e[s])}return i},Rr.apply(this,arguments)},ki=function(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(i);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(i,r[s])&&(t[r[s]]=i[r[s]]);return t},gs=function(i){return typeof i=="object"&&!Array.isArray(i)&&i!==null},cr=function(i,e){for(var t=i[e[0]],r=1;r<e.length;++r)t=t[e[r]];return t},jr=function(i,e){var t=i.filter,r=i.meta,s=r===void 0?{}:r,n={};return n.filter={},Object.keys(t).forEach(function(a){var o=[a],l;if(a.split("@")[0]!==""&&gs(t[a])){var c=t[a];do{var u=cr(t,o),h=Object.keys(u)[0];o.push(h),c=u[h]}while(gs(c));a=o.join("."),l=[c]}else l=[t[a]];var f=a.split("@"),d=f.length==2?f[1]:e;if(["like","ilike"].includes(d))l=cr(t,o).trim().split(/\s+/);else if(["or","and"].includes(d)){var g=jr({filter:cr(t,o)},e).filter,b=[];Object.entries(g).forEach(function(p){var _=p[0],w=p[1];Array.isArray(w)?b.push.apply(b,w.map(function(S){return[_,S].join(".")})):b.push([_,w].join("."))}),l=["(".concat(b.join(","),")")]}l.forEach(function(p){var _=function(){return d.length===0?"".concat(p):d.includes("like")?"".concat(d,".*").concat(p,"*"):["and","or"].includes(d)?"".concat(p):"".concat(d,".").concat(p)}();n.filter[f[0]]===void 0?["and","or"].includes(d)?n.filter[d]=_:n.filter[f[0]]=_:Array.isArray(n[f[0]])?n.filter[f[0]].push(_):n.filter[f[0]]=[n.filter[f[0]],_]})}),s!=null&&s.columns&&(n.select=Array.isArray(s.columns)?s.columns.join(","):s.columns),n},le=function(i,e){return e&&e.get(i)||["id"]},vs=function(i,e){return zt(e)?JSON.parse(i.toString()):[i.toString()]},Kt=function(i,e){return zt(e)?JSON.stringify(e.map(function(t){return i[t]})):i[e[0]]},ys=function(i,e){var t=Rr({},i);return e.forEach(function(r){delete t[r]}),t},Ge=function(i,e){return e.length===1&&e[0]==="id"?i:Object.assign(i,{id:Kt(i,e)})},ur=function(i,e){if(e.length===1&&e[0]==="id")return i;i.id;var t=ki(i,["id"]);return t},zt=function(i){return i.length>1},Pe=function(i,e,t,r){var s,n;r===void 0&&(r=null);var a={};if(Array.isArray(e)&&e.length>1){if(t.startsWith("rpc/")){console.error("PostgREST's rpc endpoints are not intended to be handled as views. Therefore, no query generation for multiple key values implemented!");return}zt(i)?a={or:"(".concat(e.map(function(c){var u=vs(c,i);return"and(".concat(i.map(function(h,f){return"".concat(h,".eq.").concat(u[f])}).join(","),")")}),")")}:a=(s={},s[i[0]]="in.(".concat(e.join(","),")"),s)}else if(e){var o=e.toString(),l=vs(o,i);zt(i)?t.startsWith("rpc/")?(a={},i.map(function(c,u){return a[c]="".concat(l[u])})):a={and:"(".concat(i.map(function(c,u){return"".concat(c,".eq.").concat(l[u])}),")")}:a=(n={},n[i[0]]="eq.".concat(o),n)}return r&&r.columns&&(a.select=Array.isArray(r.columns)?r.columns.join(","):r.columns),a},hr=function(i,e,t,r){r===void 0&&(r="asc,desc");var s=r.split(",")[e==="ASC"?0:1];return i=="id"?t.map(function(n){return"".concat(n,".").concat(s)}).join(","):"".concat(i,".").concat(s)},dr,_s;function Qt(){if(_s)return dr;_s=1;var i=typeof Map=="function"&&Map.prototype,e=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,t=i&&e&&typeof e.get=="function"?e.get:null,r=i&&Map.prototype.forEach,s=typeof Set=="function"&&Set.prototype,n=Object.getOwnPropertyDescriptor&&s?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,a=s&&n&&typeof n.get=="function"?n.get:null,o=s&&Set.prototype.forEach,l=typeof WeakMap=="function"&&WeakMap.prototype,c=l?WeakMap.prototype.has:null,u=typeof WeakSet=="function"&&WeakSet.prototype,h=u?WeakSet.prototype.has:null,f=typeof WeakRef=="function"&&WeakRef.prototype,d=f?WeakRef.prototype.deref:null,g=Boolean.prototype.valueOf,b=Object.prototype.toString,p=Function.prototype.toString,_=String.prototype.match,w=String.prototype.slice,S=String.prototype.replace,m=String.prototype.toUpperCase,k=String.prototype.toLowerCase,T=RegExp.prototype.test,C=Array.prototype.concat,E=Array.prototype.join,D=Array.prototype.slice,P=Math.floor,B=typeof BigInt=="function"?BigInt.prototype.valueOf:null,O=Object.getOwnPropertySymbols,z=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Y=typeof Symbol=="function"&&typeof Symbol.iterator=="object",X=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Y||!0)?Symbol.toStringTag:null,Te=Object.prototype.propertyIsEnumerable,qe=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(v){return v.__proto__}:null);function I(v,y){if(v===1/0||v===-1/0||v!==v||v&&v>-1e3&&v<1e3||T.call(/e/,y))return y;var L=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof v=="number"){var N=v<0?-P(-v):P(v);if(N!==v){var F=String(N),R=w.call(y,F.length+1);return S.call(F,L,"$&_")+"."+S.call(S.call(R,/([0-9]{3})/g,"$&_"),/_$/,"")}}return S.call(y,L,"$&_")}var de=pi,Ee=de.custom,ht=pt(Ee)?Ee:null,dt={__proto__:null,double:'"',single:"'"},Xt={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};dr=function v(y,L,N,F){var R=L||{};if(ie(R,"quoteStyle")&&!ie(dt,R.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(ie(R,"maxStringLength")&&(typeof R.maxStringLength=="number"?R.maxStringLength<0&&R.maxStringLength!==1/0:R.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var pe=ie(R,"customInspect")?R.customInspect:!0;if(typeof pe!="boolean"&&pe!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(ie(R,"indent")&&R.indent!==null&&R.indent!=="	"&&!(parseInt(R.indent,10)===R.indent&&R.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(ie(R,"numericSeparator")&&typeof R.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var Ae=R.numericSeparator;if(typeof y>"u")return"undefined";if(y===null)return"null";if(typeof y=="boolean")return y?"true":"false";if(typeof y=="string")return ss(y,R);if(typeof y=="number"){if(y===0)return 1/0/y>0?"0":"-0";var W=String(y);return Ae?I(y,W):W}if(typeof y=="bigint"){var ge=String(y)+"n";return Ae?I(y,ge):ge}var rr=typeof R.depth>"u"?5:R.depth;if(typeof N>"u"&&(N=0),N>=rr&&rr>0&&typeof y=="object")return Me(y)?"[Array]":"[Object]";var He=ui(R,N);if(typeof F>"u")F=[];else if(rs(F,y)>=0)return"[Circular]";function Z(Ke,xt,di){if(xt&&(F=D.call(F),F.push(xt)),di){var ds={depth:R.depth};return ie(R,"quoteStyle")&&(ds.quoteStyle=R.quoteStyle),v(Ke,ds,N+1,F)}return v(Ke,R,N+1,F)}if(typeof y=="function"&&!Be(y)){var is=ti(y),as=Rt(y,Z);return"[Function"+(is?": "+is:" (anonymous)")+"]"+(as.length>0?" { "+E.call(as,", ")+" }":"")}if(pt(y)){var os=Y?S.call(String(y),/^(Symbol\(.*\))_[^)]*$/,"$1"):z.call(y);return typeof y=="object"&&!Y?vt(os):os}if(oi(y)){for(var yt="<"+k.call(String(y.nodeName)),sr=y.attributes||[],jt=0;jt<sr.length;jt++)yt+=" "+sr[jt].name+"="+Ne(Oe(sr[jt].value),"double",R);return yt+=">",y.childNodes&&y.childNodes.length&&(yt+="..."),yt+="</"+k.call(String(y.nodeName))+">",yt}if(Me(y)){if(y.length===0)return"[]";var nr=Rt(y,Z);return He&&!ci(nr)?"["+tr(nr,He)+"]":"[ "+E.call(nr,", ")+" ]"}if(ne(y)){var ir=Rt(y,Z);return!("cause"in Error.prototype)&&"cause"in y&&!Te.call(y,"cause")?"{ ["+String(y)+"] "+E.call(C.call("[cause]: "+Z(y.cause),ir),", ")+" }":ir.length===0?"["+String(y)+"]":"{ ["+String(y)+"] "+E.call(ir,", ")+" }"}if(typeof y=="object"&&pe){if(ht&&typeof y[ht]=="function"&&de)return de(y,{depth:rr-N});if(pe!=="symbol"&&typeof y.inspect=="function")return y.inspect()}if(ri(y)){var ls=[];return r&&r.call(y,function(Ke,xt){ls.push(Z(xt,y,!0)+" => "+Z(Ke,y))}),ns("Map",t.call(y),ls,He)}if(ii(y)){var cs=[];return o&&o.call(y,function(Ke){cs.push(Z(Ke,y))}),ns("Set",a.call(y),cs,He)}if(si(y))return er("WeakMap");if(ai(y))return er("WeakSet");if(ni(y))return er("WeakRef");if(ft(y))return vt(Z(Number(y)));if(gt(y))return vt(Z(B.call(y)));if(Zt(y))return vt(g.call(y));if(Ct(y))return vt(Z(String(y)));if(typeof window<"u"&&y===window)return"{ [object Window] }";if(typeof globalThis<"u"&&y===globalThis||typeof fs<"u"&&y===fs)return"{ [object globalThis] }";if(!Fe(y)&&!Be(y)){var ar=Rt(y,Z),us=qe?qe(y)===Object.prototype:y instanceof Object||y.constructor===Object,or=y instanceof Object?"":"null prototype",hs=!us&&X&&Object(y)===y&&X in y?w.call(fe(y),8,-1):or?"Object":"",hi=us||typeof y.constructor!="function"?"":y.constructor.name?y.constructor.name+" ":"",lr=hi+(hs||or?"["+E.call(C.call([],hs||[],or||[]),": ")+"] ":"");return ar.length===0?lr+"{}":He?lr+"{"+tr(ar,He)+"}":lr+"{ "+E.call(ar,", ")+" }"}return String(y)};function Ne(v,y,L){var N=L.quoteStyle||y,F=dt[N];return F+v+F}function Oe(v){return S.call(String(v),/"/g,"&quot;")}function te(v){return!X||!(typeof v=="object"&&(X in v||typeof v[X]<"u"))}function Me(v){return fe(v)==="[object Array]"&&te(v)}function Fe(v){return fe(v)==="[object Date]"&&te(v)}function Be(v){return fe(v)==="[object RegExp]"&&te(v)}function ne(v){return fe(v)==="[object Error]"&&te(v)}function Ct(v){return fe(v)==="[object String]"&&te(v)}function ft(v){return fe(v)==="[object Number]"&&te(v)}function Zt(v){return fe(v)==="[object Boolean]"&&te(v)}function pt(v){if(Y)return v&&typeof v=="object"&&v instanceof Symbol;if(typeof v=="symbol")return!0;if(!v||typeof v!="object"||!z)return!1;try{return z.call(v),!0}catch{}return!1}function gt(v){if(!v||typeof v!="object"||!B)return!1;try{return B.call(v),!0}catch{}return!1}var ei=Object.prototype.hasOwnProperty||function(v){return v in this};function ie(v,y){return ei.call(v,y)}function fe(v){return b.call(v)}function ti(v){if(v.name)return v.name;var y=_.call(p.call(v),/^function\s*([\w$]+)/);return y?y[1]:null}function rs(v,y){if(v.indexOf)return v.indexOf(y);for(var L=0,N=v.length;L<N;L++)if(v[L]===y)return L;return-1}function ri(v){if(!t||!v||typeof v!="object")return!1;try{t.call(v);try{a.call(v)}catch{return!0}return v instanceof Map}catch{}return!1}function si(v){if(!c||!v||typeof v!="object")return!1;try{c.call(v,c);try{h.call(v,h)}catch{return!0}return v instanceof WeakMap}catch{}return!1}function ni(v){if(!d||!v||typeof v!="object")return!1;try{return d.call(v),!0}catch{}return!1}function ii(v){if(!a||!v||typeof v!="object")return!1;try{a.call(v);try{t.call(v)}catch{return!0}return v instanceof Set}catch{}return!1}function ai(v){if(!h||!v||typeof v!="object")return!1;try{h.call(v,h);try{c.call(v,c)}catch{return!0}return v instanceof WeakSet}catch{}return!1}function oi(v){return!v||typeof v!="object"?!1:typeof HTMLElement<"u"&&v instanceof HTMLElement?!0:typeof v.nodeName=="string"&&typeof v.getAttribute=="function"}function ss(v,y){if(v.length>y.maxStringLength){var L=v.length-y.maxStringLength,N="... "+L+" more character"+(L>1?"s":"");return ss(w.call(v,0,y.maxStringLength),y)+N}var F=Xt[y.quoteStyle||"single"];F.lastIndex=0;var R=S.call(S.call(v,F,"\\$1"),/[\x00-\x1f]/g,li);return Ne(R,"single",y)}function li(v){var y=v.charCodeAt(0),L={8:"b",9:"t",10:"n",12:"f",13:"r"}[y];return L?"\\"+L:"\\x"+(y<16?"0":"")+m.call(y.toString(16))}function vt(v){return"Object("+v+")"}function er(v){return v+" { ? }"}function ns(v,y,L,N){var F=N?tr(L,N):E.call(L,", ");return v+" ("+y+") {"+F+"}"}function ci(v){for(var y=0;y<v.length;y++)if(rs(v[y],`
`)>=0)return!1;return!0}function ui(v,y){var L;if(v.indent==="	")L="	";else if(typeof v.indent=="number"&&v.indent>0)L=E.call(Array(v.indent+1)," ");else return null;return{base:L,prev:E.call(Array(y+1),L)}}function tr(v,y){if(v.length===0)return"";var L=`
`+y.prev+y.base;return L+E.call(v,","+L)+`
`+y.prev}function Rt(v,y){var L=Me(v),N=[];if(L){N.length=v.length;for(var F=0;F<v.length;F++)N[F]=ie(v,F)?y(v[F],v):""}var R=typeof O=="function"?O(v):[],pe;if(Y){pe={};for(var Ae=0;Ae<R.length;Ae++)pe["$"+R[Ae]]=R[Ae]}for(var W in v)ie(v,W)&&(L&&String(Number(W))===W&&W<v.length||Y&&pe["$"+W]instanceof Symbol||(T.call(/[^\w$]/,W)?N.push(y(W,v)+": "+y(v[W],v)):N.push(W+": "+y(v[W],v))));if(typeof O=="function")for(var ge=0;ge<R.length;ge++)Te.call(v,R[ge])&&N.push("["+y(R[ge])+"]: "+y(v[R[ge]],v));return N}return dr}var fr,ws;function Ti(){if(ws)return fr;ws=1;var i=Qt(),e=Vt(),t=function(o,l,c){for(var u=o,h;(h=u.next)!=null;u=h)if(h.key===l)return u.next=h.next,c||(h.next=o.next,o.next=h),h},r=function(o,l){if(o){var c=t(o,l);return c&&c.value}},s=function(o,l,c){var u=t(o,l);u?u.value=c:o.next={key:l,next:o.next,value:c}},n=function(o,l){return o?!!t(o,l):!1},a=function(o,l){if(o)return t(o,l,!0)};return fr=function(){var l,c={assert:function(u){if(!c.has(u))throw new e("Side channel does not contain "+i(u))},delete:function(u){var h=l&&l.next,f=a(l,u);return f&&h&&h===f&&(l=void 0),!!f},get:function(u){return r(l,u)},has:function(u){return n(l,u)},set:function(u,h){l||(l={next:void 0}),s(l,u,h)}};return c},fr}var pr,ms;function vn(){if(ms)return pr;ms=1;var i=pn(),e=gn(),t=Qt(),r=Vt(),s=i("%Map%",!0),n=e("Map.prototype.get",!0),a=e("Map.prototype.set",!0),o=e("Map.prototype.has",!0),l=e("Map.prototype.delete",!0),c=e("Map.prototype.size",!0);return pr=!!s&&function(){var h,f={assert:function(d){if(!f.has(d))throw new r("Side channel does not contain "+t(d))},delete:function(d){if(h){var g=l(h,d);return c(h)===0&&(h=void 0),g}return!1},get:function(d){if(h)return n(h,d)},has:function(d){return h?o(h,d):!1},set:function(d,g){h||(h=new s),a(h,d,g)}};return f},pr}var gr,bs;function Ei(){if(bs)return gr;bs=1;var i=pn(),e=gn(),t=Qt(),r=vn(),s=Vt(),n=i("%WeakMap%",!0),a=e("WeakMap.prototype.get",!0),o=e("WeakMap.prototype.set",!0),l=e("WeakMap.prototype.has",!0),c=e("WeakMap.prototype.delete",!0);return gr=n?function(){var h,f,d={assert:function(g){if(!d.has(g))throw new s("Side channel does not contain "+t(g))},delete:function(g){if(n&&g&&(typeof g=="object"||typeof g=="function")){if(h)return c(h,g)}else if(r&&f)return f.delete(g);return!1},get:function(g){return n&&g&&(typeof g=="object"||typeof g=="function")&&h?a(h,g):f&&f.get(g)},has:function(g){return n&&g&&(typeof g=="object"||typeof g=="function")&&h?l(h,g):!!f&&f.has(g)},set:function(g,b){n&&g&&(typeof g=="object"||typeof g=="function")?(h||(h=new n),o(h,g,b)):r&&(f||(f=r()),f.set(g,b))}};return d}:r,gr}var vr,Ss;function Oi(){if(Ss)return vr;Ss=1;var i=Vt(),e=Qt(),t=Ti(),r=vn(),s=Ei(),n=s||r||t;return vr=function(){var o,l={assert:function(c){if(!l.has(c))throw new i("Side channel does not contain "+e(c))},delete:function(c){return!!o&&o.delete(c)},get:function(c){return o&&o.get(c)},has:function(c){return!!o&&o.has(c)},set:function(c,u){o||(o=n()),o.set(c,u)}};return l},vr}var yr,ks;function zr(){if(ks)return yr;ks=1;var i=String.prototype.replace,e=/%20/g,t={RFC1738:"RFC1738",RFC3986:"RFC3986"};return yr={default:t.RFC3986,formatters:{RFC1738:function(r){return i.call(r,e,"+")},RFC3986:function(r){return String(r)}},RFC1738:t.RFC1738,RFC3986:t.RFC3986},yr}var _r,Ts;function yn(){if(Ts)return _r;Ts=1;var i=zr(),e=Object.prototype.hasOwnProperty,t=Array.isArray,r=function(){for(var p=[],_=0;_<256;++_)p.push("%"+((_<16?"0":"")+_.toString(16)).toUpperCase());return p}(),s=function(_){for(;_.length>1;){var w=_.pop(),S=w.obj[w.prop];if(t(S)){for(var m=[],k=0;k<S.length;++k)typeof S[k]<"u"&&m.push(S[k]);w.obj[w.prop]=m}}},n=function(_,w){for(var S=w&&w.plainObjects?{__proto__:null}:{},m=0;m<_.length;++m)typeof _[m]<"u"&&(S[m]=_[m]);return S},a=function p(_,w,S){if(!w)return _;if(typeof w!="object"&&typeof w!="function"){if(t(_))_.push(w);else if(_&&typeof _=="object")(S&&(S.plainObjects||S.allowPrototypes)||!e.call(Object.prototype,w))&&(_[w]=!0);else return[_,w];return _}if(!_||typeof _!="object")return[_].concat(w);var m=_;return t(_)&&!t(w)&&(m=n(_,S)),t(_)&&t(w)?(w.forEach(function(k,T){if(e.call(_,T)){var C=_[T];C&&typeof C=="object"&&k&&typeof k=="object"?_[T]=p(C,k,S):_.push(k)}else _[T]=k}),_):Object.keys(w).reduce(function(k,T){var C=w[T];return e.call(k,T)?k[T]=p(k[T],C,S):k[T]=C,k},m)},o=function(_,w){return Object.keys(w).reduce(function(S,m){return S[m]=w[m],S},_)},l=function(p,_,w){var S=p.replace(/\+/g," ");if(w==="iso-8859-1")return S.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(S)}catch{return S}},c=1024,u=function(_,w,S,m,k){if(_.length===0)return _;var T=_;if(typeof _=="symbol"?T=Symbol.prototype.toString.call(_):typeof _!="string"&&(T=String(_)),S==="iso-8859-1")return escape(T).replace(/%u[0-9a-f]{4}/gi,function(z){return"%26%23"+parseInt(z.slice(2),16)+"%3B"});for(var C="",E=0;E<T.length;E+=c){for(var D=T.length>=c?T.slice(E,E+c):T,P=[],B=0;B<D.length;++B){var O=D.charCodeAt(B);if(O===45||O===46||O===95||O===126||O>=48&&O<=57||O>=65&&O<=90||O>=97&&O<=122||k===i.RFC1738&&(O===40||O===41)){P[P.length]=D.charAt(B);continue}if(O<128){P[P.length]=r[O];continue}if(O<2048){P[P.length]=r[192|O>>6]+r[128|O&63];continue}if(O<55296||O>=57344){P[P.length]=r[224|O>>12]+r[128|O>>6&63]+r[128|O&63];continue}B+=1,O=65536+((O&1023)<<10|D.charCodeAt(B)&1023),P[P.length]=r[240|O>>18]+r[128|O>>12&63]+r[128|O>>6&63]+r[128|O&63]}C+=P.join("")}return C},h=function(_){for(var w=[{obj:{o:_},prop:"o"}],S=[],m=0;m<w.length;++m)for(var k=w[m],T=k.obj[k.prop],C=Object.keys(T),E=0;E<C.length;++E){var D=C[E],P=T[D];typeof P=="object"&&P!==null&&S.indexOf(P)===-1&&(w.push({obj:T,prop:D}),S.push(P))}return s(w),_},f=function(_){return Object.prototype.toString.call(_)==="[object RegExp]"},d=function(_){return!_||typeof _!="object"?!1:!!(_.constructor&&_.constructor.isBuffer&&_.constructor.isBuffer(_))},g=function(_,w){return[].concat(_,w)},b=function(_,w){if(t(_)){for(var S=[],m=0;m<_.length;m+=1)S.push(w(_[m]));return S}return w(_)};return _r={arrayToObject:n,assign:o,combine:g,compact:h,decode:l,encode:u,isBuffer:d,isRegExp:f,maybeMap:b,merge:a},_r}var wr,Es;function Ai(){if(Es)return wr;Es=1;var i=Oi(),e=yn(),t=zr(),r=Object.prototype.hasOwnProperty,s={brackets:function(p){return p+"[]"},comma:"comma",indices:function(p,_){return p+"["+_+"]"},repeat:function(p){return p}},n=Array.isArray,a=Array.prototype.push,o=function(b,p){a.apply(b,n(p)?p:[p])},l=Date.prototype.toISOString,c=t.default,u={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:e.encode,encodeValuesOnly:!1,filter:void 0,format:c,formatter:t.formatters[c],indices:!1,serializeDate:function(p){return l.call(p)},skipNulls:!1,strictNullHandling:!1},h=function(p){return typeof p=="string"||typeof p=="number"||typeof p=="boolean"||typeof p=="symbol"||typeof p=="bigint"},f={},d=function b(p,_,w,S,m,k,T,C,E,D,P,B,O,z,Y,X,Te,qe){for(var I=p,de=qe,Ee=0,ht=!1;(de=de.get(f))!==void 0&&!ht;){var dt=de.get(p);if(Ee+=1,typeof dt<"u"){if(dt===Ee)throw new RangeError("Cyclic object value");ht=!0}typeof de.get(f)>"u"&&(Ee=0)}if(typeof D=="function"?I=D(_,I):I instanceof Date?I=O(I):w==="comma"&&n(I)&&(I=e.maybeMap(I,function(gt){return gt instanceof Date?O(gt):gt})),I===null){if(k)return E&&!X?E(_,u.encoder,Te,"key",z):_;I=""}if(h(I)||e.isBuffer(I)){if(E){var Xt=X?_:E(_,u.encoder,Te,"key",z);return[Y(Xt)+"="+Y(E(I,u.encoder,Te,"value",z))]}return[Y(_)+"="+Y(String(I))]}var Ne=[];if(typeof I>"u")return Ne;var Oe;if(w==="comma"&&n(I))X&&E&&(I=e.maybeMap(I,E)),Oe=[{value:I.length>0?I.join(",")||null:void 0}];else if(n(D))Oe=D;else{var te=Object.keys(I);Oe=P?te.sort(P):te}var Me=C?String(_).replace(/\./g,"%2E"):String(_),Fe=S&&n(I)&&I.length===1?Me+"[]":Me;if(m&&n(I)&&I.length===0)return Fe+"[]";for(var Be=0;Be<Oe.length;++Be){var ne=Oe[Be],Ct=typeof ne=="object"&&ne&&typeof ne.value<"u"?ne.value:I[ne];if(!(T&&Ct===null)){var ft=B&&C?String(ne).replace(/\./g,"%2E"):String(ne),Zt=n(I)?typeof w=="function"?w(Fe,ft):Fe:Fe+(B?"."+ft:"["+ft+"]");qe.set(p,Ee);var pt=i();pt.set(f,qe),o(Ne,b(Ct,Zt,w,S,m,k,T,C,w==="comma"&&X&&n(I)?null:E,D,P,B,O,z,Y,X,Te,pt))}}return Ne},g=function(p){if(!p)return u;if(typeof p.allowEmptyArrays<"u"&&typeof p.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof p.encodeDotInKeys<"u"&&typeof p.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(p.encoder!==null&&typeof p.encoder<"u"&&typeof p.encoder!="function")throw new TypeError("Encoder has to be a function.");var _=p.charset||u.charset;if(typeof p.charset<"u"&&p.charset!=="utf-8"&&p.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var w=t.default;if(typeof p.format<"u"){if(!r.call(t.formatters,p.format))throw new TypeError("Unknown format option provided.");w=p.format}var S=t.formatters[w],m=u.filter;(typeof p.filter=="function"||n(p.filter))&&(m=p.filter);var k;if(p.arrayFormat in s?k=p.arrayFormat:"indices"in p?k=p.indices?"indices":"repeat":k=u.arrayFormat,"commaRoundTrip"in p&&typeof p.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var T=typeof p.allowDots>"u"?p.encodeDotInKeys===!0?!0:u.allowDots:!!p.allowDots;return{addQueryPrefix:typeof p.addQueryPrefix=="boolean"?p.addQueryPrefix:u.addQueryPrefix,allowDots:T,allowEmptyArrays:typeof p.allowEmptyArrays=="boolean"?!!p.allowEmptyArrays:u.allowEmptyArrays,arrayFormat:k,charset:_,charsetSentinel:typeof p.charsetSentinel=="boolean"?p.charsetSentinel:u.charsetSentinel,commaRoundTrip:!!p.commaRoundTrip,delimiter:typeof p.delimiter>"u"?u.delimiter:p.delimiter,encode:typeof p.encode=="boolean"?p.encode:u.encode,encodeDotInKeys:typeof p.encodeDotInKeys=="boolean"?p.encodeDotInKeys:u.encodeDotInKeys,encoder:typeof p.encoder=="function"?p.encoder:u.encoder,encodeValuesOnly:typeof p.encodeValuesOnly=="boolean"?p.encodeValuesOnly:u.encodeValuesOnly,filter:m,format:w,formatter:S,serializeDate:typeof p.serializeDate=="function"?p.serializeDate:u.serializeDate,skipNulls:typeof p.skipNulls=="boolean"?p.skipNulls:u.skipNulls,sort:typeof p.sort=="function"?p.sort:null,strictNullHandling:typeof p.strictNullHandling=="boolean"?p.strictNullHandling:u.strictNullHandling}};return wr=function(b,p){var _=b,w=g(p),S,m;typeof w.filter=="function"?(m=w.filter,_=m("",_)):n(w.filter)&&(m=w.filter,S=m);var k=[];if(typeof _!="object"||_===null)return"";var T=s[w.arrayFormat],C=T==="comma"&&w.commaRoundTrip;S||(S=Object.keys(_)),w.sort&&S.sort(w.sort);for(var E=i(),D=0;D<S.length;++D){var P=S[D],B=_[P];w.skipNulls&&B===null||o(k,d(B,P,T,C,w.allowEmptyArrays,w.strictNullHandling,w.skipNulls,w.encodeDotInKeys,w.encode?w.encoder:null,w.filter,w.sort,w.allowDots,w.serializeDate,w.format,w.formatter,w.encodeValuesOnly,w.charset,E))}var O=k.join(w.delimiter),z=w.addQueryPrefix===!0?"?":"";return w.charsetSentinel&&(w.charset==="iso-8859-1"?z+="utf8=%26%2310003%3B&":z+="utf8=%E2%9C%93&"),O.length>0?z+O:""},wr}var mr,Os;function Pi(){if(Os)return mr;Os=1;var i=yn(),e=Object.prototype.hasOwnProperty,t=Array.isArray,r={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:i.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},s=function(f){return f.replace(/&#(\d+);/g,function(d,g){return String.fromCharCode(parseInt(g,10))})},n=function(f,d,g){if(f&&typeof f=="string"&&d.comma&&f.indexOf(",")>-1)return f.split(",");if(d.throwOnLimitExceeded&&g>=d.arrayLimit)throw new RangeError("Array limit exceeded. Only "+d.arrayLimit+" element"+(d.arrayLimit===1?"":"s")+" allowed in an array.");return f},a="utf8=%26%2310003%3B",o="utf8=%E2%9C%93",l=function(d,g){var b={__proto__:null},p=g.ignoreQueryPrefix?d.replace(/^\?/,""):d;p=p.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var _=g.parameterLimit===1/0?void 0:g.parameterLimit,w=p.split(g.delimiter,g.throwOnLimitExceeded?_+1:_);if(g.throwOnLimitExceeded&&w.length>_)throw new RangeError("Parameter limit exceeded. Only "+_+" parameter"+(_===1?"":"s")+" allowed.");var S=-1,m,k=g.charset;if(g.charsetSentinel)for(m=0;m<w.length;++m)w[m].indexOf("utf8=")===0&&(w[m]===o?k="utf-8":w[m]===a&&(k="iso-8859-1"),S=m,m=w.length);for(m=0;m<w.length;++m)if(m!==S){var T=w[m],C=T.indexOf("]="),E=C===-1?T.indexOf("="):C+1,D,P;E===-1?(D=g.decoder(T,r.decoder,k,"key"),P=g.strictNullHandling?null:""):(D=g.decoder(T.slice(0,E),r.decoder,k,"key"),P=i.maybeMap(n(T.slice(E+1),g,t(b[D])?b[D].length:0),function(O){return g.decoder(O,r.decoder,k,"value")})),P&&g.interpretNumericEntities&&k==="iso-8859-1"&&(P=s(String(P))),T.indexOf("[]=")>-1&&(P=t(P)?[P]:P);var B=e.call(b,D);B&&g.duplicates==="combine"?b[D]=i.combine(b[D],P):(!B||g.duplicates==="last")&&(b[D]=P)}return b},c=function(f,d,g,b){var p=0;if(f.length>0&&f[f.length-1]==="[]"){var _=f.slice(0,-1).join("");p=Array.isArray(d)&&d[_]?d[_].length:0}for(var w=b?d:n(d,g,p),S=f.length-1;S>=0;--S){var m,k=f[S];if(k==="[]"&&g.parseArrays)m=g.allowEmptyArrays&&(w===""||g.strictNullHandling&&w===null)?[]:i.combine([],w);else{m=g.plainObjects?{__proto__:null}:{};var T=k.charAt(0)==="["&&k.charAt(k.length-1)==="]"?k.slice(1,-1):k,C=g.decodeDotInKeys?T.replace(/%2E/g,"."):T,E=parseInt(C,10);!g.parseArrays&&C===""?m={0:w}:!isNaN(E)&&k!==C&&String(E)===C&&E>=0&&g.parseArrays&&E<=g.arrayLimit?(m=[],m[E]=w):C!=="__proto__"&&(m[C]=w)}w=m}return w},u=function(d,g,b,p){if(d){var _=b.allowDots?d.replace(/\.([^.[]+)/g,"[$1]"):d,w=/(\[[^[\]]*])/,S=/(\[[^[\]]*])/g,m=b.depth>0&&w.exec(_),k=m?_.slice(0,m.index):_,T=[];if(k){if(!b.plainObjects&&e.call(Object.prototype,k)&&!b.allowPrototypes)return;T.push(k)}for(var C=0;b.depth>0&&(m=S.exec(_))!==null&&C<b.depth;){if(C+=1,!b.plainObjects&&e.call(Object.prototype,m[1].slice(1,-1))&&!b.allowPrototypes)return;T.push(m[1])}if(m){if(b.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+b.depth+" and strictDepth is true");T.push("["+_.slice(m.index)+"]")}return c(T,g,b,p)}},h=function(d){if(!d)return r;if(typeof d.allowEmptyArrays<"u"&&typeof d.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof d.decodeDotInKeys<"u"&&typeof d.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(d.decoder!==null&&typeof d.decoder<"u"&&typeof d.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof d.charset<"u"&&d.charset!=="utf-8"&&d.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof d.throwOnLimitExceeded<"u"&&typeof d.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var g=typeof d.charset>"u"?r.charset:d.charset,b=typeof d.duplicates>"u"?r.duplicates:d.duplicates;if(b!=="combine"&&b!=="first"&&b!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var p=typeof d.allowDots>"u"?d.decodeDotInKeys===!0?!0:r.allowDots:!!d.allowDots;return{allowDots:p,allowEmptyArrays:typeof d.allowEmptyArrays=="boolean"?!!d.allowEmptyArrays:r.allowEmptyArrays,allowPrototypes:typeof d.allowPrototypes=="boolean"?d.allowPrototypes:r.allowPrototypes,allowSparse:typeof d.allowSparse=="boolean"?d.allowSparse:r.allowSparse,arrayLimit:typeof d.arrayLimit=="number"?d.arrayLimit:r.arrayLimit,charset:g,charsetSentinel:typeof d.charsetSentinel=="boolean"?d.charsetSentinel:r.charsetSentinel,comma:typeof d.comma=="boolean"?d.comma:r.comma,decodeDotInKeys:typeof d.decodeDotInKeys=="boolean"?d.decodeDotInKeys:r.decodeDotInKeys,decoder:typeof d.decoder=="function"?d.decoder:r.decoder,delimiter:typeof d.delimiter=="string"||i.isRegExp(d.delimiter)?d.delimiter:r.delimiter,depth:typeof d.depth=="number"||d.depth===!1?+d.depth:r.depth,duplicates:b,ignoreQueryPrefix:d.ignoreQueryPrefix===!0,interpretNumericEntities:typeof d.interpretNumericEntities=="boolean"?d.interpretNumericEntities:r.interpretNumericEntities,parameterLimit:typeof d.parameterLimit=="number"?d.parameterLimit:r.parameterLimit,parseArrays:d.parseArrays!==!1,plainObjects:typeof d.plainObjects=="boolean"?d.plainObjects:r.plainObjects,strictDepth:typeof d.strictDepth=="boolean"?!!d.strictDepth:r.strictDepth,strictNullHandling:typeof d.strictNullHandling=="boolean"?d.strictNullHandling:r.strictNullHandling,throwOnLimitExceeded:typeof d.throwOnLimitExceeded=="boolean"?d.throwOnLimitExceeded:!1}};return mr=function(f,d){var g=h(d);if(f===""||f===null||typeof f>"u")return g.plainObjects?{__proto__:null}:{};for(var b=typeof f=="string"?l(f,g):f,p=g.plainObjects?{__proto__:null}:{},_=Object.keys(b),w=0;w<_.length;++w){var S=_[w],m=u(S,b[S],g,typeof f=="string");p=i.merge(p,m,g)}return g.allowSparse===!0?p:i.compact(p)},mr}var br,As;function $i(){if(As)return br;As=1;var i=Ai(),e=Pi(),t=zr();return br={formats:t,parse:e,stringify:i},br}var Ci=$i();const ce=Gr(Ci);var q=function(){return q=Object.assign||function(i){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=e[s])}return i},q.apply(this,arguments)},Ri=new Map,ji=function(){return""},ue=function(i,e,t){var r,s=i;if(e!==void 0&&(s=function(){return e}),s().length>0){var n="";if(["GET","HEAD"].includes(t))n="Accept-Profile";else if(["POST","PATCH","PUT","DELETE"].includes(t))n="Content-Profile";else return{};return r={},r[n]=s(),r}else return{}};const xi=function(i){return{getList:function(e,t){var r,s,n,a,o,l;t===void 0&&(t={});var c=le(e,i.primaryKeys),u=t.pagination,h=u.page,f=u.perPage,d=t.sort||{},g=d.field,b=d.order,p=jr(t,i.defaultListOp),_=p.filter,w=p.select,S=(r=t.meta)===null||r===void 0?void 0:r.schema,m=q({offset:String((h-1)*f),limit:String(f)},_);g&&(m.order=hr(g,b,c,i.sortOrder),!((s=t.meta)===null||s===void 0)&&s.nullsfirst&&!m.order.includes("nullsfirst")&&(m.order=m.order.includes("nullslast")?m.order.replace("nullslast","nullsfirst"):"".concat(m.order,".nullsfirst")),((n=t.meta)===null||n===void 0?void 0:n.nullsfirst)===!1&&m.order.includes("nullsfirst")&&(m.order=m.order.replace(".nullsfirst","")),!((a=t.meta)===null||a===void 0)&&a.nullslast&&!m.order.includes("nullslast")&&(m.order=m.order.includes("nullsfirst")?m.order.replace("nullsfirst","nullslast"):"".concat(m.order,".nullslast")),((o=t.meta)===null||o===void 0?void 0:o.nullslast)===!1&&m.order.includes("nullslast")&&(m.order=m.order.replace(".nullslast",""))),w&&(m.select=w);var k={headers:new Headers(q(q({Accept:"application/json",Prefer:"count=exact"},((l=t.meta)===null||l===void 0?void 0:l.headers)||{}),ue(i.schema,S,"GET")))},T="".concat(i.apiUrl,"/").concat(e,"?").concat(ce.stringify(m));return i.httpClient(T,k).then(function(C){var E=C.headers,D=C.json;if(!E.has("content-range"))throw new Error(`The Content-Range header is missing in the HTTP Response. The postgREST data provider expects
          responses for lists of resources to contain this header with the total number of results to build
          the pagination. If you are using CORS, did you declare Content-Range in the Access-Control-Expose-Headers header?`);return{data:D.map(function(P){return Ge(P,c)}),total:parseInt(E.get("content-range").split("/").pop(),10)}})},getOne:function(e,t){var r,s;t===void 0&&(t={});var n=t.id,a=t.meta,o=le(e,i.primaryKeys),l=Pe(o,n,e,a),c="".concat(i.apiUrl,"/").concat(e,"?").concat(ce.stringify(l)),u=(r=t.meta)===null||r===void 0?void 0:r.schema;return i.httpClient(c,{headers:new Headers(q(q({accept:"application/vnd.pgrst.object+json"},((s=t.meta)===null||s===void 0?void 0:s.headers)||{}),ue(i.schema,u,"GET")))}).then(function(h){var f=h.json;return{data:Ge(f,o)}})},getMany:function(e,t){var r;t===void 0&&(t={});var s=t.ids;if(s.length===0)return Promise.resolve({data:[]});var n=le(e,i.primaryKeys),a=Pe(n,s,e,t.meta),o="".concat(i.apiUrl,"/").concat(e,"?").concat(ce.stringify(a)),l=(r=t.meta)===null||r===void 0?void 0:r.schema;return i.httpClient(o,{headers:new Headers(q({},ue(i.schema,l,"GET")))}).then(function(c){var u=c.json;return{data:u.map(function(h){return Ge(h,n)})}})},getManyReference:function(e,t){var r,s,n;t===void 0&&(t={});var a=t.pagination,o=a.page,l=a.perPage,c=t.sort,u=c.field,h=c.order,f=jr(t,i.defaultListOp),d=f.filter,g=f.select,b=le(e,i.primaryKeys),p=(s=t.meta)===null||s===void 0?void 0:s.schema,_=t.target?q((r={},r[t.target]="eq.".concat(t.id),r.order=hr(u,h,b,i.sortOrder),r.offset=String((o-1)*l),r.limit=String(l),r),d):q({order:hr(u,h,b),offset:String((o-1)*l),limit:String(l)},d);g&&(_.select=g);var w={headers:new Headers(q(q({Accept:"application/json",Prefer:"count=exact"},((n=t.meta)===null||n===void 0?void 0:n.headers)||{}),ue(i.schema,p,"GET")))},S="".concat(i.apiUrl,"/").concat(e,"?").concat(ce.stringify(_));return i.httpClient(S,w).then(function(m){var k=m.headers,T=m.json;if(!k.has("content-range"))throw new Error(`The Content-Range header is missing in the HTTP Response. The postgREST data provider expects
          responses for lists of resources to contain this header with the total number of results to build
          the pagination. If you are using CORS, did you declare Content-Range in the Access-Control-Expose-Headers header?`);return{data:T.map(function(C){return Ge(C,b)}),total:parseInt(k.get("content-range").split("/").pop(),10)}})},update:function(e,t){var r,s;t===void 0&&(t={});var n=t.id,a=t.data,o=t.meta,l=t.previousData,c=le(e,i.primaryKeys),u=Pe(c,n,e,o),h="".concat(i.apiUrl,"/").concat(e,"?").concat(ce.stringify(u)),f=Ii(a,l);if(Object.keys(f).length===0)return Promise.resolve({data:q({},l)});var d=(r=t.meta)===null||r===void 0?void 0:r.schema,g=JSON.stringify(q({},ur(ys(f,c),c)));return i.httpClient(h,{method:"PATCH",headers:new Headers(q(q({Accept:"application/vnd.pgrst.object+json",Prefer:"return=representation","Content-Type":"application/json"},((s=t.meta)===null||s===void 0?void 0:s.headers)||{}),ue(i.schema,d,"PATCH"))),body:g}).then(function(b){var p=b.json;return{data:Ge(p,c)}})},updateMany:function(e,t){var r,s;t===void 0&&(t={});var n=t.ids,a=t.meta,o=t.data,l=le(e,i.primaryKeys),c=Pe(l,n,e,a),u="".concat(i.apiUrl,"/").concat(e,"?").concat(ce.stringify(c)),h=JSON.stringify(q({},ur(ys(o,l),l))),f=(r=t.meta)===null||r===void 0?void 0:r.schema;return i.httpClient(u,{method:"PATCH",headers:new Headers(q(q({Prefer:"return=representation","Content-Type":"application/json"},((s=t.meta)===null||s===void 0?void 0:s.headers)||{}),ue(i.schema,f,"PATCH"))),body:h}).then(function(d){var g=d.json;return{data:g.map(function(b){return Kt(b,l)})}})},create:function(e,t){var r,s;t===void 0&&(t={});var n=t.meta,a=le(e,i.primaryKeys),o=Pe(a,void 0,e,n),l=ce.stringify(o),c="".concat(i.apiUrl,"/").concat(e).concat(l.length>0?"?":"").concat(l),u=(r=t.meta)===null||r===void 0?void 0:r.schema;return i.httpClient(c,{method:"POST",headers:new Headers(q(q({Accept:"application/vnd.pgrst.object+json",Prefer:"return=representation","Content-Type":"application/json"},((s=t.meta)===null||s===void 0?void 0:s.headers)||{}),ue(i.schema,u,"POST"))),body:JSON.stringify(ur(t.data,a))}).then(function(h){var f=h.json;return{data:q(q({},f),{id:Kt(f,a)})}})},delete:function(e,t){var r,s;t===void 0&&(t={});var n=t.id,a=t.meta,o=le(e,i.primaryKeys),l=Pe(o,n,e,a),c="".concat(i.apiUrl,"/").concat(e,"?").concat(ce.stringify(l)),u=(r=t.meta)===null||r===void 0?void 0:r.schema;return i.httpClient(c,{method:"DELETE",headers:new Headers(q(q({Accept:"application/vnd.pgrst.object+json",Prefer:"return=representation","Content-Type":"application/json"},((s=t.meta)===null||s===void 0?void 0:s.headers)||{}),ue(i.schema,u,"DELETE")))}).then(function(h){var f=h.json;return{data:Ge(f,o)}})},deleteMany:function(e,t){var r,s;t===void 0&&(t={});var n=t.ids,a=t.meta,o=le(e,i.primaryKeys),l=Pe(o,n,e,a),c="".concat(i.apiUrl,"/").concat(e,"?").concat(ce.stringify(l)),u=(r=t.meta)===null||r===void 0?void 0:r.schema;return i.httpClient(c,{method:"DELETE",headers:new Headers(q(q({Prefer:"return=representation","Content-Type":"application/json"},((s=t.meta)===null||s===void 0?void 0:s.headers)||{}),ue(i.schema,u,"DELETE")))}).then(function(h){var f=h.json;return{data:f.map(function(d){return Kt(d,o)})}})}}};var Ii=function(i,e){var t=Object.keys(i).reduce(function(r,s){return gi(i[s],e[s])||(r[s]=i[s]),r},{});return t};const Li=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>Ie(async()=>{const{default:r}=await Promise.resolve().then(()=>Le);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class Jr extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class Di extends Jr{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Ui extends Jr{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class qi extends Jr{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var xr;(function(i){i.Any="any",i.ApNortheast1="ap-northeast-1",i.ApNortheast2="ap-northeast-2",i.ApSouth1="ap-south-1",i.ApSoutheast1="ap-southeast-1",i.ApSoutheast2="ap-southeast-2",i.CaCentral1="ca-central-1",i.EuCentral1="eu-central-1",i.EuWest1="eu-west-1",i.EuWest2="eu-west-2",i.EuWest3="eu-west-3",i.SaEast1="sa-east-1",i.UsEast1="us-east-1",i.UsWest1="us-west-1",i.UsWest2="us-west-2"})(xr||(xr={}));var Ni=function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(r.next(u))}catch(h){a(h)}}function l(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):s(u.value).then(o,l)}c((r=r.apply(i,e||[])).next())})};class _n{constructor(e,{headers:t={},customFetch:r,region:s=xr.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=Li(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return Ni(this,void 0,void 0,function*(){try{const{headers:s,method:n,body:a}=t;let o={},{region:l}=t;l||(l=this.region),l&&l!=="any"&&(o["x-region"]=l);let c;a&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",c=a):typeof a=="string"?(o["Content-Type"]="text/plain",c=a):typeof FormData<"u"&&a instanceof FormData?c=a:(o["Content-Type"]="application/json",c=JSON.stringify(a)));const u=yield this.fetch(`${this.url}/${e}`,{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),s),body:c}).catch(g=>{throw new Di(g)}),h=u.headers.get("x-relay-error");if(h&&h==="true")throw new Ui(u);if(!u.ok)throw new qi(u);let f=((r=u.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),d;return f==="application/json"?d=yield u.json():f==="application/octet-stream"?d=yield u.blob():f==="text/event-stream"?d=u:f==="multipart/form-data"?d=yield u.formData():d=yield u.text(),{data:d,error:null}}catch(s){return{data:null,error:s}}})}}var H={},ze={},Je={},We={},Ve={},Qe={},Mi=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},ut=Mi();const Fi=ut.fetch,Wr=ut.fetch.bind(ut),Vr=ut.Headers,Bi=ut.Request,Hi=ut.Response,Le=Object.freeze(Object.defineProperty({__proto__:null,Headers:Vr,Request:Bi,Response:Hi,default:Wr,fetch:Fi},Symbol.toStringTag,{value:"Module"})),wn=vi(Le);var It={},Ps;function mn(){if(Ps)return It;Ps=1,Object.defineProperty(It,"__esModule",{value:!0});class i extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return It.default=i,It}var $s;function bn(){if($s)return Qe;$s=1;var i=Qe&&Qe.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Qe,"__esModule",{value:!0});const e=i(wn),t=i(mn());class r{constructor(n){this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=n.headers,this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=n.shouldThrowOnError,this.signal=n.signal,this.isMaybeSingle=n.isMaybeSingle,n.fetch?this.fetch=n.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,a){return this.headers=Object.assign({},this.headers),this.headers[n]=a,this}then(n,a){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const o=this.fetch;let l=o(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async c=>{var u,h,f;let d=null,g=null,b=null,p=c.status,_=c.statusText;if(c.ok){if(this.method!=="HEAD"){const k=await c.text();k===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?g=k:g=JSON.parse(k))}const S=(u=this.headers.Prefer)===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),m=(h=c.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");S&&m&&m.length>1&&(b=parseInt(m[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(g)&&(g.length>1?(d={code:"PGRST116",details:`Results contain ${g.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},g=null,b=null,p=406,_="Not Acceptable"):g.length===1?g=g[0]:g=null)}else{const S=await c.text();try{d=JSON.parse(S),Array.isArray(d)&&c.status===404&&(g=[],d=null,p=200,_="OK")}catch{c.status===404&&S===""?(p=204,_="No Content"):d={message:S}}if(d&&this.isMaybeSingle&&(!((f=d==null?void 0:d.details)===null||f===void 0)&&f.includes("0 rows"))&&(d=null,p=200,_="OK"),d&&this.shouldThrowOnError)throw new t.default(d)}return{error:d,data:g,count:b,status:p,statusText:_}});return this.shouldThrowOnError||(l=l.catch(c=>{var u,h,f;return{error:{message:`${(u=c==null?void 0:c.name)!==null&&u!==void 0?u:"FetchError"}: ${c==null?void 0:c.message}`,details:`${(h=c==null?void 0:c.stack)!==null&&h!==void 0?h:""}`,hint:"",code:`${(f=c==null?void 0:c.code)!==null&&f!==void 0?f:""}`},data:null,count:null,status:0,statusText:""}})),l.then(n,a)}returns(){return this}overrideTypes(){return this}}return Qe.default=r,Qe}var Cs;function Sn(){if(Cs)return Ve;Cs=1;var i=Ve&&Ve.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ve,"__esModule",{value:!0});const e=i(bn());class t extends e.default{select(s){let n=!1;const a=(s??"*").split("").map(o=>/\s/.test(o)&&!n?"":(o==='"'&&(n=!n),o)).join("");return this.url.searchParams.set("select",a),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(s,{ascending:n=!0,nullsFirst:a,foreignTable:o,referencedTable:l=o}={}){const c=l?`${l}.order`:"order",u=this.url.searchParams.get(c);return this.url.searchParams.set(c,`${u?`${u},`:""}${s}.${n?"asc":"desc"}${a===void 0?"":a?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:n,referencedTable:a=n}={}){const o=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(o,`${s}`),this}range(s,n,{foreignTable:a,referencedTable:o=a}={}){const l=typeof o>"u"?"offset":`${o}.offset`,c=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(l,`${s}`),this.url.searchParams.set(c,`${n-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:s=!1,verbose:n=!1,settings:a=!1,buffers:o=!1,wal:l=!1,format:c="text"}={}){var u;const h=[s?"analyze":null,n?"verbose":null,a?"settings":null,o?"buffers":null,l?"wal":null].filter(Boolean).join("|"),f=(u=this.headers.Accept)!==null&&u!==void 0?u:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${c}; for="${f}"; options=${h};`,c==="json"?this:this}rollback(){var s;return((s=this.headers.Prefer)!==null&&s!==void 0?s:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return Ve.default=t,Ve}var Rs;function Qr(){if(Rs)return We;Rs=1;var i=We&&We.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(We,"__esModule",{value:!0});const e=i(Sn());class t extends e.default{eq(s,n){return this.url.searchParams.append(s,`eq.${n}`),this}neq(s,n){return this.url.searchParams.append(s,`neq.${n}`),this}gt(s,n){return this.url.searchParams.append(s,`gt.${n}`),this}gte(s,n){return this.url.searchParams.append(s,`gte.${n}`),this}lt(s,n){return this.url.searchParams.append(s,`lt.${n}`),this}lte(s,n){return this.url.searchParams.append(s,`lte.${n}`),this}like(s,n){return this.url.searchParams.append(s,`like.${n}`),this}likeAllOf(s,n){return this.url.searchParams.append(s,`like(all).{${n.join(",")}}`),this}likeAnyOf(s,n){return this.url.searchParams.append(s,`like(any).{${n.join(",")}}`),this}ilike(s,n){return this.url.searchParams.append(s,`ilike.${n}`),this}ilikeAllOf(s,n){return this.url.searchParams.append(s,`ilike(all).{${n.join(",")}}`),this}ilikeAnyOf(s,n){return this.url.searchParams.append(s,`ilike(any).{${n.join(",")}}`),this}is(s,n){return this.url.searchParams.append(s,`is.${n}`),this}in(s,n){const a=Array.from(new Set(n)).map(o=>typeof o=="string"&&new RegExp("[,()]").test(o)?`"${o}"`:`${o}`).join(",");return this.url.searchParams.append(s,`in.(${a})`),this}contains(s,n){return typeof n=="string"?this.url.searchParams.append(s,`cs.${n}`):Array.isArray(n)?this.url.searchParams.append(s,`cs.{${n.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(n)}`),this}containedBy(s,n){return typeof n=="string"?this.url.searchParams.append(s,`cd.${n}`):Array.isArray(n)?this.url.searchParams.append(s,`cd.{${n.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(n)}`),this}rangeGt(s,n){return this.url.searchParams.append(s,`sr.${n}`),this}rangeGte(s,n){return this.url.searchParams.append(s,`nxl.${n}`),this}rangeLt(s,n){return this.url.searchParams.append(s,`sl.${n}`),this}rangeLte(s,n){return this.url.searchParams.append(s,`nxr.${n}`),this}rangeAdjacent(s,n){return this.url.searchParams.append(s,`adj.${n}`),this}overlaps(s,n){return typeof n=="string"?this.url.searchParams.append(s,`ov.${n}`):this.url.searchParams.append(s,`ov.{${n.join(",")}}`),this}textSearch(s,n,{config:a,type:o}={}){let l="";o==="plain"?l="pl":o==="phrase"?l="ph":o==="websearch"&&(l="w");const c=a===void 0?"":`(${a})`;return this.url.searchParams.append(s,`${l}fts${c}.${n}`),this}match(s){return Object.entries(s).forEach(([n,a])=>{this.url.searchParams.append(n,`eq.${a}`)}),this}not(s,n,a){return this.url.searchParams.append(s,`not.${n}.${a}`),this}or(s,{foreignTable:n,referencedTable:a=n}={}){const o=a?`${a}.or`:"or";return this.url.searchParams.append(o,`(${s})`),this}filter(s,n,a){return this.url.searchParams.append(s,`${n}.${a}`),this}}return We.default=t,We}var js;function kn(){if(js)return Je;js=1;var i=Je&&Je.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Je,"__esModule",{value:!0});const e=i(Qr());class t{constructor(s,{headers:n={},schema:a,fetch:o}){this.url=s,this.headers=n,this.schema=a,this.fetch=o}select(s,{head:n=!1,count:a}={}){const o=n?"HEAD":"GET";let l=!1;const c=(s??"*").split("").map(u=>/\s/.test(u)&&!l?"":(u==='"'&&(l=!l),u)).join("");return this.url.searchParams.set("select",c),a&&(this.headers.Prefer=`count=${a}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(s,{count:n,defaultToNull:a=!0}={}){const o="POST",l=[];if(this.headers.Prefer&&l.push(this.headers.Prefer),n&&l.push(`count=${n}`),a||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(s)){const c=s.reduce((u,h)=>u.concat(Object.keys(h)),[]);if(c.length>0){const u=[...new Set(c)].map(h=>`"${h}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}upsert(s,{onConflict:n,ignoreDuplicates:a=!1,count:o,defaultToNull:l=!0}={}){const c="POST",u=[`resolution=${a?"ignore":"merge"}-duplicates`];if(n!==void 0&&this.url.searchParams.set("on_conflict",n),this.headers.Prefer&&u.push(this.headers.Prefer),o&&u.push(`count=${o}`),l||u.push("missing=default"),this.headers.Prefer=u.join(","),Array.isArray(s)){const h=s.reduce((f,d)=>f.concat(Object.keys(d)),[]);if(h.length>0){const f=[...new Set(h)].map(d=>`"${d}"`);this.url.searchParams.set("columns",f.join(","))}}return new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}update(s,{count:n}={}){const a="PATCH",o=[];return this.headers.Prefer&&o.push(this.headers.Prefer),n&&o.push(`count=${n}`),this.headers.Prefer=o.join(","),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}delete({count:s}={}){const n="DELETE",a=[];return s&&a.push(`count=${s}`),this.headers.Prefer&&a.unshift(this.headers.Prefer),this.headers.Prefer=a.join(","),new e.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return Je.default=t,Je}var _t={},wt={},xs;function Ki(){return xs||(xs=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.version=void 0,wt.version="0.0.0-automated"),wt}var Is;function Gi(){if(Is)return _t;Is=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.DEFAULT_HEADERS=void 0;const i=Ki();return _t.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${i.version}`},_t}var Ls;function zi(){if(Ls)return ze;Ls=1;var i=ze&&ze.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ze,"__esModule",{value:!0});const e=i(kn()),t=i(Qr()),r=Gi();class s{constructor(a,{headers:o={},schema:l,fetch:c}={}){this.url=a,this.headers=Object.assign(Object.assign({},r.DEFAULT_HEADERS),o),this.schemaName=l,this.fetch=c}from(a){const o=new URL(`${this.url}/${a}`);return new e.default(o,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(a){return new s(this.url,{headers:this.headers,schema:a,fetch:this.fetch})}rpc(a,o={},{head:l=!1,get:c=!1,count:u}={}){let h;const f=new URL(`${this.url}/rpc/${a}`);let d;l||c?(h=l?"HEAD":"GET",Object.entries(o).filter(([b,p])=>p!==void 0).map(([b,p])=>[b,Array.isArray(p)?`{${p.join(",")}}`:`${p}`]).forEach(([b,p])=>{f.searchParams.append(b,p)})):(h="POST",d=o);const g=Object.assign({},this.headers);return u&&(g.Prefer=`count=${u}`),new t.default({method:h,url:f,headers:g,schema:this.schemaName,body:d,fetch:this.fetch,allowEmpty:!1})}}return ze.default=s,ze}var Ds;function Ji(){if(Ds)return H;Ds=1;var i=H&&H.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(H,"__esModule",{value:!0}),H.PostgrestError=H.PostgrestBuilder=H.PostgrestTransformBuilder=H.PostgrestFilterBuilder=H.PostgrestQueryBuilder=H.PostgrestClient=void 0;const e=i(zi());H.PostgrestClient=e.default;const t=i(kn());H.PostgrestQueryBuilder=t.default;const r=i(Qr());H.PostgrestFilterBuilder=r.default;const s=i(Sn());H.PostgrestTransformBuilder=s.default;const n=i(bn());H.PostgrestBuilder=n.default;const a=i(mn());return H.PostgrestError=a.default,H.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:s.default,PostgrestBuilder:n.default,PostgrestError:a.default},H}var Wi=Ji();const Vi=Gr(Wi),{PostgrestClient:Qi,PostgrestQueryBuilder:Wl,PostgrestFilterBuilder:Vl,PostgrestTransformBuilder:Ql,PostgrestBuilder:Yl,PostgrestError:Xl}=Vi,Yi="2.11.2",Xi={"X-Client-Info":`realtime-js/${Yi}`},Zi="1.0.0",Tn=1e4,ea=1e3;var ct;(function(i){i[i.connecting=0]="connecting",i[i.open=1]="open",i[i.closing=2]="closing",i[i.closed=3]="closed"})(ct||(ct={}));var V;(function(i){i.closed="closed",i.errored="errored",i.joined="joined",i.joining="joining",i.leaving="leaving"})(V||(V={}));var ee;(function(i){i.close="phx_close",i.error="phx_error",i.join="phx_join",i.reply="phx_reply",i.leave="phx_leave",i.access_token="access_token"})(ee||(ee={}));var Ir;(function(i){i.websocket="websocket"})(Ir||(Ir={}));var xe;(function(i){i.Connecting="connecting",i.Open="open",i.Closing="closing",i.Closed="closed"})(xe||(xe={}));class ta{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),n=t.getUint8(2);let a=this.HEADER_LENGTH+2;const o=r.decode(e.slice(a,a+s));a=a+s;const l=r.decode(e.slice(a,a+n));a=a+n;const c=JSON.parse(r.decode(e.slice(a,e.byteLength)));return{ref:null,topic:o,event:l,payload:c}}}class En{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var M;(function(i){i.abstime="abstime",i.bool="bool",i.date="date",i.daterange="daterange",i.float4="float4",i.float8="float8",i.int2="int2",i.int4="int4",i.int4range="int4range",i.int8="int8",i.int8range="int8range",i.json="json",i.jsonb="jsonb",i.money="money",i.numeric="numeric",i.oid="oid",i.reltime="reltime",i.text="text",i.time="time",i.timestamp="timestamp",i.timestamptz="timestamptz",i.timetz="timetz",i.tsrange="tsrange",i.tstzrange="tstzrange"})(M||(M={}));const Us=(i,e,t={})=>{var r;const s=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((n,a)=>(n[a]=ra(a,i,e,s),n),{})},ra=(i,e,t,r)=>{const s=e.find(o=>o.name===i),n=s==null?void 0:s.type,a=t[i];return n&&!r.includes(n)?On(n,a):Lr(a)},On=(i,e)=>{if(i.charAt(0)==="_"){const t=i.slice(1,i.length);return aa(e,t)}switch(i){case M.bool:return sa(e);case M.float4:case M.float8:case M.int2:case M.int4:case M.int8:case M.numeric:case M.oid:return na(e);case M.json:case M.jsonb:return ia(e);case M.timestamp:return oa(e);case M.abstime:case M.date:case M.daterange:case M.int4range:case M.int8range:case M.money:case M.reltime:case M.text:case M.time:case M.timestamptz:case M.timetz:case M.tsrange:case M.tstzrange:return Lr(e);default:return Lr(e)}},Lr=i=>i,sa=i=>{switch(i){case"t":return!0;case"f":return!1;default:return i}},na=i=>{if(typeof i=="string"){const e=parseFloat(i);if(!Number.isNaN(e))return e}return i},ia=i=>{if(typeof i=="string")try{return JSON.parse(i)}catch(e){return console.log(`JSON parse error: ${e}`),i}return i},aa=(i,e)=>{if(typeof i!="string")return i;const t=i.length-1,r=i[t];if(i[0]==="{"&&r==="}"){let n;const a=i.slice(1,t);try{n=JSON.parse("["+a+"]")}catch{n=a?a.split(","):[]}return n.map(o=>On(e,o))}return i},oa=i=>typeof i=="string"?i.replace(" ","T"):i,An=i=>{let e=i;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Sr{constructor(e,t,r={},s=Tn){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var qs;(function(i){i.SYNC="sync",i.JOIN="join",i.LEAVE="leave"})(qs||(qs={}));class Tt{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:n,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Tt.syncState(this.state,s,n,a),this.pendingDiffs.forEach(l=>{this.state=Tt.syncDiff(this.state,l,n,a)}),this.pendingDiffs=[],o()}),this.channel._on(r.diff,{},s=>{const{onJoin:n,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Tt.syncDiff(this.state,s,n,a),o())}),this.onJoin((s,n,a)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:n,newPresences:a})}),this.onLeave((s,n,a)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:n,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const n=this.cloneDeep(e),a=this.transformState(t),o={},l={};return this.map(n,(c,u)=>{a[c]||(l[c]=u)}),this.map(a,(c,u)=>{const h=n[c];if(h){const f=u.map(p=>p.presence_ref),d=h.map(p=>p.presence_ref),g=u.filter(p=>d.indexOf(p.presence_ref)<0),b=h.filter(p=>f.indexOf(p.presence_ref)<0);g.length>0&&(o[c]=g),b.length>0&&(l[c]=b)}else o[c]=u}),this.syncDiff(n,{joins:o,leaves:l},r,s)}static syncDiff(e,t,r,s){const{joins:n,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(n,(o,l)=>{var c;const u=(c=e[o])!==null&&c!==void 0?c:[];if(e[o]=this.cloneDeep(l),u.length>0){const h=e[o].map(d=>d.presence_ref),f=u.filter(d=>h.indexOf(d.presence_ref)<0);e[o].unshift(...f)}r(o,u,l)}),this.map(a,(o,l)=>{let c=e[o];if(!c)return;const u=l.map(h=>h.presence_ref);c=c.filter(h=>u.indexOf(h.presence_ref)<0),e[o]=c,s(o,c,l),c.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return"metas"in s?t[r]=s.metas.map(n=>(n.presence_ref=n.phx_ref,delete n.phx_ref,delete n.phx_ref_prev,n)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Ns;(function(i){i.ALL="*",i.INSERT="INSERT",i.UPDATE="UPDATE",i.DELETE="DELETE"})(Ns||(Ns={}));var Ms;(function(i){i.BROADCAST="broadcast",i.PRESENCE="presence",i.POSTGRES_CHANGES="postgres_changes",i.SYSTEM="system"})(Ms||(Ms={}));var he;(function(i){i.SUBSCRIBED="SUBSCRIBED",i.TIMED_OUT="TIMED_OUT",i.CLOSED="CLOSED",i.CHANNEL_ERROR="CHANNEL_ERROR"})(he||(he={}));class Yr{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=V.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Sr(this,ee.join,this.params,this.timeout),this.rejoinTimer=new En(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=V.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=V.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=V.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=V.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ee.reply,{},(s,n)=>{this._trigger(this._replyEventName(n),s)}),this.presence=new Tt(this),this.broadcastEndpointURL=An(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,s;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:n,presence:a,private:o}}=this.params;this._onError(u=>e==null?void 0:e(he.CHANNEL_ERROR,u)),this._onClose(()=>e==null?void 0:e(he.CLOSED));const l={},c={broadcast:n,presence:a,postgres_changes:(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(u=>u.filter))!==null&&s!==void 0?s:[],private:o};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:c},l)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:u})=>{var h;if(this.socket.setAuth(),u===void 0){e==null||e(he.SUBSCRIBED);return}else{const f=this.bindings.postgres_changes,d=(h=f==null?void 0:f.length)!==null&&h!==void 0?h:0,g=[];for(let b=0;b<d;b++){const p=f[b],{filter:{event:_,schema:w,table:S,filter:m}}=p,k=u&&u[b];if(k&&k.event===_&&k.schema===w&&k.table===S&&k.filter===m)g.push(Object.assign(Object.assign({},p),{id:k.id}));else{this.unsubscribe(),e==null||e(he.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,e&&e(he.SUBSCRIBED);return}}).receive("error",u=>{e==null||e(he.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(he.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,s;if(!this._canPush()&&e.type==="broadcast"){const{event:n,payload:a}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:a,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((s=c.body)===null||s===void 0?void 0:s.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(n=>{var a,o,l;const c=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||l===void 0)&&l.ack)&&n("ok"),c.receive("ok",()=>n("ok")),c.receive("error",()=>n("error")),c.receive("timeout",()=>n("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=V.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ee.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const s=new Sr(this,ee.leave,{},e);s.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})})}async _fetchWithTimeout(e,t,r){const s=new AbortController,n=setTimeout(()=>s.abort(),r),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(n),a}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Sr(this,e,t,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,n;const a=e.toLocaleLowerCase(),{close:o,error:l,leave:c,join:u}=ee;if(r&&[o,l,c,u].indexOf(a)>=0&&r!==this._joinRef())return;let f=this._onMessage(a,t,r);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(d=>{var g,b,p;return((g=d.filter)===null||g===void 0?void 0:g.event)==="*"||((p=(b=d.filter)===null||b===void 0?void 0:b.event)===null||p===void 0?void 0:p.toLocaleLowerCase())===a}).map(d=>d.callback(f,r)):(n=this.bindings[a])===null||n===void 0||n.filter(d=>{var g,b,p,_,w,S;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in d){const m=d.id,k=(g=d.filter)===null||g===void 0?void 0:g.event;return m&&((b=t.ids)===null||b===void 0?void 0:b.includes(m))&&(k==="*"||(k==null?void 0:k.toLocaleLowerCase())===((p=t.data)===null||p===void 0?void 0:p.type.toLocaleLowerCase()))}else{const m=(w=(_=d==null?void 0:d.filter)===null||_===void 0?void 0:_.event)===null||w===void 0?void 0:w.toLocaleLowerCase();return m==="*"||m===((S=t==null?void 0:t.event)===null||S===void 0?void 0:S.toLocaleLowerCase())}else return d.type.toLocaleLowerCase()===a}).map(d=>{if(typeof f=="object"&&"ids"in f){const g=f.data,{schema:b,table:p,commit_timestamp:_,type:w,errors:S}=g;f=Object.assign(Object.assign({},{schema:b,table:p,commit_timestamp:_,eventType:w,new:{},old:{},errors:S}),this._getPayloadRecords(g))}d.callback(f,r)})}_isClosed(){return this.state===V.closed}_isJoined(){return this.state===V.joined}_isJoining(){return this.state===V.joining}_isLeaving(){return this.state===V.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),n={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(n):this.bindings[s]=[n],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(s=>{var n;return!(((n=s.type)===null||n===void 0?void 0:n.toLocaleLowerCase())===r&&Yr.isEqual(s.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(ee.close,{},e)}_onError(e){this._on(ee.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=V.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Us(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Us(e.columns,e.old_record)),t}}const la=()=>{},ca=typeof WebSocket<"u",ua=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Pn{constructor(e,t){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=Xi,this.params={},this.timeout=Tn,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=la,this.conn=null,this.sendBuffer=[],this.serializer=new ta,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=n=>{let a;return n?a=n:typeof fetch>"u"?a=(...o)=>Ie(async()=>{const{default:l}=await Promise.resolve().then(()=>Le);return{default:l}},void 0).then(({default:l})=>l(...o)):a=fetch,(...o)=>a(...o)},this.endPoint=`${e}/${Ir.websocket}`,this.httpEndpoint=An(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=(r=t==null?void 0:t.params)===null||r===void 0?void 0:r.apikey;if(s&&(this.accessTokenValue=s,this.apiKey=s),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:n=>[1e3,2e3,5e3,1e4][n-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(n,a)=>a(JSON.stringify(n)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new En(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(ca){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new ha(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),Ie(async()=>{const{default:e}=await import("./browser-CdVzcZLh.js").then(t=>t.b);return{default:e}},__vite__mapDeps([0,1])).then(({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Zi}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case ct.connecting:return xe.Connecting;case ct.open:return xe.Open;case ct.closing:return xe.Closing;default:return xe.Closed}}isConnected(){return this.connectionState()===xe.Open}channel(e,t={config:{}}){const r=new Yr(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:s,ref:n}=e,a=()=>{this.encode(e,o=>{var l;(l=this.conn)===null||l===void 0||l.send(o)})};this.log("push",`${t} ${r} (${n})`,s),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let r=null;try{r=JSON.parse(atob(t.split(".")[1]))}catch{}if(r&&r.exp&&!(Math.floor(Date.now()/1e3)-r.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`);this.accessTokenValue=t,this.channels.forEach(s=>{t&&s.updateJoinPayload({access_token:t}),s.joinedOnce&&s._isJoined()&&s._push(ee.access_token,{access_token:t})})}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(ea,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:s,payload:n,ref:a}=t;a&&a===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${n.status||""} ${r} ${s} ${a&&"("+a+")"||""}`,n),this.channels.filter(o=>o._isMember(r)).forEach(o=>o._trigger(s,n,a)),this.stateChangeCallbacks.message.forEach(o=>o(t))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(ee.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([ua],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}}class ha{constructor(e,t,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=ct.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=r.close}}class Xr extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function G(i){return typeof i=="object"&&i!==null&&"__isStorageError"in i}class da extends Xr{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Dr extends Xr{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var fa=function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(r.next(u))}catch(h){a(h)}}function l(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):s(u.value).then(o,l)}c((r=r.apply(i,e||[])).next())})};const $n=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>Ie(async()=>{const{default:r}=await Promise.resolve().then(()=>Le);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},pa=()=>fa(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Ie(()=>Promise.resolve().then(()=>Le),void 0)).Response:Response}),Ur=i=>{if(Array.isArray(i))return i.map(t=>Ur(t));if(typeof i=="function"||i!==Object(i))return i;const e={};return Object.entries(i).forEach(([t,r])=>{const s=t.replace(/([-_][a-z])/gi,n=>n.toUpperCase().replace(/[-_]/g,""));e[s]=Ur(r)}),e};var De=function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(r.next(u))}catch(h){a(h)}}function l(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):s(u.value).then(o,l)}c((r=r.apply(i,e||[])).next())})};const kr=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),ga=(i,e,t)=>De(void 0,void 0,void 0,function*(){const r=yield pa();i instanceof r&&!(t!=null&&t.noResolveJson)?i.json().then(s=>{e(new da(kr(s),i.status||500))}).catch(s=>{e(new Dr(kr(s),s))}):e(new Dr(kr(i),i))}),va=(i,e,t,r)=>{const s={method:i,headers:(e==null?void 0:e.headers)||{}};return i==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),r&&(s.body=JSON.stringify(r)),Object.assign(Object.assign({},s),t))};function $t(i,e,t,r,s,n){return De(this,void 0,void 0,function*(){return new Promise((a,o)=>{i(t,va(e,r,s,n)).then(l=>{if(!l.ok)throw l;return r!=null&&r.noResolveJson?l:l.json()}).then(l=>a(l)).catch(l=>ga(l,o,r))})})}function Jt(i,e,t,r){return De(this,void 0,void 0,function*(){return $t(i,"GET",e,t,r)})}function me(i,e,t,r,s){return De(this,void 0,void 0,function*(){return $t(i,"POST",e,r,s,t)})}function ya(i,e,t,r,s){return De(this,void 0,void 0,function*(){return $t(i,"PUT",e,r,s,t)})}function _a(i,e,t,r){return De(this,void 0,void 0,function*(){return $t(i,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function Cn(i,e,t,r,s){return De(this,void 0,void 0,function*(){return $t(i,"DELETE",e,r,s,t)})}var J=function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(r.next(u))}catch(h){a(h)}}function l(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):s(u.value).then(o,l)}c((r=r.apply(i,e||[])).next())})};const wa={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Fs={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class ma{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=$n(s)}uploadOrUpdate(e,t,r,s){return J(this,void 0,void 0,function*(){try{let n;const a=Object.assign(Object.assign({},Fs),s);let o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});const l=a.metadata;typeof Blob<"u"&&r instanceof Blob?(n=new FormData,n.append("cacheControl",a.cacheControl),l&&n.append("metadata",this.encodeMetadata(l)),n.append("",r)):typeof FormData<"u"&&r instanceof FormData?(n=r,n.append("cacheControl",a.cacheControl),l&&n.append("metadata",this.encodeMetadata(l))):(n=r,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType,l&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),s!=null&&s.headers&&(o=Object.assign(Object.assign({},o),s.headers));const c=this._removeEmptyFolders(t),u=this._getFinalPath(c),h=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:n,headers:o},a!=null&&a.duplex?{duplex:a.duplex}:{})),f=yield h.json();return h.ok?{data:{path:c,id:f.Id,fullPath:f.Key},error:null}:{data:null,error:f}}catch(n){if(G(n))return{data:null,error:n};throw n}})}upload(e,t,r){return J(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return J(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),a=this._getFinalPath(n),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",t);try{let l;const c=Object.assign({upsert:Fs.upsert},s),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl)):(l=r,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const h=yield this.fetch(o.toString(),{method:"PUT",body:l,headers:u}),f=yield h.json();return h.ok?{data:{path:n,fullPath:f.Key},error:null}:{data:null,error:f}}catch(l){if(G(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return J(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const s=Object.assign({},this.headers);t!=null&&t.upsert&&(s["x-upsert"]="true");const n=yield me(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),a=new URL(this.url+n.url),o=a.searchParams.get("token");if(!o)throw new Xr("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:o},error:null}}catch(r){if(G(r))return{data:null,error:r};throw r}})}update(e,t,r){return J(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return J(this,void 0,void 0,function*(){try{return{data:yield me(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(G(s))return{data:null,error:s};throw s}})}copy(e,t,r){return J(this,void 0,void 0,function*(){try{return{data:{path:(yield me(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(G(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,r){return J(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),n=yield me(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const a=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${a}`)},{data:n,error:null}}catch(s){if(G(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return J(this,void 0,void 0,function*(){try{const s=yield me(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${n}`):null})),error:null}}catch(s){if(G(s))return{data:null,error:s};throw s}})}download(e,t){return J(this,void 0,void 0,function*(){const s=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),a=n?`?${n}`:"";try{const o=this._getFinalPath(e);return{data:yield(yield Jt(this.fetch,`${this.url}/${s}/${o}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(G(o))return{data:null,error:o};throw o}})}info(e){return J(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield Jt(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Ur(r),error:null}}catch(r){if(G(r))return{data:null,error:r};throw r}})}exists(e){return J(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield _a(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(G(r)&&r instanceof Dr){const s=r.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],n=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";n!==""&&s.push(n);const o=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&s.push(l);let c=s.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${r}${c}`)}}}remove(e){return J(this,void 0,void 0,function*(){try{return{data:yield Cn(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(G(t))return{data:null,error:t};throw t}})}list(e,t,r){return J(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},wa),t),{prefix:e||""});return{data:yield me(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(G(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const ba="2.7.1",Sa={"X-Client-Info":`storage-js/${ba}`};var Ye=function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(r.next(u))}catch(h){a(h)}}function l(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):s(u.value).then(o,l)}c((r=r.apply(i,e||[])).next())})};class ka{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},Sa),t),this.fetch=$n(r)}listBuckets(){return Ye(this,void 0,void 0,function*(){try{return{data:yield Jt(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(G(e))return{data:null,error:e};throw e}})}getBucket(e){return Ye(this,void 0,void 0,function*(){try{return{data:yield Jt(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(G(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Ye(this,void 0,void 0,function*(){try{return{data:yield me(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(G(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return Ye(this,void 0,void 0,function*(){try{return{data:yield ya(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(G(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Ye(this,void 0,void 0,function*(){try{return{data:yield me(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(G(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Ye(this,void 0,void 0,function*(){try{return{data:yield Cn(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(G(t))return{data:null,error:t};throw t}})}}class Rn extends ka{constructor(e,t={},r){super(e,t,r)}from(e){return new ma(this.url,this.headers,e,this.fetch)}}const Ta="2.49.1";let St="";typeof Deno<"u"?St="deno":typeof document<"u"?St="web":typeof navigator<"u"&&navigator.product==="ReactNative"?St="react-native":St="node";const Ea={"X-Client-Info":`supabase-js-${St}/${Ta}`},Oa={headers:Ea},Aa={schema:"public"},Pa={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},$a={};var Ca=function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(r.next(u))}catch(h){a(h)}}function l(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):s(u.value).then(o,l)}c((r=r.apply(i,e||[])).next())})};const Ra=i=>{let e;return i?e=i:typeof fetch>"u"?e=Wr:e=fetch,(...t)=>e(...t)},ja=()=>typeof Headers>"u"?Vr:Headers,xa=(i,e,t)=>{const r=Ra(t),s=ja();return(n,a)=>Ca(void 0,void 0,void 0,function*(){var o;const l=(o=yield e())!==null&&o!==void 0?o:i;let c=new s(a==null?void 0:a.headers);return c.has("apikey")||c.set("apikey",i),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),r(n,Object.assign(Object.assign({},a),{headers:c}))})};var Ia=function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(r.next(u))}catch(h){a(h)}}function l(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):s(u.value).then(o,l)}c((r=r.apply(i,e||[])).next())})};function La(i){return i.replace(/\/$/,"")}function Da(i,e){const{db:t,auth:r,realtime:s,global:n}=i,{db:a,auth:o,realtime:l,global:c}=e,u={db:Object.assign(Object.assign({},a),t),auth:Object.assign(Object.assign({},o),r),realtime:Object.assign(Object.assign({},l),s),global:Object.assign(Object.assign({},c),n),accessToken:()=>Ia(this,void 0,void 0,function*(){return""})};return i.accessToken?u.accessToken=i.accessToken:delete u.accessToken,u}const jn="2.68.0",ot=30*1e3,qr=3,Tr=qr*ot,Ua="http://localhost:9999",qa="supabase.auth.token",Na={"X-Client-Info":`gotrue-js/${jn}`},Nr="X-Supabase-Api-Version",xn={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function Ma(i){return Math.round(Date.now()/1e3)+i}function Fa(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){const e=Math.random()*16|0;return(i=="x"?e:e&3|8).toString(16)})}const re=()=>typeof window<"u"&&typeof document<"u",$e={tested:!1,writable:!1},Et=()=>{if(!re())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if($e.tested)return $e.writable;const i=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(i,i),globalThis.localStorage.removeItem(i),$e.tested=!0,$e.writable=!0}catch{$e.tested=!0,$e.writable=!1}return $e.writable};function Ba(i){const e={},t=new URL(i);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,n)=>{e[n]=s})}catch{}return t.searchParams.forEach((r,s)=>{e[s]=r}),e}const In=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>Ie(async()=>{const{default:r}=await Promise.resolve().then(()=>Le);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Ha=i=>typeof i=="object"&&i!==null&&"status"in i&&"ok"in i&&"json"in i&&typeof i.json=="function",Ln=async(i,e,t)=>{await i.setItem(e,JSON.stringify(t))},Lt=async(i,e)=>{const t=await i.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Dt=async(i,e)=>{await i.removeItem(e)};function Ka(i){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",r,s,n,a,o,l,c,u=0;for(i=i.replace("-","+").replace("_","/");u<i.length;)a=e.indexOf(i.charAt(u++)),o=e.indexOf(i.charAt(u++)),l=e.indexOf(i.charAt(u++)),c=e.indexOf(i.charAt(u++)),r=a<<2|o>>4,s=(o&15)<<4|l>>2,n=(l&3)<<6|c,t=t+String.fromCharCode(r),l!=64&&s!=0&&(t=t+String.fromCharCode(s)),c!=64&&n!=0&&(t=t+String.fromCharCode(n));return t}let Dn=class Un{constructor(){this.promise=new Un.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}};Dn.promiseConstructor=Promise;function Bs(i){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=i.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=t[1];return JSON.parse(Ka(r))}async function Ga(i){return await new Promise(e=>{setTimeout(()=>e(null),i)})}function za(i,e){return new Promise((r,s)=>{(async()=>{for(let n=0;n<1/0;n++)try{const a=await i(n);if(!e(n,null,a)){r(a);return}}catch(a){if(!e(n,a)){s(a);return}}})()})}function Ja(i){return("0"+i.toString(16)).substr(-2)}function Wa(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let s="";for(let n=0;n<56;n++)s+=t.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,Ja).join("")}async function Va(i){const t=new TextEncoder().encode(i),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(n=>String.fromCharCode(n)).join("")}function Qa(i){return btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Ya(i){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),i;const t=await Va(i);return Qa(t)}async function Xe(i,e,t=!1){const r=Wa();let s=r;t&&(s+="/PASSWORD_RECOVERY"),await Ln(i,`${e}-code-verifier`,s);const n=await Ya(r);return[n,r===n?"plain":"s256"]}const Xa=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Za(i){const e=i.headers.get(Nr);if(!e||!e.match(Xa))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}let Zr=class extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}};function $(i){return typeof i=="object"&&i!==null&&"__isAuthError"in i}let eo=class extends Zr{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}};function to(i){return $(i)&&i.name==="AuthApiError"}let qn=class extends Zr{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}},Ue=class extends Zr{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}},ve=class extends Ue{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}};function ro(i){return $(i)&&i.name==="AuthSessionMissingError"}let Er=class extends Ue{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}},Ut=class extends Ue{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}},qt=class extends Ue{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}};function so(i){return $(i)&&i.name==="AuthImplicitGrantRedirectError"}let Hs=class extends Ue{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}},Mr=class extends Ue{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}};function Or(i){return $(i)&&i.name==="AuthRetryableFetchError"}let Ks=class extends Ue{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}};var no=function(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(i);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(i,r[s])&&(t[r[s]]=i[r[s]]);return t};const Re=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),io=[502,503,504];async function Gs(i){var e;if(!Ha(i))throw new Mr(Re(i),0);if(io.includes(i.status))throw new Mr(Re(i),i.status);let t;try{t=await i.json()}catch(n){throw new qn(Re(n),n)}let r;const s=Za(i);if(s&&s.getTime()>=xn["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new Ks(Re(t),i.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new ve}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((n,a)=>n&&typeof a=="string",!0))throw new Ks(Re(t),i.status,t.weak_password.reasons);throw new eo(Re(t),i.status||500,r)}const ao=(i,e,t,r)=>{const s={method:i,headers:(e==null?void 0:e.headers)||{}};return i==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};async function x(i,e,t,r){var s;const n=Object.assign({},r==null?void 0:r.headers);n[Nr]||(n[Nr]=xn["2024-01-01"].name),r!=null&&r.jwt&&(n.Authorization=`Bearer ${r.jwt}`);const a=(s=r==null?void 0:r.query)!==null&&s!==void 0?s:{};r!=null&&r.redirectTo&&(a.redirect_to=r.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await oo(i,e,t+o,{headers:n,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(l):{data:Object.assign({},l),error:null}}async function oo(i,e,t,r,s,n){const a=ao(e,r,s,n);let o;try{o=await i(t,Object.assign({},a))}catch(l){throw console.error(l),new Mr(Re(l),0)}if(o.ok||await Gs(o),r!=null&&r.noResolveJson)return o;try{return await o.json()}catch(l){await Gs(l)}}function ye(i){var e;let t=null;ho(i)&&(t=Object.assign({},i),i.expires_at||(t.expires_at=Ma(i.expires_in)));const r=(e=i.user)!==null&&e!==void 0?e:i;return{data:{session:t,user:r},error:null}}function zs(i){const e=ye(i);return!e.error&&i.weak_password&&typeof i.weak_password=="object"&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.message&&typeof i.weak_password.message=="string"&&i.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=i.weak_password),e}function be(i){var e;return{data:{user:(e=i.user)!==null&&e!==void 0?e:i},error:null}}function lo(i){return{data:i,error:null}}function co(i){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:n}=i,a=no(i,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:n},l=Object.assign({},a);return{data:{properties:o,user:l},error:null}}function uo(i){return i}function ho(i){return i.access_token&&i.refresh_token&&i.expires_in}var fo=function(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(i);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(i,r[s])&&(t[r[s]]=i[r[s]]);return t};let po=class{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=In(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await x(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if($(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await x(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:be})}catch(r){if($(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=fo(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=r==null?void 0:r.newEmail,delete s.newEmail),await x(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:co,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if($(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await x(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:be})}catch(t){if($(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,s,n,a,o,l;try{const c={nextPage:null,lastPage:0,total:0},u=await x(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(n=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&n!==void 0?n:""},xform:uo});if(u.error)throw u.error;const h=await u.json(),f=(a=u.headers.get("x-total-count"))!==null&&a!==void 0?a:0,d=(l=(o=u.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&l!==void 0?l:[];return d.length>0&&(d.forEach(g=>{const b=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),p=JSON.parse(g.split(";")[1].split("=")[1]);c[`${p}Page`]=b}),c.total=parseInt(f)),{data:Object.assign(Object.assign({},h),c),error:null}}catch(c){if($(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){try{return await x(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:be})}catch(t){if($(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await x(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:be})}catch(r){if($(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){try{return await x(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:be})}catch(r){if($(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){try{const{data:t,error:r}=await x(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:r}}catch(t){if($(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await x(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if($(t))return{data:null,error:t};throw t}}};const go={getItem:i=>Et()?globalThis.localStorage.getItem(i):null,setItem:(i,e)=>{Et()&&globalThis.localStorage.setItem(i,e)},removeItem:i=>{Et()&&globalThis.localStorage.removeItem(i)}};function Js(i={}){return{getItem:e=>i[e]||null,setItem:(e,t)=>{i[e]=t},removeItem:e=>{delete i[e]}}}function vo(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Ze={debug:!!(globalThis&&Et()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};let Nn=class extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}},yo=class extends Nn{};async function _o(i,e,t){Ze.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",i,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),Ze.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",i)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(i,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async s=>{if(s){Ze.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",i,s.name);try{return await t()}finally{Ze.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",i,s.name)}}else{if(e===0)throw Ze.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",i),new yo(`Acquiring an exclusive Navigator LockManager lock "${i}" immediately failed`);if(Ze.debug)try{const n=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(n,null,"  "))}catch(n){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",n)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}vo();const wo={url:Ua,storageKey:qa,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Na,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Ws(i,e,t){return await t()}let Mn=class Fr{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Fr.nextInstanceID,Fr.nextInstanceID+=1,this.instanceID>0&&re()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},wo),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new po({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=In(s.fetch),this.lock=s.lock||Ws,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:re()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=_o:this.lock=Ws,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:Et()?this.storage=go:(this.memoryStorage={},this.storage=Js(this.memoryStorage)):(this.memoryStorage={},this.storage=Js(this.memoryStorage)),re()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",n)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async n=>{this._debug("received broadcast notification from other tab or client",n),await this._notifyAllSubscribers(n.data.event,n.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${jn}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Ba(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),re()&&this.detectSessionInUrl&&r!=="none"){const{data:s,error:n}=await this._getSessionFromURL(t,r);if(n){if(this._debug("#_initialize()","error detecting session from URL",n),so(n)){const l=(e=n.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:n}}return await this._removeSession(),{error:n}}const{session:a,redirectType:o}=s;return this._debug("#_initialize()","detected session in URL",a,"redirect type",o),await this._saveSession(a),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return $(t)?{error:t}:{error:new qn("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,s;try{const n=await x(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:ye}),{data:a,error:o}=n;if(o||!a)return{data:{user:null,session:null},error:o};const l=a.session,c=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(n){if($(n))return{data:{user:null,session:null},error:n};throw n}}async signUp(e){var t,r,s;try{let n;if("email"in e){const{email:u,password:h,options:f}=e;let d=null,g=null;this.flowType==="pkce"&&([d,g]=await Xe(this.storage,this.storageKey)),n=await x(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:u,password:h,data:(t=f==null?void 0:f.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:d,code_challenge_method:g},xform:ye})}else if("phone"in e){const{phone:u,password:h,options:f}=e;n=await x(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(r=f==null?void 0:f.data)!==null&&r!==void 0?r:{},channel:(s=f==null?void 0:f.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:ye})}else throw new Ut("You must provide either an email or phone number and a password");const{data:a,error:o}=n;if(o||!a)return{data:{user:null,session:null},error:o};const l=a.session,c=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(n){if($(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithPassword(e){try{let t;if("email"in e){const{email:n,password:a,options:o}=e;t=await x(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:zs})}else if("phone"in e){const{phone:n,password:a,options:o}=e;t=await x(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:zs})}else throw new Ut("You must provide either an email or phone number and a password");const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Er}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(t){if($(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,s,n;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(n=e.options)===null||n===void 0?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await Lt(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(t??"").split("/");try{const{data:n,error:a}=await x(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:ye});if(await Dt(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!n||!n.session||!n.user?{data:{user:null,session:null,redirectType:null},error:new Er}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign(Object.assign({},n),{redirectType:s??null}),error:a})}catch(n){if($(n))return{data:{user:null,session:null,redirectType:null},error:n};throw n}}async signInWithIdToken(e){try{const{options:t,provider:r,token:s,access_token:n,nonce:a}=e,o=await x(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:n,nonce:a,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:ye}),{data:l,error:c}=o;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new Er}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(t){if($(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,s,n,a;try{if("email"in e){const{email:o,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await Xe(this.storage,this.storageKey));const{error:h}=await x(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(r=l==null?void 0:l.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:o,options:l}=e,{data:c,error:u}=await x(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(s=l==null?void 0:l.data)!==null&&s!==void 0?s:{},create_user:(n=l==null?void 0:l.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(a=l==null?void 0:l.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:u}}throw new Ut("You must provide either an email or phone number.")}catch(o){if($(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,r;try{let s,n;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,n=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:a,error:o}=await x(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:s,xform:ye});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const l=a.session,c=a.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if($(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,r,s;try{let n=null,a=null;return this.flowType==="pkce"&&([n,a]=await Xe(this.storage,this.storageKey)),await x(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:a}),headers:this.headers,xform:lo})}catch(n){if($(n))return{data:null,error:n};throw n}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new ve;const{error:s}=await x(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if($(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:n}=e,{error:a}=await x(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},redirectTo:n==null?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:r,type:s,options:n}=e,{data:a,error:o}=await x(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:o}}throw new Ut("You must provide either an email or phone number and a type")}catch(t){if($(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Lt(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Tr:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.storage.isServer){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,u)=>(!a&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,u))})}return{data:{session:e},error:null}}const{session:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await x(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:be}):await this._useSession(async t=>{var r,s,n;const{data:a,error:o}=t;if(o)throw o;return!(!((r=a.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new ve}:await x(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(n=(s=a.session)===null||s===void 0?void 0:s.access_token)!==null&&n!==void 0?n:void 0,xform:be})})}catch(t){if($(t))return ro(t)&&(await this._removeSession(),await Dt(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:s,error:n}=r;if(n)throw n;if(!s.session)throw new ve;const a=s.session;let o=null,l=null;this.flowType==="pkce"&&e.email!=null&&([o,l]=await Xe(this.storage,this.storageKey));const{data:c,error:u}=await x(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:l}),jwt:a.access_token,xform:be});if(u)throw u;return a.user=c.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(r){if($(r))return{data:{user:null},error:r};throw r}}_decodeJWT(e){return Bs(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new ve;const t=Date.now()/1e3;let r=t,s=!0,n=null;const a=Bs(e.access_token);if(a.exp&&(r=a.exp,s=r<=t),s){const{session:o,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!o)return{data:{user:null,session:null},error:null};n=o}else{const{data:o,error:l}=await this._getUser(e.access_token);if(l)throw l;n={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(t){if($(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:a,error:o}=t;if(o)throw o;e=(r=a.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new ve;const{session:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if($(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!re())throw new qt("No browser detected.");if(e.error||e.error_description||e.error_code)throw new qt(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Hs("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new qt("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Hs("No code detected.");const{data:w,error:S}=await this._exchangeCodeForSession(e.code);if(S)throw S;const m=new URL(window.location.href);return m.searchParams.delete("code"),window.history.replaceState(window.history.state,"",m.toString()),{data:{session:w.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:s,access_token:n,refresh_token:a,expires_in:o,expires_at:l,token_type:c}=e;if(!n||!o||!a||!c)throw new qt("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(o);let f=u+h;l&&(f=parseInt(l));const d=f-u;d*1e3<=ot&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${d}s, should have been closer to ${h}s`);const g=f-h;u-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,f,u):u-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,f,u);const{data:b,error:p}=await this._getUser(n);if(p)throw p;const _={provider_token:r,provider_refresh_token:s,access_token:n,expires_in:h,expires_at:f,refresh_token:a,token_type:c,user:b.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:_,redirectType:e.type},error:null}}catch(r){if($(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Lt(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:s,error:n}=t;if(n)return{error:n};const a=(r=s.session)===null||r===void 0?void 0:r.access_token;if(a){const{error:o}=await this.admin.signOut(a,e);if(o&&!(to(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return e!=="others"&&(await this._removeSession(),await Dt(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=Fa(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{const{data:{session:n},error:a}=t;if(a)throw a;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",n)),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(n){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;this.flowType==="pkce"&&([r,s]=await Xe(this.storage,this.storageKey,!0));try{return await x(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if($(n))return{data:null,error:n};throw n}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if($(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:s}=await this._useSession(async n=>{var a,o,l,c,u;const{data:h,error:f}=n;if(f)throw f;const d=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await x(this.fetch,"GET",d,{headers:this.headers,jwt:(u=(c=h.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(s)throw s;return re()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:e.provider,url:r==null?void 0:r.url},error:null}}catch(r){if($(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;const{data:n,error:a}=t;if(a)throw a;return await x(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(r=n.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if($(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await za(async s=>(s>0&&await Ga(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await x(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:ye})),(s,n)=>{const a=200*Math.pow(2,s);return n&&Or(n)&&Date.now()+a-r<ot})}catch(r){if(this._debug(t,"error",r),$(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),re()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await Lt(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&await this._removeSession();return}const s=((e=r.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<Tr;if(this._debug(t,`session has${s?"":" not"} expired with margin of ${Tr}s`),s){if(this.autoRefreshToken&&r.refresh_token){const{error:n}=await this._callRefreshToken(r.refresh_token);n&&(console.error(n),Or(n)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",n),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new ve;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Dn;const{data:n,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!n.session)throw new ve;await this._saveSession(n.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",n.session);const o={session:n.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(n){if(this._debug(s,"error",n),$(n)){const a={session:null,error:n};return Or(n)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(n),n}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const n=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(l){n.push(l)}});if(await Promise.all(a),n.length>0){for(let o=0;o<n.length;o+=1)console.error(n[o]);throw n[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Ln(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Dt(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&re()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),ot);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-e)/ot);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${ot}ms, refresh threshold is ${qr} ticks`),s<=qr&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Nn)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!re()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const s=[`provider=${encodeURIComponent(t)}`];if(r!=null&&r.redirectTo&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[n,a]=await Xe(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(n)}`,code_challenge_method:`${encodeURIComponent(a)}`});s.push(o.toString())}if(r!=null&&r.queryParams){const n=new URLSearchParams(r.queryParams);s.push(n.toString())}return r!=null&&r.skipBrowserRedirect&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;return n?{data:null,error:n}:await x(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if($(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;const{data:n,error:a}=t;if(a)return{data:null,error:a};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:c}=await x(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((s=l==null?void 0:l.totp)===null||s===void 0)&&s.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(t){if($(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;if(n)return{data:null,error:n};const{data:a,error:o}=await x(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:o})})}catch(t){if($(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;return n?{data:null,error:n}:await x(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if($(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],s=r.filter(a=>a.factor_type==="totp"&&a.status==="verified"),n=r.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:r,totp:s,phone:n},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:s},error:n}=e;if(n)return{data:null,error:n};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const a=this._decodeJWT(s.access_token);let o=null;a.aal&&(o=a.aal);let l=o;((r=(t=s.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(l="aal2");const u=a.amr||[];return{data:{currentLevel:o,nextLevel:l,currentAuthenticationMethods:u},error:null}}))}};Mn.nextInstanceID=0;const mo=Mn;let bo=class extends mo{constructor(e){super(e)}};var So=function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(r.next(u))}catch(h){a(h)}}function l(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):s(u.value).then(o,l)}c((r=r.apply(i,e||[])).next())})};let ko=class{constructor(e,t,r){var s,n,a;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const o=La(e);this.realtimeUrl=`${o}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${o}/auth/v1`,this.storageUrl=`${o}/storage/v1`,this.functionsUrl=`${o}/functions/v1`;const l=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,c={db:Aa,realtime:$a,auth:Object.assign(Object.assign({},Pa),{storageKey:l}),global:Oa},u=Da(r??{},c);this.storageKey=(s=u.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(n=u.global.headers)!==null&&n!==void 0?n:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(h,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=u.auth)!==null&&a!==void 0?a:{},this.headers,u.global.fetch),this.fetch=xa(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new Qi(`${o}/rest/v1`,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),u.accessToken||this._listenForAuthEvents()}get functions(){return new _n(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Rn(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return So(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:n,flowType:a,lock:o,debug:l},c,u){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new bo({url:this.authUrl,headers:Object.assign(Object.assign({},h),c),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:a,lock:o,debug:l,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Pn(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const To=(i,e,t)=>new ko(i,e,t);var Wt=function(){return Wt=Object.assign||function(i){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=e[s])}return i},Wt.apply(this,arguments)},Fn=function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(r.next(u))}catch(h){a(h)}}function l(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):s(u.value).then(o,l)}c((r=r.apply(i,e||[])).next())})},Bn=function(i,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},r,s,n,a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=o(0),a.throw=o(1),a.return=o(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(t=0)),t;)try{if(r=1,s&&(n=c[0]&2?s.return:c[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,c[1])).done)return n;switch(s=0,n&&(c=[c[0]&2,n.value]),c[0]){case 0:case 1:n=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,s=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!n||c[1]>n[0]&&c[1]<n[3])){t.label=c[1];break}if(c[0]===6&&t.label<n[1]){t.label=n[1],n=c;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(c);break}n[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(i,t)}catch(u){c=[6,u],s=0}finally{r=n=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},Eo=function(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(i);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(i,r[s])&&(t[r[s]]=i[r[s]]);return t},Oo=function(i,e,t){if(t||arguments.length===2)for(var r=0,s=e.length,n;r<s;r++)(n||!(r in e))&&(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return i.concat(n||Array.prototype.slice.call(e))},Ao=function(i){var e=i.instanceUrl,t=i.apiKey,r=i.supabaseClient,s=r===void 0?To(e,t):r,n=i.httpClient,a=n===void 0?Po({apiKey:t,supabaseClient:s}):n,o=i.defaultListOp,l=o===void 0?"eq":o,c=i.primaryKeys,u=c===void 0?Ri:c,h=i.schema,f=h===void 0?ji:h,d=Eo(i,["instanceUrl","apiKey","supabaseClient","httpClient","defaultListOp","primaryKeys","schema"]),g=Wt({apiUrl:"".concat(e,"/rest/v1"),httpClient:a,defaultListOp:l,primaryKeys:u,schema:f},d);return Wt({supabaseClient:function(b,p){return a("".concat(g.apiUrl,"/").concat(b),p)},getSchema:function(){return Fn(void 0,void 0,void 0,function(){var b;return Bn(this,function(p){switch(p.label){case 0:return[4,a("".concat(g.apiUrl,"/"),{})];case 1:if(b=p.sent().json,!b||!b.swagger)throw new Error("The Open API schema is not readable");return[2,b]}})})}},xi(g))},Po=function(i){var e=i.apiKey,t=i.supabaseClient;return function(r){for(var s=[],n=1;n<arguments.length;n++)s[n-1]=arguments[n];return Fn(void 0,Oo([r],s,!0),void 0,function(a,o){var l;return o===void 0&&(o={}),Bn(this,function(c){switch(c.label){case 0:return[4,t.auth.getSession()];case 1:return l=c.sent().data,o.headers||(o.headers=new Headers({})),t.headers&&Object.entries(t.headers).forEach(function(u){var h=u[0],f=u[1];return o.headers.set(h,f)}),l.session&&(o.user={authenticated:!0,token:"Bearer ".concat(l.session.access_token)}),o.headers.set("apiKey",e),[2,yi(a,o)]}})})}},K={},et={},tt={},rt={},st={},nt={},Nt={},Vs;function Hn(){if(Vs)return Nt;Vs=1,Object.defineProperty(Nt,"__esModule",{value:!0});class i extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return Nt.default=i,Nt}var Qs;function Kn(){if(Qs)return nt;Qs=1;var i=nt&&nt.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(nt,"__esModule",{value:!0});const e=i(wn),t=i(Hn());class r{constructor(n){this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=n.headers,this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=n.shouldThrowOnError,this.signal=n.signal,this.isMaybeSingle=n.isMaybeSingle,n.fetch?this.fetch=n.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,a){return this.headers=Object.assign({},this.headers),this.headers[n]=a,this}then(n,a){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const o=this.fetch;let l=o(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async c=>{var u,h,f;let d=null,g=null,b=null,p=c.status,_=c.statusText;if(c.ok){if(this.method!=="HEAD"){const k=await c.text();k===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?g=k:g=JSON.parse(k))}const S=(u=this.headers.Prefer)===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),m=(h=c.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");S&&m&&m.length>1&&(b=parseInt(m[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(g)&&(g.length>1?(d={code:"PGRST116",details:`Results contain ${g.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},g=null,b=null,p=406,_="Not Acceptable"):g.length===1?g=g[0]:g=null)}else{const S=await c.text();try{d=JSON.parse(S),Array.isArray(d)&&c.status===404&&(g=[],d=null,p=200,_="OK")}catch{c.status===404&&S===""?(p=204,_="No Content"):d={message:S}}if(d&&this.isMaybeSingle&&(!((f=d==null?void 0:d.details)===null||f===void 0)&&f.includes("0 rows"))&&(d=null,p=200,_="OK"),d&&this.shouldThrowOnError)throw new t.default(d)}return{error:d,data:g,count:b,status:p,statusText:_}});return this.shouldThrowOnError||(l=l.catch(c=>{var u,h,f;return{error:{message:`${(u=c==null?void 0:c.name)!==null&&u!==void 0?u:"FetchError"}: ${c==null?void 0:c.message}`,details:`${(h=c==null?void 0:c.stack)!==null&&h!==void 0?h:""}`,hint:"",code:`${(f=c==null?void 0:c.code)!==null&&f!==void 0?f:""}`},data:null,count:null,status:0,statusText:""}})),l.then(n,a)}returns(){return this}overrideTypes(){return this}}return nt.default=r,nt}var Ys;function Gn(){if(Ys)return st;Ys=1;var i=st&&st.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(st,"__esModule",{value:!0});const e=i(Kn());class t extends e.default{select(s){let n=!1;const a=(s??"*").split("").map(o=>/\s/.test(o)&&!n?"":(o==='"'&&(n=!n),o)).join("");return this.url.searchParams.set("select",a),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(s,{ascending:n=!0,nullsFirst:a,foreignTable:o,referencedTable:l=o}={}){const c=l?`${l}.order`:"order",u=this.url.searchParams.get(c);return this.url.searchParams.set(c,`${u?`${u},`:""}${s}.${n?"asc":"desc"}${a===void 0?"":a?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:n,referencedTable:a=n}={}){const o=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(o,`${s}`),this}range(s,n,{foreignTable:a,referencedTable:o=a}={}){const l=typeof o>"u"?"offset":`${o}.offset`,c=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(l,`${s}`),this.url.searchParams.set(c,`${n-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:s=!1,verbose:n=!1,settings:a=!1,buffers:o=!1,wal:l=!1,format:c="text"}={}){var u;const h=[s?"analyze":null,n?"verbose":null,a?"settings":null,o?"buffers":null,l?"wal":null].filter(Boolean).join("|"),f=(u=this.headers.Accept)!==null&&u!==void 0?u:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${c}; for="${f}"; options=${h};`,c==="json"?this:this}rollback(){var s;return((s=this.headers.Prefer)!==null&&s!==void 0?s:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return st.default=t,st}var Xs;function es(){if(Xs)return rt;Xs=1;var i=rt&&rt.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(rt,"__esModule",{value:!0});const e=i(Gn());class t extends e.default{eq(s,n){return this.url.searchParams.append(s,`eq.${n}`),this}neq(s,n){return this.url.searchParams.append(s,`neq.${n}`),this}gt(s,n){return this.url.searchParams.append(s,`gt.${n}`),this}gte(s,n){return this.url.searchParams.append(s,`gte.${n}`),this}lt(s,n){return this.url.searchParams.append(s,`lt.${n}`),this}lte(s,n){return this.url.searchParams.append(s,`lte.${n}`),this}like(s,n){return this.url.searchParams.append(s,`like.${n}`),this}likeAllOf(s,n){return this.url.searchParams.append(s,`like(all).{${n.join(",")}}`),this}likeAnyOf(s,n){return this.url.searchParams.append(s,`like(any).{${n.join(",")}}`),this}ilike(s,n){return this.url.searchParams.append(s,`ilike.${n}`),this}ilikeAllOf(s,n){return this.url.searchParams.append(s,`ilike(all).{${n.join(",")}}`),this}ilikeAnyOf(s,n){return this.url.searchParams.append(s,`ilike(any).{${n.join(",")}}`),this}is(s,n){return this.url.searchParams.append(s,`is.${n}`),this}in(s,n){const a=Array.from(new Set(n)).map(o=>typeof o=="string"&&new RegExp("[,()]").test(o)?`"${o}"`:`${o}`).join(",");return this.url.searchParams.append(s,`in.(${a})`),this}contains(s,n){return typeof n=="string"?this.url.searchParams.append(s,`cs.${n}`):Array.isArray(n)?this.url.searchParams.append(s,`cs.{${n.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(n)}`),this}containedBy(s,n){return typeof n=="string"?this.url.searchParams.append(s,`cd.${n}`):Array.isArray(n)?this.url.searchParams.append(s,`cd.{${n.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(n)}`),this}rangeGt(s,n){return this.url.searchParams.append(s,`sr.${n}`),this}rangeGte(s,n){return this.url.searchParams.append(s,`nxl.${n}`),this}rangeLt(s,n){return this.url.searchParams.append(s,`sl.${n}`),this}rangeLte(s,n){return this.url.searchParams.append(s,`nxr.${n}`),this}rangeAdjacent(s,n){return this.url.searchParams.append(s,`adj.${n}`),this}overlaps(s,n){return typeof n=="string"?this.url.searchParams.append(s,`ov.${n}`):this.url.searchParams.append(s,`ov.{${n.join(",")}}`),this}textSearch(s,n,{config:a,type:o}={}){let l="";o==="plain"?l="pl":o==="phrase"?l="ph":o==="websearch"&&(l="w");const c=a===void 0?"":`(${a})`;return this.url.searchParams.append(s,`${l}fts${c}.${n}`),this}match(s){return Object.entries(s).forEach(([n,a])=>{this.url.searchParams.append(n,`eq.${a}`)}),this}not(s,n,a){return this.url.searchParams.append(s,`not.${n}.${a}`),this}or(s,{foreignTable:n,referencedTable:a=n}={}){const o=a?`${a}.or`:"or";return this.url.searchParams.append(o,`(${s})`),this}filter(s,n,a){return this.url.searchParams.append(s,`${n}.${a}`),this}}return rt.default=t,rt}var Zs;function zn(){if(Zs)return tt;Zs=1;var i=tt&&tt.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(tt,"__esModule",{value:!0});const e=i(es());class t{constructor(s,{headers:n={},schema:a,fetch:o}){this.url=s,this.headers=n,this.schema=a,this.fetch=o}select(s,{head:n=!1,count:a}={}){const o=n?"HEAD":"GET";let l=!1;const c=(s??"*").split("").map(u=>/\s/.test(u)&&!l?"":(u==='"'&&(l=!l),u)).join("");return this.url.searchParams.set("select",c),a&&(this.headers.Prefer=`count=${a}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(s,{count:n,defaultToNull:a=!0}={}){const o="POST",l=[];if(this.headers.Prefer&&l.push(this.headers.Prefer),n&&l.push(`count=${n}`),a||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(s)){const c=s.reduce((u,h)=>u.concat(Object.keys(h)),[]);if(c.length>0){const u=[...new Set(c)].map(h=>`"${h}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}upsert(s,{onConflict:n,ignoreDuplicates:a=!1,count:o,defaultToNull:l=!0}={}){const c="POST",u=[`resolution=${a?"ignore":"merge"}-duplicates`];if(n!==void 0&&this.url.searchParams.set("on_conflict",n),this.headers.Prefer&&u.push(this.headers.Prefer),o&&u.push(`count=${o}`),l||u.push("missing=default"),this.headers.Prefer=u.join(","),Array.isArray(s)){const h=s.reduce((f,d)=>f.concat(Object.keys(d)),[]);if(h.length>0){const f=[...new Set(h)].map(d=>`"${d}"`);this.url.searchParams.set("columns",f.join(","))}}return new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}update(s,{count:n}={}){const a="PATCH",o=[];return this.headers.Prefer&&o.push(this.headers.Prefer),n&&o.push(`count=${n}`),this.headers.Prefer=o.join(","),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}delete({count:s}={}){const n="DELETE",a=[];return s&&a.push(`count=${s}`),this.headers.Prefer&&a.unshift(this.headers.Prefer),this.headers.Prefer=a.join(","),new e.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return tt.default=t,tt}var mt={},bt={},en;function $o(){return en||(en=1,Object.defineProperty(bt,"__esModule",{value:!0}),bt.version=void 0,bt.version="0.0.0-automated"),bt}var tn;function Co(){if(tn)return mt;tn=1,Object.defineProperty(mt,"__esModule",{value:!0}),mt.DEFAULT_HEADERS=void 0;const i=$o();return mt.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${i.version}`},mt}var rn;function Ro(){if(rn)return et;rn=1;var i=et&&et.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(et,"__esModule",{value:!0});const e=i(zn()),t=i(es()),r=Co();class s{constructor(a,{headers:o={},schema:l,fetch:c}={}){this.url=a,this.headers=Object.assign(Object.assign({},r.DEFAULT_HEADERS),o),this.schemaName=l,this.fetch=c}from(a){const o=new URL(`${this.url}/${a}`);return new e.default(o,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(a){return new s(this.url,{headers:this.headers,schema:a,fetch:this.fetch})}rpc(a,o={},{head:l=!1,get:c=!1,count:u}={}){let h;const f=new URL(`${this.url}/rpc/${a}`);let d;l||c?(h=l?"HEAD":"GET",Object.entries(o).filter(([b,p])=>p!==void 0).map(([b,p])=>[b,Array.isArray(p)?`{${p.join(",")}}`:`${p}`]).forEach(([b,p])=>{f.searchParams.append(b,p)})):(h="POST",d=o);const g=Object.assign({},this.headers);return u&&(g.Prefer=`count=${u}`),new t.default({method:h,url:f,headers:g,schema:this.schemaName,body:d,fetch:this.fetch,allowEmpty:!1})}}return et.default=s,et}var sn;function jo(){if(sn)return K;sn=1;var i=K&&K.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(K,"__esModule",{value:!0}),K.PostgrestError=K.PostgrestBuilder=K.PostgrestTransformBuilder=K.PostgrestFilterBuilder=K.PostgrestQueryBuilder=K.PostgrestClient=void 0;const e=i(Ro());K.PostgrestClient=e.default;const t=i(zn());K.PostgrestQueryBuilder=t.default;const r=i(es());K.PostgrestFilterBuilder=r.default;const s=i(Gn());K.PostgrestTransformBuilder=s.default;const n=i(Kn());K.PostgrestBuilder=n.default;const a=i(Hn());return K.PostgrestError=a.default,K.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:s.default,PostgrestBuilder:n.default,PostgrestError:a.default},K}var xo=jo();const Io=Gr(xo),{PostgrestClient:Lo,PostgrestQueryBuilder:gc,PostgrestFilterBuilder:vc,PostgrestTransformBuilder:yc,PostgrestBuilder:_c,PostgrestError:wc}=Io,Do="2.49.4";let kt="";typeof Deno<"u"?kt="deno":typeof document<"u"?kt="web":typeof navigator<"u"&&navigator.product==="ReactNative"?kt="react-native":kt="node";const Uo={"X-Client-Info":`supabase-js-${kt}/${Do}`},qo={headers:Uo},No={schema:"public"},Mo={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Fo={};var Bo=function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(r.next(u))}catch(h){a(h)}}function l(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):s(u.value).then(o,l)}c((r=r.apply(i,e||[])).next())})};const Ho=i=>{let e;return i?e=i:typeof fetch>"u"?e=Wr:e=fetch,(...t)=>e(...t)},Ko=()=>typeof Headers>"u"?Vr:Headers,Go=(i,e,t)=>{const r=Ho(t),s=Ko();return(n,a)=>Bo(void 0,void 0,void 0,function*(){var o;const l=(o=yield e())!==null&&o!==void 0?o:i;let c=new s(a==null?void 0:a.headers);return c.has("apikey")||c.set("apikey",i),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),r(n,Object.assign(Object.assign({},a),{headers:c}))})};var zo=function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(r.next(u))}catch(h){a(h)}}function l(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):s(u.value).then(o,l)}c((r=r.apply(i,e||[])).next())})};function Jo(i){return i.replace(/\/$/,"")}function Wo(i,e){const{db:t,auth:r,realtime:s,global:n}=i,{db:a,auth:o,realtime:l,global:c}=e,u={db:Object.assign(Object.assign({},a),t),auth:Object.assign(Object.assign({},o),r),realtime:Object.assign(Object.assign({},l),s),global:Object.assign(Object.assign({},c),n),accessToken:()=>zo(this,void 0,void 0,function*(){return""})};return i.accessToken?u.accessToken=i.accessToken:delete u.accessToken,u}const Jn="2.69.1",lt=30*1e3,Br=3,Ar=Br*lt,Vo="http://localhost:9999",Qo="supabase.auth.token",Yo={"X-Client-Info":`gotrue-js/${Jn}`},Hr="X-Supabase-Api-Version",Wn={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Xo=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Zo=6e5;class ts extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function A(i){return typeof i=="object"&&i!==null&&"__isAuthError"in i}class el extends ts{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function tl(i){return A(i)&&i.name==="AuthApiError"}class Vn extends ts{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class ke extends ts{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}}class _e extends ke{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function rl(i){return A(i)&&i.name==="AuthSessionMissingError"}class Pr extends ke{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Mt extends ke{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ft extends ke{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function sl(i){return A(i)&&i.name==="AuthImplicitGrantRedirectError"}class nn extends ke{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Kr extends ke{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function $r(i){return A(i)&&i.name==="AuthRetryableFetchError"}class an extends ke{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class Ot extends ke{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const on="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),ln=` 	
\r=`.split(""),nl=(()=>{const i=new Array(128);for(let e=0;e<i.length;e+=1)i[e]=-1;for(let e=0;e<ln.length;e+=1)i[ln[e].charCodeAt(0)]=-2;for(let e=0;e<on.length;e+=1)i[on[e].charCodeAt(0)]=e;return i})();function Qn(i,e,t){const r=nl[i];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(i)}"`)}}function cn(i){const e=[],t=a=>{e.push(String.fromCodePoint(a))},r={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},n=a=>{ol(a,r,t)};for(let a=0;a<i.length;a+=1)Qn(i.charCodeAt(a),s,n);return e.join("")}function il(i,e){if(i<=127){e(i);return}else if(i<=2047){e(192|i>>6),e(128|i&63);return}else if(i<=65535){e(224|i>>12),e(128|i>>6&63),e(128|i&63);return}else if(i<=1114111){e(240|i>>18),e(128|i>>12&63),e(128|i>>6&63),e(128|i&63);return}throw new Error(`Unrecognized Unicode codepoint: ${i.toString(16)}`)}function al(i,e){for(let t=0;t<i.length;t+=1){let r=i.charCodeAt(t);if(r>55295&&r<=56319){const s=(r-55296)*1024&65535;r=(i.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}il(r,e)}}function ol(i,e,t){if(e.utf8seq===0){if(i<=127){t(i);return}for(let r=1;r<6;r+=1)if((i>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=i&31;else if(e.utf8seq===3)e.codepoint=i&15;else if(e.utf8seq===4)e.codepoint=i&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(i<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|i&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function ll(i){const e=[],t={queue:0,queuedBits:0},r=s=>{e.push(s)};for(let s=0;s<i.length;s+=1)Qn(i.charCodeAt(s),t,r);return new Uint8Array(e)}function cl(i){const e=[];return al(i,t=>e.push(t)),new Uint8Array(e)}function ul(i){return Math.round(Date.now()/1e3)+i}function hl(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){const e=Math.random()*16|0;return(i=="x"?e:e&3|8).toString(16)})}const se=()=>typeof window<"u"&&typeof document<"u",Ce={tested:!1,writable:!1},At=()=>{if(!se())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ce.tested)return Ce.writable;const i=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(i,i),globalThis.localStorage.removeItem(i),Ce.tested=!0,Ce.writable=!0}catch{Ce.tested=!0,Ce.writable=!1}return Ce.writable};function dl(i){const e={},t=new URL(i);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,n)=>{e[n]=s})}catch{}return t.searchParams.forEach((r,s)=>{e[s]=r}),e}const Yn=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>Ie(async()=>{const{default:r}=await Promise.resolve().then(()=>Le);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},fl=i=>typeof i=="object"&&i!==null&&"status"in i&&"ok"in i&&"json"in i&&typeof i.json=="function",Xn=async(i,e,t)=>{await i.setItem(e,JSON.stringify(t))},Bt=async(i,e)=>{const t=await i.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Ht=async(i,e)=>{await i.removeItem(e)};class Yt{constructor(){this.promise=new Yt.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Yt.promiseConstructor=Promise;function Cr(i){const e=i.split(".");if(e.length!==3)throw new Ot("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!Xo.test(e[r]))throw new Ot("JWT not in base64url format");return{header:JSON.parse(cn(e[0])),payload:JSON.parse(cn(e[1])),signature:ll(e[2]),raw:{header:e[0],payload:e[1]}}}async function pl(i){return await new Promise(e=>{setTimeout(()=>e(null),i)})}function gl(i,e){return new Promise((r,s)=>{(async()=>{for(let n=0;n<1/0;n++)try{const a=await i(n);if(!e(n,null,a)){r(a);return}}catch(a){if(!e(n,a)){s(a);return}}})()})}function vl(i){return("0"+i.toString(16)).substr(-2)}function yl(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let s="";for(let n=0;n<56;n++)s+=t.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,vl).join("")}async function _l(i){const t=new TextEncoder().encode(i),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(n=>String.fromCharCode(n)).join("")}async function wl(i){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),i;const t=await _l(i);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function it(i,e,t=!1){const r=yl();let s=r;t&&(s+="/PASSWORD_RECOVERY"),await Xn(i,`${e}-code-verifier`,s);const n=await wl(r);return[n,r===n?"plain":"s256"]}const ml=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function bl(i){const e=i.headers.get(Hr);if(!e||!e.match(ml))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Sl(i){if(!i)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(i<=e)throw new Error("JWT has expired")}function kl(i){switch(i){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var Tl=function(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(i);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(i,r[s])&&(t[r[s]]=i[r[s]]);return t};const je=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),El=[502,503,504];async function un(i){var e;if(!fl(i))throw new Kr(je(i),0);if(El.includes(i.status))throw new Kr(je(i),i.status);let t;try{t=await i.json()}catch(n){throw new Vn(je(n),n)}let r;const s=bl(i);if(s&&s.getTime()>=Wn["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new an(je(t),i.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new _e}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((n,a)=>n&&typeof a=="string",!0))throw new an(je(t),i.status,t.weak_password.reasons);throw new el(je(t),i.status||500,r)}const Ol=(i,e,t,r)=>{const s={method:i,headers:(e==null?void 0:e.headers)||{}};return i==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};async function j(i,e,t,r){var s;const n=Object.assign({},r==null?void 0:r.headers);n[Hr]||(n[Hr]=Wn["2024-01-01"].name),r!=null&&r.jwt&&(n.Authorization=`Bearer ${r.jwt}`);const a=(s=r==null?void 0:r.query)!==null&&s!==void 0?s:{};r!=null&&r.redirectTo&&(a.redirect_to=r.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await Al(i,e,t+o,{headers:n,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(l):{data:Object.assign({},l),error:null}}async function Al(i,e,t,r,s,n){const a=Ol(e,r,s,n);let o;try{o=await i(t,Object.assign({},a))}catch(l){throw console.error(l),new Kr(je(l),0)}if(o.ok||await un(o),r!=null&&r.noResolveJson)return o;try{return await o.json()}catch(l){await un(l)}}function we(i){var e;let t=null;Rl(i)&&(t=Object.assign({},i),i.expires_at||(t.expires_at=ul(i.expires_in)));const r=(e=i.user)!==null&&e!==void 0?e:i;return{data:{session:t,user:r},error:null}}function hn(i){const e=we(i);return!e.error&&i.weak_password&&typeof i.weak_password=="object"&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.message&&typeof i.weak_password.message=="string"&&i.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=i.weak_password),e}function Se(i){var e;return{data:{user:(e=i.user)!==null&&e!==void 0?e:i},error:null}}function Pl(i){return{data:i,error:null}}function $l(i){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:n}=i,a=Tl(i,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:n},l=Object.assign({},a);return{data:{properties:o,user:l},error:null}}function Cl(i){return i}function Rl(i){return i.access_token&&i.refresh_token&&i.expires_in}var jl=function(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(i);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(i,r[s])&&(t[r[s]]=i[r[s]]);return t};class xl{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Yn(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await j(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(A(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await j(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Se})}catch(r){if(A(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=jl(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=r==null?void 0:r.newEmail,delete s.newEmail),await j(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:$l,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(A(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await j(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Se})}catch(t){if(A(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,s,n,a,o,l;try{const c={nextPage:null,lastPage:0,total:0},u=await j(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(n=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&n!==void 0?n:""},xform:Cl});if(u.error)throw u.error;const h=await u.json(),f=(a=u.headers.get("x-total-count"))!==null&&a!==void 0?a:0,d=(l=(o=u.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&l!==void 0?l:[];return d.length>0&&(d.forEach(g=>{const b=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),p=JSON.parse(g.split(";")[1].split("=")[1]);c[`${p}Page`]=b}),c.total=parseInt(f)),{data:Object.assign(Object.assign({},h),c),error:null}}catch(c){if(A(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){try{return await j(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Se})}catch(t){if(A(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await j(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Se})}catch(r){if(A(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){try{return await j(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Se})}catch(r){if(A(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){try{const{data:t,error:r}=await j(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:r}}catch(t){if(A(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await j(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(A(t))return{data:null,error:t};throw t}}}const Il={getItem:i=>At()?globalThis.localStorage.getItem(i):null,setItem:(i,e)=>{At()&&globalThis.localStorage.setItem(i,e)},removeItem:i=>{At()&&globalThis.localStorage.removeItem(i)}};function dn(i={}){return{getItem:e=>i[e]||null,setItem:(e,t)=>{i[e]=t},removeItem:e=>{delete i[e]}}}function Ll(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const at={debug:!!(globalThis&&At()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Zn extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Dl extends Zn{}async function Ul(i,e,t){at.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",i,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),at.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",i)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(i,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async s=>{if(s){at.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",i,s.name);try{return await t()}finally{at.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",i,s.name)}}else{if(e===0)throw at.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",i),new Dl(`Acquiring an exclusive Navigator LockManager lock "${i}" immediately failed`);if(at.debug)try{const n=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(n,null,"  "))}catch(n){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",n)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}Ll();const ql={url:Vo,storageKey:Qo,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Yo,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function fn(i,e,t){return await t()}class Pt{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Pt.nextInstanceID,Pt.nextInstanceID+=1,this.instanceID>0&&se()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},ql),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new xl({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=Yn(s.fetch),this.lock=s.lock||fn,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:se()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=Ul:this.lock=fn,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:At()?this.storage=Il:(this.memoryStorage={},this.storage=dn(this.memoryStorage)):(this.memoryStorage={},this.storage=dn(this.memoryStorage)),se()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",n)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async n=>{this._debug("received broadcast notification from other tab or client",n),await this._notifyAllSubscribers(n.data.event,n.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Jn}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=dl(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),se()&&this.detectSessionInUrl&&r!=="none"){const{data:s,error:n}=await this._getSessionFromURL(t,r);if(n){if(this._debug("#_initialize()","error detecting session from URL",n),sl(n)){const l=(e=n.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:n}}return await this._removeSession(),{error:n}}const{session:a,redirectType:o}=s;return this._debug("#_initialize()","detected session in URL",a,"redirect type",o),await this._saveSession(a),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return A(t)?{error:t}:{error:new Vn("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,s;try{const n=await j(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:we}),{data:a,error:o}=n;if(o||!a)return{data:{user:null,session:null},error:o};const l=a.session,c=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(n){if(A(n))return{data:{user:null,session:null},error:n};throw n}}async signUp(e){var t,r,s;try{let n;if("email"in e){const{email:u,password:h,options:f}=e;let d=null,g=null;this.flowType==="pkce"&&([d,g]=await it(this.storage,this.storageKey)),n=await j(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:u,password:h,data:(t=f==null?void 0:f.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:d,code_challenge_method:g},xform:we})}else if("phone"in e){const{phone:u,password:h,options:f}=e;n=await j(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(r=f==null?void 0:f.data)!==null&&r!==void 0?r:{},channel:(s=f==null?void 0:f.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:we})}else throw new Mt("You must provide either an email or phone number and a password");const{data:a,error:o}=n;if(o||!a)return{data:{user:null,session:null},error:o};const l=a.session,c=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(n){if(A(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithPassword(e){try{let t;if("email"in e){const{email:n,password:a,options:o}=e;t=await j(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:hn})}else if("phone"in e){const{phone:n,password:a,options:o}=e;t=await j(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:hn})}else throw new Mt("You must provide either an email or phone number and a password");const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Pr}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(t){if(A(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,s,n;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(n=e.options)===null||n===void 0?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await Bt(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(t??"").split("/");try{const{data:n,error:a}=await j(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:we});if(await Ht(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!n||!n.session||!n.user?{data:{user:null,session:null,redirectType:null},error:new Pr}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign(Object.assign({},n),{redirectType:s??null}),error:a})}catch(n){if(A(n))return{data:{user:null,session:null,redirectType:null},error:n};throw n}}async signInWithIdToken(e){try{const{options:t,provider:r,token:s,access_token:n,nonce:a}=e,o=await j(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:n,nonce:a,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:we}),{data:l,error:c}=o;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new Pr}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(t){if(A(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,s,n,a;try{if("email"in e){const{email:o,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await it(this.storage,this.storageKey));const{error:h}=await j(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(r=l==null?void 0:l.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:o,options:l}=e,{data:c,error:u}=await j(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(s=l==null?void 0:l.data)!==null&&s!==void 0?s:{},create_user:(n=l==null?void 0:l.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(a=l==null?void 0:l.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:u}}throw new Mt("You must provide either an email or phone number.")}catch(o){if(A(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,r;try{let s,n;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,n=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:a,error:o}=await j(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:s,xform:we});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const l=a.session,c=a.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(A(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,r,s;try{let n=null,a=null;return this.flowType==="pkce"&&([n,a]=await it(this.storage,this.storageKey)),await j(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:a}),headers:this.headers,xform:Pl})}catch(n){if(A(n))return{data:null,error:n};throw n}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new _e;const{error:s}=await j(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(A(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:n}=e,{error:a}=await j(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},redirectTo:n==null?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:r,type:s,options:n}=e,{data:a,error:o}=await j(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:o}}throw new Mt("You must provide either an email or phone number and a type")}catch(t){if(A(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Bt(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Ar:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.storage.isServer){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,u)=>(!a&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,u))})}return{data:{session:e},error:null}}const{session:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await j(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Se}):await this._useSession(async t=>{var r,s,n;const{data:a,error:o}=t;if(o)throw o;return!(!((r=a.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new _e}:await j(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(n=(s=a.session)===null||s===void 0?void 0:s.access_token)!==null&&n!==void 0?n:void 0,xform:Se})})}catch(t){if(A(t))return rl(t)&&(await this._removeSession(),await Ht(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:s,error:n}=r;if(n)throw n;if(!s.session)throw new _e;const a=s.session;let o=null,l=null;this.flowType==="pkce"&&e.email!=null&&([o,l]=await it(this.storage,this.storageKey));const{data:c,error:u}=await j(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:l}),jwt:a.access_token,xform:Se});if(u)throw u;return a.user=c.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(r){if(A(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new _e;const t=Date.now()/1e3;let r=t,s=!0,n=null;const{payload:a}=Cr(e.access_token);if(a.exp&&(r=a.exp,s=r<=t),s){const{session:o,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!o)return{data:{user:null,session:null},error:null};n=o}else{const{data:o,error:l}=await this._getUser(e.access_token);if(l)throw l;n={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(t){if(A(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:a,error:o}=t;if(o)throw o;e=(r=a.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new _e;const{session:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(A(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!se())throw new Ft("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Ft(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new nn("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Ft("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new nn("No code detected.");const{data:w,error:S}=await this._exchangeCodeForSession(e.code);if(S)throw S;const m=new URL(window.location.href);return m.searchParams.delete("code"),window.history.replaceState(window.history.state,"",m.toString()),{data:{session:w.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:s,access_token:n,refresh_token:a,expires_in:o,expires_at:l,token_type:c}=e;if(!n||!o||!a||!c)throw new Ft("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(o);let f=u+h;l&&(f=parseInt(l));const d=f-u;d*1e3<=lt&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${d}s, should have been closer to ${h}s`);const g=f-h;u-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,f,u):u-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,f,u);const{data:b,error:p}=await this._getUser(n);if(p)throw p;const _={provider_token:r,provider_refresh_token:s,access_token:n,expires_in:h,expires_at:f,refresh_token:a,token_type:c,user:b.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:_,redirectType:e.type},error:null}}catch(r){if(A(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Bt(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:s,error:n}=t;if(n)return{error:n};const a=(r=s.session)===null||r===void 0?void 0:r.access_token;if(a){const{error:o}=await this.admin.signOut(a,e);if(o&&!(tl(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return e!=="others"&&(await this._removeSession(),await Ht(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=hl(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{const{data:{session:n},error:a}=t;if(a)throw a;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",n)),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(n){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;this.flowType==="pkce"&&([r,s]=await it(this.storage,this.storageKey,!0));try{return await j(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(A(n))return{data:null,error:n};throw n}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(A(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:s}=await this._useSession(async n=>{var a,o,l,c,u;const{data:h,error:f}=n;if(f)throw f;const d=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await j(this.fetch,"GET",d,{headers:this.headers,jwt:(u=(c=h.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(s)throw s;return se()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:e.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(A(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;const{data:n,error:a}=t;if(a)throw a;return await j(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(r=n.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(A(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await gl(async s=>(s>0&&await pl(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await j(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:we})),(s,n)=>{const a=200*Math.pow(2,s);return n&&$r(n)&&Date.now()+a-r<lt})}catch(r){if(this._debug(t,"error",r),A(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),se()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await Bt(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&await this._removeSession();return}const s=((e=r.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<Ar;if(this._debug(t,`session has${s?"":" not"} expired with margin of ${Ar}s`),s){if(this.autoRefreshToken&&r.refresh_token){const{error:n}=await this._callRefreshToken(r.refresh_token);n&&(console.error(n),$r(n)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",n),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new _e;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Yt;const{data:n,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!n.session)throw new _e;await this._saveSession(n.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",n.session);const o={session:n.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(n){if(this._debug(s,"error",n),A(n)){const a={session:null,error:n};return $r(n)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(n),n}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const n=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(l){n.push(l)}});if(await Promise.all(a),n.length>0){for(let o=0;o<n.length;o+=1)console.error(n[o]);throw n[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Xn(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Ht(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&se()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),lt);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-e)/lt);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${lt}ms, refresh threshold is ${Br} ticks`),s<=Br&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Zn)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!se()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const s=[`provider=${encodeURIComponent(t)}`];if(r!=null&&r.redirectTo&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[n,a]=await it(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(n)}`,code_challenge_method:`${encodeURIComponent(a)}`});s.push(o.toString())}if(r!=null&&r.queryParams){const n=new URLSearchParams(r.queryParams);s.push(n.toString())}return r!=null&&r.skipBrowserRedirect&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;return n?{data:null,error:n}:await j(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(A(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;const{data:n,error:a}=t;if(a)return{data:null,error:a};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:c}=await j(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((s=l==null?void 0:l.totp)===null||s===void 0)&&s.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(t){if(A(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;if(n)return{data:null,error:n};const{data:a,error:o}=await j(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:o})})}catch(t){if(A(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;return n?{data:null,error:n}:await j(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(A(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],s=r.filter(a=>a.factor_type==="totp"&&a.status==="verified"),n=r.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:r,totp:s,phone:n},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:s},error:n}=e;if(n)return{data:null,error:n};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=Cr(s.access_token);let o=null;a.aal&&(o=a.aal);let l=o;((r=(t=s.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(l="aal2");const u=a.amr||[];return{data:{currentLevel:o,nextLevel:l,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(a=>a.kid===e);if(r||(r=this.jwks.keys.find(a=>a.kid===e),r&&this.jwks_cached_at+Zo>Date.now()))return r;const{data:s,error:n}=await j(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(n)throw n;if(!s.keys||s.keys.length===0)throw new Ot("JWKS is empty");if(this.jwks=s,this.jwks_cached_at=Date.now(),r=s.keys.find(a=>a.kid===e),!r)throw new Ot("No matching signing key found in JWKS");return r}async getClaims(e,t={keys:[]}){try{let r=e;if(!r){const{data:d,error:g}=await this.getSession();if(g||!d.session)return{data:null,error:g};r=d.session.access_token}const{header:s,payload:n,signature:a,raw:{header:o,payload:l}}=Cr(r);if(Sl(n.exp),!s.kid||s.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:d}=await this.getUser(r);if(d)throw d;return{data:{claims:n,header:s,signature:a},error:null}}const c=kl(s.alg),u=await this.fetchJwk(s.kid,t),h=await crypto.subtle.importKey("jwk",u,c,!0,["verify"]);if(!await crypto.subtle.verify(c,h,a,cl(`${o}.${l}`)))throw new Ot("Invalid JWT signature");return{data:{claims:n,header:s,signature:a},error:null}}catch(r){if(A(r))return{data:null,error:r};throw r}}}Pt.nextInstanceID=0;const Nl=Pt;class Ml extends Nl{constructor(e){super(e)}}var Fl=function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(u){try{c(r.next(u))}catch(h){a(h)}}function l(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?n(u.value):s(u.value).then(o,l)}c((r=r.apply(i,e||[])).next())})};class Bl{constructor(e,t,r){var s,n,a;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const o=Jo(e);this.realtimeUrl=`${o}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${o}/auth/v1`,this.storageUrl=`${o}/storage/v1`,this.functionsUrl=`${o}/functions/v1`;const l=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,c={db:No,realtime:Fo,auth:Object.assign(Object.assign({},Mo),{storageKey:l}),global:qo},u=Wo(r??{},c);this.storageKey=(s=u.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(n=u.global.headers)!==null&&n!==void 0?n:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(h,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=u.auth)!==null&&a!==void 0?a:{},this.headers,u.global.fetch),this.fetch=Go(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new Lo(`${o}/rest/v1`,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),u.accessToken||this._listenForAuthEvents()}get functions(){return new _n(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Rn(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Fl(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:n,flowType:a,lock:o,debug:l},c,u){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Ml({url:this.authUrl,headers:Object.assign(Object.assign({},h),c),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:a,lock:o,debug:l,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Pn(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Hl=(i,e,t)=>new Bl(i,e,t),Kl=(i,{resourceName:e}={resourceName:"revisions"})=>({...i,getRevisions:(t,{recordId:r})=>i.getList(e,{filter:{resource:t,recordId:r},sort:{field:"date",order:"DESC"},pagination:{page:1,perPage:100}}),addRevision:(t,{recordId:r,data:s,authorId:n,message:a,description:o})=>i.create(e,{data:{resource:t,recordId:r,date:new Date().toISOString(),message:a,description:o,authorId:n,data:s}}),deleteRevisions:async(t,{recordId:r})=>{const{data:s}=await i.getList(e,{filter:{resource:t,recordId:r},sort:{field:"date",order:"DESC"},pagination:{page:1,perPage:100}});return i.deleteMany(e,{ids:s.map(n=>n.id)})}}),Q=Hl("https://fvckhctscjrdrvhnolzb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ2Y2toY3RzY2pyZHJ2aG5vbHpiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDE4NTk4NTYsImV4cCI6MjA1NzQzNTg1Nn0.F6LanqVaT-et4uhPMGRVlDUJ3FzqQ8XLum027Y6BoyI"),mc=Si(Q,{getIdentity:async i=>{const{data:e,error:t}=await Q.from("profiles").select("id, first_name, last_name, email, avatar").match({id:i.id}).single();if(!e||t)throw new Error;return{id:e.id,fullName:e.email,avatar:e.avatar}}}),Gl=Kl(_i(wi({dataProvider:Ao({instanceUrl:"https://fvckhctscjrdrvhnolzb.supabase.co",apiKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ2Y2toY3RzY2pyZHJ2aG5vbHpiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDE4NTk4NTYsImV4cCI6MjA1NzQzNTg1Nn0.F6LanqVaT-et4uhPMGRVlDUJ3FzqQ8XLum027Y6BoyI",supabaseClient:Q}),supabaseClient:Q}))),bc=mi({...Gl,invite:async({data:i})=>{const{data:e,error:t}=await Q.functions.invoke("invite",{method:"POST",body:i});if(t)throw new Error(t.message);return{data:e}},answerInvitation:async({data:i})=>{const{error:e}=await Q.functions.invoke("answer_invitation",{method:"PATCH",body:i});if(e)throw new Error(e.message);return{data:{}}},moveCard:async({data:i})=>{const{data:e,error:t}=await Q.functions.invoke("move-card",{method:"POST",body:i});if(t)throw new Error(t.message);return{data:e}},moveColumn:async({data:i})=>{const{data:e,error:t}=await Q.functions.invoke("move-column",{method:"POST",body:i});if(t)throw new Error(t.message);return{data:e}},getDocumentUrl:async({data:i})=>{const{data:t,error:r}=await Q.storage.from(i.bucket).createSignedUrl(i.filePath,i.expiresIn??86400);if(r)throw new Error(r.message);return{data:t.signedUrl}},getCardFromBoardAndNumber:async({data:i})=>{const{data:e,error:t}=await Q.from("cards").select("*, columns!inner(*)").eq("columns.board_id",i.board_id).eq("number",i.number).maybeSingle();if(t)throw new Error(t.message);return{data:e}}},[{resource:"boards",afterGetOne:async i=>({...i,data:{...i.data,columns:i.data.columns?i.data.columns.map(e=>{var t;return{...e,cards:(t=e.cards)==null?void 0:t.sort((r,s)=>r.position-s.position)}}).sort((e,t)=>e.position-t.position):void 0}})},{resource:"documents",beforeCreate:async({data:i,meta:e})=>{if(i.content instanceof File){const{data:t,error:r}=await Q.storage.from("documents").upload(`${i.board_id}/${i.content.name}`,i.content,{upsert:!0});if(r)throw new Error(r.message);i.type=i.content.type,i.content=t.path}return{data:i,meta:e}},beforeDelete:async i=>{const{id:e,previousData:t}=i;return console.log("beforeDelete",{id:e,previousData:t}),i}},{resource:"card_attachments",beforeCreate:async({data:i,meta:e})=>{if(i.file instanceof File){const{data:t,error:r}=await Q.storage.from("documents").upload(`${i.board_id}/card_${i.card_id}/${i.file.name}`,i.file,{upsert:!0});if(r)throw new Error(r.message);return{data:{card_id:i.card_id,path:t.path},meta:e}}throw new Error("Invalid file")},beforeDelete:async i=>{const{error:e}=await Q.storage.from("documents").remove([i.previousData.path]);if(e)throw new Error(e.message);return i}},{resource:"profiles",beforeUpdate:async({data:i,id:e,meta:t,previousData:r})=>{var s,n;return((s=i.avatar)==null?void 0:s.rawFile)instanceof File&&(i.avatar=await zl((n=i.avatar)==null?void 0:n.rawFile)),{data:i,id:e,meta:t,previousData:r}},afterRead:async i=>Array.isArray(i)?i.map(e=>({...e,avatar:e.avatar?{src:e.avatar}:e.avatar})):{...i,avatar:i.avatar?{src:i.avatar}:i.avatar}}]),zl=async i=>new Promise((e,t)=>{const r=new FileReader;r.readAsDataURL(i),r.onload=()=>e(r.result),r.onerror=t});export{mc as authProvider,bc as dataProvider};
